//===========================================================================
// 
// 白昼行将
// 
//   Warcraft III map script
//   Generated by the Warcraft III World Editor
//   Date: Fri Aug 19 20:10:10 2022
//   Map Author: 一文字鲲
// 
//===========================================================================

//***************************************************************************
//*
//*  Global Variables
//*
//***************************************************************************

#define USE_BJ_ANTI_LEAK
#include <YDTrigger/Import.h>
#include <YDTrigger/YDTrigger.h>
globals
    // User-defined
    group array             udg_groupArmy
    integer array           udg_armyType
    integer array           udg_bossType
    integer                 udg_armyTypeTotal          = 0
    integer                 udg_bossTypeTotal          = 0
    unit                    udg_unit                   = null
    player                  udg_player                 = null
    unit array              udg_Heros
    unit                    udg_unit2                  = null
    integer                 udg_gameTime               = 0
    integer                 udg_armyMax                = 0
    group                   udg_groupHero              = null
    item                    udg_item                   = null
    rect                    udg_rect                   = null
    integer                 udg_armyLevel              = 0
    rect array              udg_rectRefresh
    location                udg_point                  = null
    group                   udg_groupDrop              = null
    integer                 udg_gameTime_min           = 0
    integer                 udg_gameTime_sec           = 0
    integer array           udg_Heros_killCount
    real array              udg_Heros_dmgCount
    integer                 udg_int                    = 0
    real                    udg_real                   = 0
    integer array           udg_Heros_abiCount
    integer array           udg_eggs
    integer array           udg_eggs_reward
    integer                 udg_bossLevel              = 0
    integer                 udg_itemType               = 0
    location                udg_point2                 = null
    string array            udg_damageSave_cast
    real array              udg_damageSave_value
    string array            udg_damageSave_icon
    integer                 udg_int2                   = 0
    integer array           udg_damageSave_N
    multiboarditem          udg_gameBoardCeil          = null
    integer array           udg_gameBoradDmgValue
    string                  udg_str
    real array              udg_Heros_bedmgCount
    string                  udg_str2
    integer array           udg_itemList
    real array              udg_Heros_healCount
    unit                    udg_dummy                  = null
    unit                    udg_hero                   = null
    integer                 udg_maxPlayer              = 0
    hashtable               udg_ht                     = null
    integer                 udg_itemListNum            = 0
    integer                 udg_flagRefreshBoss        = 0
    boolean                 udg_flag                   = false
    timer                   udg_systemTimer            = null
    integer                 udg_bossNowType            = 0
    integer array           udg_bossFinalType
    integer                 udg_intItemCDLoop          = 0
    integer                 udg_intItemCDLoop2         = 0
    real                    udg_overTime               = 0
    real                    udg_real2                  = 0
    integer array           udg_gameBoradDPSValue
    integer array           udg_gameBoradDPSValueLastDmg
    rect array              udg_rectResetRefresh
    rect array              udg_rectNowRefresh
    boolean                 udg_flagCrit               = false
    integer                 udg_intRefreshCount        = 0
    multiboard              udg_gameBorad              = null
    integer                 udg_int3                   = 0
    group                   udg_groupEgg               = null
    unit array              udg_bossRects
    group array             udg_groupRBossIns
    rect array              udg_rectBoss
    integer                 udg_boardLine              = 0
    trigger array           udg_triggerItemSpell
    integer                 udg_itemSpellLevel         = 0
    group                   udg_group                  = null
    string                  udg_str3
    location array          udg_posRectBoss
    location array          udg_posFristGate
    location array          udg_posPassWay
    dialog                  udg_winGameMode            = null
    button array            udg_winGameModeButton
    integer                 udg_GameMode               = 0
    string array            udg_strGameMode
    real                    udg_ang                    = 0
    trigger                 udg_trigger                = null
    location                udg_point3                 = null
    integer array           udg_intBossInsTar
    group                   udg_groupDeath             = null
    unit array              udg_HerosSetting
    boolean array           udg_flagLockCamera
    force                   udg_playergroup            = null
    integer                 udg_unitType               = 0
    effect                  udg_effect                 = null
    location array          udg_posNextMove
    boolean array           udg_flagShow
    unit array              udg_HerosAltar
    integer                 udg_intDropPairs           = 0
    force array             udg_pgroupHeros

    // Generated
    rect                    gg_rct_center              = null
    rect                    gg_rct_allMap              = null
    rect                    gg_rct_BarMap_1            = null
    rect                    gg_rct_BarMap_2            = null
    rect                    gg_rct_BarMap_3            = null
    rect                    gg_rct_BarMap_4            = null
    rect                    gg_rct_BarMap_5            = null
    rect                    gg_rct_BarMap_6            = null
    rect                    gg_rct_SpcSnow             = null
    rect                    gg_rct_Bar_1               = null
    rect                    gg_rct_Bar_2               = null
    rect                    gg_rct_Bar_3               = null
    rect                    gg_rct_Bar_4               = null
    rect                    gg_rct_Bar_5               = null
    rect                    gg_rct_Bar_6               = null
    rect                    gg_rct_test                = null
    rect                    gg_rct_Boss_3              = null
    rect                    gg_rct_Boss_2              = null
    rect                    gg_rct_Boss_1              = null
    rect                    gg_rct_Boss_5              = null
    rect                    gg_rct_Boss_4              = null
    rect                    gg_rct_Boss_6              = null
    rect                    gg_rct_initArea            = null
    camerasetup             gg_cam_Camera_001          = null
    camerasetup             gg_cam_Camera_002          = null
    sound                   gg_snd_Show_YourSoulIsMy   = null
    sound                   gg_snd_GameStart           = null
    sound                   gg_snd_Show_TheNightBecame = null
    string                  gg_snd_BloodElfTheme
    sound                   gg_snd_Warning             = null
    trigger                 gg_trg_overShow            = null
    trigger                 gg_trg_treeShow            = null
    trigger                 gg_trg_setting             = null
    trigger                 gg_trg_mode                = null
    trigger                 gg_trg_init                = null
    trigger                 gg_trg_Time                = null
    trigger                 gg_trg_camera              = null
    trigger                 gg_trg_gameOver            = null
    trigger                 gg_trg_dropItem            = null
    trigger                 gg_trg_getItem             = null
    trigger                 gg_trg_smart_Jass          = null
    trigger                 gg_trg_bossRect            = null
    trigger                 gg_trg_bossIns             = null
    trigger                 gg_trg_moveFix_1           = null
    trigger                 gg_trg_moveFix_2           = null
    trigger                 gg_trg_recall              = null
    trigger                 gg_trg_ItemSpell_1         = null
    trigger                 gg_trg_ItemSpell_2         = null
    trigger                 gg_trg_ItemSpell_3         = null
    trigger                 gg_trg_ItemSpell_4         = null
    trigger                 gg_trg_ItemSpell_5         = null
    trigger                 gg_trg_ItemSpell_6         = null
    trigger                 gg_trg_ItemSpell_7         = null
    trigger                 gg_trg_ItemSpell_8         = null
    trigger                 gg_trg_ItemSpell_9         = null
    trigger                 gg_trg_ItemSpell_10        = null
    trigger                 gg_trg_ItemSpell_11        = null
    trigger                 gg_trg_ItemSpell_12        = null
    trigger                 gg_trg_ItemSpell_13        = null
    trigger                 gg_trg_ItemSpell_14        = null
    trigger                 gg_trg_ItemSpell_15        = null
    trigger                 gg_trg_ItemSpell_16        = null
    trigger                 gg_trg_ItemSpell_17        = null
    trigger                 gg_trg_ItemSpell_18        = null
    trigger                 gg_trg_ItemSpell_19        = null
    trigger                 gg_trg_ItemSpell_20        = null
    trigger                 gg_trg_ItemSpell_21        = null
    trigger                 gg_trg_ItemSpell_22        = null
    trigger                 gg_trg_ItemSpell_23        = null
    trigger                 gg_trg_ItemSpell_24        = null
    trigger                 gg_trg_ItemSpell_25        = null
    trigger                 gg_trg_ItemCD              = null
    trigger                 gg_trg_armyinit_Jass       = null
    trigger                 gg_trg_refresh             = null
    trigger                 gg_trg_refresh_order       = null
    trigger                 gg_trg_refresh_finalBossDeath = null
    trigger                 gg_trg_reward_bossRect     = null
    trigger                 gg_trg_reward_army         = null
    trigger                 gg_trg_reward_boss         = null
    trigger                 gg_trg_reward_getSelect    = null
    trigger                 gg_trg_reward_useSelect    = null
    trigger                 gg_trg_reward_refresh      = null
    trigger                 gg_trg_reward_absoTime     = null
    trigger                 gg_trg_reward_box          = null
    trigger                 gg_trg_blood_dmg           = null
    trigger                 gg_trg_blood_bedmg         = null
    trigger                 gg_trg_blood_timer         = null
    trigger                 gg_trg_blood_kill          = null
    trigger                 gg_trg_egginit             = null
    trigger                 gg_trg_active              = null
    trigger                 gg_trg_sort                = null
    trigger                 gg_trg_saveData_kill       = null
    trigger                 gg_trg_saveData_dmg        = null
    trigger                 gg_trg_score               = null
    trigger                 gg_trg_dps                 = null
    trigger                 gg_trg_boardinit           = null
    trigger                 gg_trg_YDWEINIT            = null
    trigger                 gg_trg_gm                  = null
    trigger                 gg_trg____________________001 = null
    trigger                 gg_trg_test                = null
    unit                    gg_unit_nwgt_0057          = null
    unit                    gg_unit_nwgt_0058          = null
    unit                    gg_unit_nwgt_0059          = null
    unit                    gg_unit_nwgt_0060          = null
    unit                    gg_unit_nwgt_0061          = null
    unit                    gg_unit_nwgt_0062          = null
    unit                    gg_unit_nech_0063          = null
    unit                    gg_unit_nech_0064          = null
    unit                    gg_unit_nech_0065          = null
    unit                    gg_unit_nech_0066          = null
    unit                    gg_unit_nech_0067          = null
    unit                    gg_unit_nech_0068          = null
    unit                    gg_unit_nech_0069          = null
    unit                    gg_unit_nech_0070          = null
    unit                    gg_unit_nech_0071          = null
    unit                    gg_unit_nech_0072          = null
    unit                    gg_unit_nwgt_0024          = null
    unit                    gg_unit_nwgt_0025          = null
    unit                    gg_unit_nech_0026          = null
    unit                    gg_unit_ugrv_0027          = null
    unit                    gg_unit_usap_0002          = null
    unit                    gg_unit_uaod_0091          = null
    unit                    gg_unit_uaod_0092          = null
    unit                    gg_unit_uaod_0093          = null
    unit                    gg_unit_uaod_0094          = null
    unit                    gg_unit_uaco_0095          = null
    destructable            gg_dest_ITf3_0001          = null
    destructable            gg_dest_ITf3_0343          = null
    destructable            gg_dest_ITf3_0339          = null
    destructable            gg_dest_ITf3_0347          = null
    destructable            gg_dest_LTg2_1784          = null
    destructable            gg_dest_ZTg2_1903          = null
#include <YDTrigger/Globals.h>
endglobals
#include <YDTrigger/Function.h>

function InitGlobals takes nothing returns nothing
    local integer i = 0
    set i = 0
    loop
        exitwhen (i > 8)
        set udg_groupArmy[i] = CreateGroup()
        set i = i + 1
    endloop

    set udg_armyTypeTotal = 0
    set udg_bossTypeTotal = 0
    set i = 0
    loop
        exitwhen (i > 12)
        set udg_Heros[i] = null
        set i = i + 1
    endloop

    set udg_gameTime = 0
    set udg_armyMax = 35
    set udg_groupHero = CreateGroup()
    set udg_armyLevel = 1
    set udg_groupDrop = CreateGroup()
    set udg_gameTime_min = 0
    set udg_gameTime_sec = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Heros_killCount[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Heros_dmgCount[i] = 0
        set i = i + 1
    endloop

    set udg_int = 0
    set udg_real = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Heros_abiCount[i] = 0
        set i = i + 1
    endloop

    set udg_bossLevel = 1
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_damageSave_cast[i] = ""
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_damageSave_value[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_damageSave_icon[i] = ""
        set i = i + 1
    endloop

    set udg_int2 = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_damageSave_N[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_gameBoradDmgValue[i] = 0
        set i = i + 1
    endloop

    set udg_str = ""
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Heros_bedmgCount[i] = 0
        set i = i + 1
    endloop

    set udg_str2 = ""
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Heros_healCount[i] = 0
        set i = i + 1
    endloop

    set udg_maxPlayer = 0
    set udg_itemListNum = 0
    set udg_flagRefreshBoss = 0
    set udg_flag = false
    set udg_systemTimer = CreateTimer()
    set udg_intItemCDLoop = 0
    set udg_intItemCDLoop2 = 0
    set udg_overTime = 0
    set udg_real2 = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_gameBoradDPSValue[i] = 0
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_gameBoradDPSValueLastDmg[i] = 0
        set i = i + 1
    endloop

    set udg_flagCrit = false
    set udg_intRefreshCount = 0
    set udg_int3 = 0
    set udg_groupEgg = CreateGroup()
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_groupRBossIns[i] = CreateGroup()
        set i = i + 1
    endloop

    set udg_boardLine = 10
    set udg_itemSpellLevel = 0
    set udg_group = CreateGroup()
    set udg_str3 = ""
    set udg_winGameMode = DialogCreate()
    set udg_GameMode = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_strGameMode[i] = ""
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 4)
        set udg_intBossInsTar[i] = 0
        set i = i + 1
    endloop

    set udg_groupDeath = CreateGroup()
    set i = 0
    loop
        exitwhen (i > 4)
        set udg_flagLockCamera[i] = false
        set i = i + 1
    endloop

    set udg_playergroup = CreateForce()
    set i = 0
    loop
        exitwhen (i > 4)
        set udg_flagShow[i] = true
        set i = i + 1
    endloop

    set udg_intDropPairs = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_pgroupHeros[i] = CreateForce()
        set i = i + 1
    endloop

endfunction

//***************************************************************************
//*
//*  Sounds
//*
//***************************************************************************

function InitSounds takes nothing returns nothing
    set gg_snd_Show_YourSoulIsMy = CreateSound( "Units\\Undead\\HeroDreadLord\\HeroDreadlordWarcry1.wav", false, false, true, 10, 10, "HeroAcksEAX" )
    call SetSoundParamsFromLabel( gg_snd_Show_YourSoulIsMy, "HeroDreadLordWarcry" )
    call SetSoundDuration( gg_snd_Show_YourSoulIsMy, 1632 )
    set gg_snd_GameStart = CreateSound( "Units\\Undead\\HeroLich\\HeroLichReady1.wav", false, false, true, 10, 10, "HeroAcksEAX" )
    call SetSoundParamsFromLabel( gg_snd_GameStart, "HeroLichReady" )
    call SetSoundDuration( gg_snd_GameStart, 3233 )
    set gg_snd_Show_TheNightBecame = CreateSound( "Units\\Undead\\HeroDreadLord\\HeroDreadlordReady1.wav", false, false, true, 10, 10, "HeroAcksEAX" )
    call SetSoundParamsFromLabel( gg_snd_Show_TheNightBecame, "HeroDreadLordReady" )
    call SetSoundDuration( gg_snd_Show_TheNightBecame, 2152 )
    set gg_snd_BloodElfTheme = "Sound\\Music\\mp3Music\\BloodElfTheme.mp3"
    set gg_snd_Warning = CreateSound( "Sound\\Interface\\Warning.wav", false, false, false, 10, 10, "" )
    call SetSoundParamsFromLabel( gg_snd_Warning, "Warning" )
    call SetSoundDuration( gg_snd_Warning, 1904 )
endfunction

//***************************************************************************
//*
//*  Destructable Objects
//*
//***************************************************************************

function CreateAllDestructables takes nothing returns nothing
    local destructable d
    local trigger t
    local real life
    set gg_dest_ITf3_0343 = CreateDestructable( 'ITf3', 576.0, -128.0, 170.000, 2.258, 0 )
    set gg_dest_ITf3_0339 = CreateDestructable( 'ITf3', -320.0, 512.0, 350.960, 2.258, 0 )
    set gg_dest_ITf3_0347 = CreateDestructable( 'ITf3', 384.0, -256.0, 170.000, 2.258, 0 )
    set gg_dest_ITf3_0001 = CreateDestructable( 'ITf3', -128.0, 640.0, 350.960, 2.258, 0 )
    set gg_dest_LTg2_1784 = CreateDestructable( 'LTg2', -1824.0, -8928.0, 270.000, 1.000, 0 )
    set gg_dest_ZTg2_1903 = CreateDestructable( 'ZTg2', -96.0, -11360.0, 270.000, 1.000, 0 )
endfunction

//***************************************************************************
//*
//*  Unit Creation
//*
//***************************************************************************

//===========================================================================
function CreateBuildingsForPlayer0 takes nothing returns nothing
    local player p = Player(0)
    local unit u
    local integer unitID
    local trigger t
    local real life

    set gg_unit_uaod_0091 = CreateUnit( p, 'uaod', 14208.0, -14752.0, 330.000 )
endfunction

//===========================================================================
function CreateBuildingsForPlayer1 takes nothing returns nothing
    local player p = Player(1)
    local unit u
    local integer unitID
    local trigger t
    local real life

    set gg_unit_uaod_0092 = CreateUnit( p, 'uaod', 14208.0, -15456.0, 40.000 )
endfunction

//===========================================================================
function CreateBuildingsForPlayer2 takes nothing returns nothing
    local player p = Player(2)
    local unit u
    local integer unitID
    local trigger t
    local real life

    set gg_unit_uaod_0093 = CreateUnit( p, 'uaod', 15488.0, -14752.0, 240.000 )
endfunction

//===========================================================================
function CreateBuildingsForPlayer3 takes nothing returns nothing
    local player p = Player(3)
    local unit u
    local integer unitID
    local trigger t
    local real life

    set gg_unit_uaod_0094 = CreateUnit( p, 'uaod', 15488.0, -15456.0, 160.000 )
endfunction

//===========================================================================
function CreateNeutralHostileBuildings takes nothing returns nothing
    local player p = Player(PLAYER_NEUTRAL_AGGRESSIVE)
    local unit u
    local integer unitID
    local trigger t
    local real life

    set u = CreateUnit( p, 'harm', 10048.0, 4352.0, 270.000 )
    set u = CreateUnit( p, 'hbla', 7616.0, 4224.0, 270.000 )
    set u = CreateUnit( p, 'hlum', 8032.0, 1888.0, 270.000 )
endfunction

//===========================================================================
function CreateNeutralPassiveBuildings takes nothing returns nothing
    local player p = Player(PLAYER_NEUTRAL_PASSIVE)
    local unit u
    local integer unitID
    local trigger t
    local real life

    set gg_unit_usap_0002 = CreateUnit( p, 'usap', 14848.0, -14400.0, 270.000 )
    set gg_unit_ugrv_0027 = CreateUnit( p, 'ugrv', 448.0, 512.0, 270.000 )
    set u = CreateUnit( p, 'nbse', 96.0, 736.0, 270.000 )
    set u = CreateUnit( p, 'n000', -10624.0, 10368.0, 270.000 )
    set u = CreateUnit( p, 'n000', -2816.0, -2112.0, 270.000 )
    set u = CreateUnit( p, 'n000', 512.0, -11584.0, 270.000 )
    set u = CreateUnit( p, 'n000', 6912.0, 7488.0, 270.000 )
    set u = CreateUnit( p, 'n000', 15872.0, 14272.0, 270.000 )
    set u = CreateUnit( p, 'n000', -13696.0, -8384.0, 270.000 )
    set u = CreateUnit( p, 'n000', 11136.0, -1856.0, 270.000 )
    set u = CreateUnit( p, 'n000', 11264.0, -11136.0, 270.000 )
    set u = CreateUnit( p, 'n000', 9024.0, -3136.0, 270.000 )
    set u = CreateUnit( p, 'n000', 2368.0, -5568.0, 270.000 )
    set u = CreateUnit( p, 'n000', -5760.0, 8832.0, 270.000 )
    set u = CreateUnit( p, 'n000', -10432.0, -7680.0, 270.000 )
    set u = CreateUnit( p, 'n000', 4672.0, 10624.0, 270.000 )
    set u = CreateUnit( p, 'n000', 3776.0, 14720.0, 270.000 )
    set u = CreateUnit( p, 'n000', 11648.0, 14976.0, 270.000 )
    set u = CreateUnit( p, 'n000', 14272.0, 5120.0, 270.000 )
    set u = CreateUnit( p, 'n000', -3264.0, -13696.0, 270.000 )
    set u = CreateUnit( p, 'n000', -12288.0, -10176.0, 270.000 )
    set u = CreateUnit( p, 'n000', 6720.0, 2304.0, 270.000 )
    set u = CreateUnit( p, 'n000', 1408.0, 1408.0, 270.000 )
    set u = CreateUnit( p, 'n000', -10624.0, 13824.0, 270.000 )
    set u = CreateUnit( p, 'n000', -6656.0, 14144.0, 270.000 )
    set u = CreateUnit( p, 'n000', 4480.0, -2048.0, 270.000 )
    set u = CreateUnit( p, 'n000', 3264.0, -9216.0, 270.000 )
    set u = CreateUnit( p, 'nbse', 608.0, 160.0, 270.000 )
    set u = CreateUnit( p, 'nbse', -6816.0, 11936.0, 270.000 )
    set u = CreateUnit( p, 'nbse', 10784.0, 15072.0, 270.000 )
    set u = CreateUnit( p, 'nbse', 5472.0, -672.0, 270.000 )
    set u = CreateUnit( p, 'nbse', 10080.0, -10208.0, 270.000 )
    set u = CreateUnit( p, 'nbse', -11168.0, -14304.0, 270.000 )
    set u = CreateUnit( p, 'nbse', -11040.0, -2656.0, 270.000 )
endfunction

//===========================================================================
function CreateNeutralPassive takes nothing returns nothing
    local player p = Player(PLAYER_NEUTRAL_PASSIVE)
    local unit u
    local integer unitID
    local trigger t
    local real life

    set u = CreateUnit( p, 'hrdh', -11668.1, -10653.3, 309.420 )
    set u = CreateUnit( p, 'nshe', -7137.7, -11347.6, 147.100 )
    set u = CreateUnit( p, 'nshe', -7013.5, -11521.3, 169.744 )
    set u = CreateUnit( p, 'nshe', -7173.1, -11458.2, 220.008 )
    set u = CreateUnit( p, 'nshe', -7069.3, -11524.5, 358.671 )
    set u = CreateUnit( p, 'nshe', -6870.0, -11502.8, 293.970 )
    set u = CreateUnit( p, 'nshe', -6812.6, -11548.1, 314.691 )
    set u = CreateUnit( p, 'nshe', -6639.2, -11110.5, 36.838 )
    set u = CreateUnit( p, 'nshe', -6778.0, -11197.3, 197.947 )
    set u = CreateUnit( p, 'nshe', -6783.2, -11315.1, 335.313 )
    set u = CreateUnit( p, 'nshe', -6647.7, -11206.9, 145.496 )
    set u = CreateUnit( p, 'nshe', -6547.1, -11235.1, 231.181 )
    set gg_unit_nwgt_0024 = CreateUnit( p, 'nwgt', -1090.9, -9205.1, 212.279 )
    set gg_unit_nwgt_0025 = CreateUnit( p, 'nwgt', 1808.6, -5875.3, 212.279 )
    set gg_unit_nech_0026 = CreateUnit( p, 'nech', 2325.1, -3950.2, 280.503 )
    set u = CreateUnit( p, 'nech', -11306.6, -11441.5, 47.023 )
    set u = CreateUnit( p, 'nech', -11396.1, -11544.1, 72.402 )
    set u = CreateUnit( p, 'nech', -11240.4, -11612.7, 180.049 )
    set gg_unit_nwgt_0057 = CreateUnit( p, 'nwgt', -899.2, -31.2, 313.120 )
    set gg_unit_nwgt_0058 = CreateUnit( p, 'nwgt', -695.7, 167.9, 313.120 )
    set gg_unit_nwgt_0059 = CreateUnit( p, 'nwgt', -501.6, 342.4, 313.120 )
    set gg_unit_nwgt_0060 = CreateUnit( p, 'nwgt', -120.5, -905.5, 136.560 )
    set gg_unit_nwgt_0061 = CreateUnit( p, 'nwgt', 76.2, -713.5, 136.560 )
    set gg_unit_nwgt_0062 = CreateUnit( p, 'nwgt', 249.6, -526.1, 136.560 )
    set gg_unit_nech_0063 = CreateUnit( p, 'nech', -1702.0, 7675.8, 95.331 )
    set gg_unit_nech_0064 = CreateUnit( p, 'nech', -6636.0, 8736.3, 304.836 )
    set gg_unit_nech_0065 = CreateUnit( p, 'nech', -10309.5, -5878.2, 303.684 )
    set gg_unit_nech_0066 = CreateUnit( p, 'nech', -3987.3, -13979.5, 287.874 )
    set gg_unit_nech_0067 = CreateUnit( p, 'nech', 6302.0, 6055.4, 283.363 )
    set gg_unit_nech_0068 = CreateUnit( p, 'nech', 11238.2, 12966.2, 252.598 )
    set gg_unit_nech_0069 = CreateUnit( p, 'nech', -2561.3, -8206.5, 238.617 )
    set gg_unit_nech_0070 = CreateUnit( p, 'nech', 4824.5, -9870.6, 228.600 )
    set gg_unit_nech_0071 = CreateUnit( p, 'nech', -4095.9, -3739.9, 93.502 )
    set gg_unit_nech_0072 = CreateUnit( p, 'nech', -8824.6, -1462.0, 287.321 )
    set u = CreateUnit( p, 'nrat', -7473.2, -11063.4, 257.374 )
    set u = CreateUnit( p, 'nrat', -7605.7, -11032.5, 315.021 )
    set u = CreateUnit( p, 'nrat', -7656.4, -10957.0, 29.587 )
    set u = CreateUnit( p, 'nrat', -7658.7, -10882.7, 114.096 )
    set u = CreateUnit( p, 'nrat', -7631.7, -10777.1, 277.589 )
    set u = CreateUnit( p, 'nrat', -7519.9, -10674.0, 175.061 )
    set u = CreateUnit( p, 'nrat', -7370.9, -10634.3, 83.081 )
    set u = CreateUnit( p, 'nrat', -7291.5, -10579.6, 338.906 )
    set gg_unit_uaco_0095 = CreateUnit( p, 'uaco', 14853.3, -15135.0, 84.340 )
endfunction

//===========================================================================
function CreatePlayerBuildings takes nothing returns nothing
    call CreateBuildingsForPlayer0(  )
    call CreateBuildingsForPlayer1(  )
    call CreateBuildingsForPlayer2(  )
    call CreateBuildingsForPlayer3(  )
endfunction

//===========================================================================
function CreatePlayerUnits takes nothing returns nothing
endfunction

//===========================================================================
function CreateAllUnits takes nothing returns nothing
    call CreateNeutralHostileBuildings(  )
    call CreateNeutralPassiveBuildings(  )
    call CreatePlayerBuildings(  )
    call CreateNeutralPassive(  )
    call CreatePlayerUnits(  )
endfunction

//***************************************************************************
//*
//*  Regions
//*
//***************************************************************************

function CreateRegions takes nothing returns nothing
    local weathereffect we

    set gg_rct_center = Rect( -960.0, -928.0, 768.0, 832.0 )
    set gg_rct_allMap = Rect( -15744.0, -16384.0, 15840.0, 15264.0 )
    set gg_rct_BarMap_1 = Rect( -15424.0, 4832.0, 2656.0, 15872.0 )
    set we = AddWeatherEffect( gg_rct_BarMap_1, 'WOlw' )
    call EnableWeatherEffect( we, true )
    set gg_rct_BarMap_2 = Rect( -15456.0, -5792.0, 2176.0, 4800.0 )
    set we = AddWeatherEffect( gg_rct_BarMap_2, 'RAlr' )
    call EnableWeatherEffect( we, true )
    set gg_rct_BarMap_3 = Rect( -15456.0, -15872.0, -512.0, -5824.0 )
    set we = AddWeatherEffect( gg_rct_BarMap_3, 'FDwl' )
    call EnableWeatherEffect( we, true )
    set gg_rct_BarMap_4 = Rect( 2656.0, 4864.0, 16128.0, 15360.0 )
    set we = AddWeatherEffect( gg_rct_BarMap_4, 'SNbs' )
    call EnableWeatherEffect( we, true )
    set gg_rct_BarMap_5 = Rect( 2656.0, -5856.0, 16128.0, 4800.0 )
    set we = AddWeatherEffect( gg_rct_BarMap_5, 'LRma' )
    call EnableWeatherEffect( we, true )
    set gg_rct_BarMap_6 = Rect( -224.0, -15936.0, 16416.0, -5888.0 )
    set we = AddWeatherEffect( gg_rct_BarMap_6, 'FDbh' )
    call EnableWeatherEffect( we, true )
    set gg_rct_SpcSnow = Rect( 11136.0, 12224.0, 13088.0, 14848.0 )
    set gg_rct_Bar_1 = Rect( -10560.0, 11136.0, -10336.0, 11360.0 )
    set gg_rct_Bar_2 = Rect( -3680.0, 32.0, -3488.0, 224.0 )
    set gg_rct_Bar_3 = Rect( -8640.0, -9184.0, -8448.0, -8992.0 )
    set gg_rct_Bar_4 = Rect( 13152.0, 5824.0, 13312.0, 5984.0 )
    set gg_rct_Bar_5 = Rect( 4256.0, -2784.0, 4384.0, -2624.0 )
    set gg_rct_Bar_6 = Rect( 6304.0, -10432.0, 6464.0, -10240.0 )
    set gg_rct_test = Rect( 0.0, 0.0, 1952.0, 32.0 )
    set gg_rct_Boss_3 = Rect( -15168.0, -15552.0, -12256.0, -12320.0 )
    set gg_rct_Boss_2 = Rect( -13312.0, -2272.0, -10400.0, 960.0 )
    set gg_rct_Boss_1 = Rect( -4544.0, 10336.0, -1632.0, 13568.0 )
    set gg_rct_Boss_5 = Rect( 7808.0, 1184.0, 10720.0, 4416.0 )
    set gg_rct_Boss_4 = Rect( 4896.0, 11232.0, 7808.0, 14464.0 )
    set gg_rct_Boss_6 = Rect( 11360.0, -9952.0, 14272.0, -6720.0 )
    set gg_rct_initArea = Rect( 14048.0, -15616.0, 15648.0, -14592.0 )
endfunction

//***************************************************************************
//*
//*  Cameras
//*
//***************************************************************************

function CreateCameras takes nothing returns nothing

    set gg_cam_Camera_001 = CreateCameraSetup(  )
    call CameraSetupSetField( gg_cam_Camera_001, CAMERA_FIELD_ZOFFSET, 0.0, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_001, CAMERA_FIELD_ROTATION, 90.0, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_001, CAMERA_FIELD_ANGLE_OF_ATTACK, 304.0, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_001, CAMERA_FIELD_TARGET_DISTANCE, 1996.5, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_001, CAMERA_FIELD_ROLL, 0.0, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_001, CAMERA_FIELD_FIELD_OF_VIEW, 70.0, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_001, CAMERA_FIELD_FARZ, 5000.0, 0.0 )
    call CameraSetupSetDestPosition( gg_cam_Camera_001, -136.7, -95.3, 0.0 )

    set gg_cam_Camera_002 = CreateCameraSetup(  )
    call CameraSetupSetField( gg_cam_Camera_002, CAMERA_FIELD_ZOFFSET, 0.0, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_002, CAMERA_FIELD_ROTATION, 149.7, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_002, CAMERA_FIELD_ANGLE_OF_ATTACK, 346.5, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_002, CAMERA_FIELD_TARGET_DISTANCE, 1650.0, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_002, CAMERA_FIELD_ROLL, 0.0, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_002, CAMERA_FIELD_FIELD_OF_VIEW, 70.0, 0.0 )
    call CameraSetupSetField( gg_cam_Camera_002, CAMERA_FIELD_FARZ, 5000.0, 0.0 )
    call CameraSetupSetDestPosition( gg_cam_Camera_002, 14658.8, -14842.4, 0.0 )

endfunction

//***************************************************************************
//*
//*  Custom Script Code
//*
//***************************************************************************
//TESH.scrollpos=0
//TESH.alwaysfold=0

#include "E:\\Users\\Code\\vampire\\init.j"
//***************************************************************************
//*
//*  Triggers
//*
//***************************************************************************

//===========================================================================
// Trigger: overShow
//===========================================================================
function Trig_overShowFunc001Func001Func005T takes nothing returns nothing
    call YDLocalSet(GetExpiredTimer(), integer, "tim", (YDLocalGet(GetExpiredTimer(), integer, "tim") - 1))
    if ((YDLocalGet(GetExpiredTimer(), integer, "tim") > 500)) then
        call YDLocalSet(GetExpiredTimer(), real, "rad", (YDLocalGet(GetExpiredTimer(), real, "rad") + 1.00))
        call YDLocalSet(GetExpiredTimer(), degree, "rng", OperatorDegreeAdd(YDLocalGet(GetExpiredTimer(), degree, "rng"), 5.00))
        call YDLocalSet(GetExpiredTimer(), real, "x", YDWEOperatorReal3(GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "hero")), +, YDLocalGet(GetExpiredTimer(), real, "rad"), *, CosBJ(YDLocalGet(GetExpiredTimer(), degree, "rng"))))
        call YDLocalSet(GetExpiredTimer(), real, "y", YDWEOperatorReal3(GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "hero")), +, YDLocalGet(GetExpiredTimer(), real, "rad"), *, SinBJ(YDLocalGet(GetExpiredTimer(), degree, "rng"))))
        call SetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDLocalGet(GetExpiredTimer(), real, "x"))
        call SetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDLocalGet(GetExpiredTimer(), real, "y"))
    else
    endif
    if ((YDLocalGet(GetExpiredTimer(), integer, "tim") == 500)) then
        call YDLocalSet(GetExpiredTimer(), real, "dis", DistanceBetweenPoints(GetUnitLoc(YDLocalGet(GetExpiredTimer(), unit, "hero")), GetRectCenter(GetPlayableMapRect())))
        call YDLocalSet(GetExpiredTimer(), degree, "ang", AngleBetweenPoints(GetUnitLoc(YDLocalGet(GetExpiredTimer(), unit, "hero")), GetRectCenter(GetPlayableMapRect())))
        call YDLocalSet(GetExpiredTimer(), real, "spd", (YDLocalGet(GetExpiredTimer(), real, "dis") / 500.00))
        call SetCameraTargetControllerNoZForPlayer(GetOwningPlayer(YDLocalGet(GetExpiredTimer(), unit, "hero")), YDLocalGet(GetExpiredTimer(), unit, "dummy"), 0, 0, false)
    else
    endif
    if ((YDLocalGet(GetExpiredTimer(), integer, "tim") < 500)) then
        call YDLocalSet(GetExpiredTimer(), real, "x", YDWEOperatorReal3(GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy")), +, YDLocalGet(GetExpiredTimer(), real, "spd"), *, CosBJ(YDLocalGet(GetExpiredTimer(), degree, "ang"))))
        call YDLocalSet(GetExpiredTimer(), real, "y", YDWEOperatorReal3(GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy")), +, YDLocalGet(GetExpiredTimer(), real, "spd"), *, SinBJ(YDLocalGet(GetExpiredTimer(), degree, "ang"))))
        call SetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDLocalGet(GetExpiredTimer(), real, "x"))
        call SetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDLocalGet(GetExpiredTimer(), real, "y"))
        call YDLocalSet(GetExpiredTimer(), real, "passtime", I2R(YDLocalGet(GetExpiredTimer(), integer, "tim")))
        call YDLocalSet(GetExpiredTimer(), real, "high", (YDWEOperatorReal3(YDWEOperatorReal3(0.10, *, YDLocalGet(GetExpiredTimer(), real, "passtime"), +, 0.00), *, YDWEOperatorReal3(-0.10, *, YDLocalGet(GetExpiredTimer(), real, "passtime"), +, 50.00), +, 0.00) * 0.60))
        call SetUnitFlyHeight(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDLocalGet(GetExpiredTimer(), real, "high"), 9999.00)
    else
    endif
    if ((YDLocalGet(GetExpiredTimer(), integer, "tim") == 0)) then
        call KillUnit(YDLocalGet(GetExpiredTimer(), unit, "dummy"))
        set udg_player = GetOwningPlayer(YDLocalGet(GetExpiredTimer(), unit, "hero"))
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
    endif
endfunction

function Trig_overShowFunc002A takes nothing returns nothing
    set udg_int = GetConvertedPlayerId(GetOwningPlayer(GetEnumUnit()))
endfunction

function Trig_overShowFunc003T takes nothing returns nothing
    call YDLocal3Release()
    call DestroyTimer(GetExpiredTimer())
    call CinematicFilterGenericBJ(3.00, BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\Black_mask.blp", 0.00, 0.00, 0.00, 80.00, 0, 0, 0, 0.00)
    call CinematicModeExBJ(false, GetPlayersAll(), 2.00)
endfunction

function Trig_overShowFunc004T takes nothing returns nothing
    call YDLocal3Release()
    call DestroyTimer(GetExpiredTimer())
    call CinematicFilterGenericBJ(3.00, BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\Black_mask.blp", 0.00, 0.00, 0.00, 0.00, 0, 0, 0, 100.00)
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 4
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        if ((udg_Heros[bj_forLoopAIndex] != null)) then
            set udg_hero = udg_Heros[bj_forLoopAIndex]
            set udg_unit = CreateUnit(ConvertedPlayer(bj_forLoopAIndex), 'ugar', GetUnitX(udg_HerosAltar[bj_forLoopAIndex]), GetUnitY(udg_HerosAltar[bj_forLoopAIndex]), 0)
            call UnitApplyTimedLife(udg_unit, 'BTLF', 60)
            call SelectUnitForPlayerSingle(udg_HerosAltar[bj_forLoopAIndex], GetOwningPlayer(udg_hero))
            call SetCameraBoundsToRectForPlayerBJ(ConvertedPlayer(bj_forLoopAIndex), gg_rct_initArea)
            call PanCameraToTimedLocForPlayer(ConvertedPlayer(bj_forLoopAIndex), GetRectCenter(gg_rct_initArea), 0)
        else
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
endfunction

function Trig_overShowFunc005Conditions takes nothing returns nothing
    if ((GetUnitTypeId(GetTriggerUnit()) == 'ugar')) then
        call CustomVictoryBJ(GetOwningPlayer(GetTriggerUnit()), true, true)
    else
    endif
endfunction

function Trig_overShowActions takes nothing returns nothing
    local timer ydl_timer
    local group ydl_group
    local unit ydl_unit
    local trigger ydl_trigger
    YDLocalInitialize()
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 4
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        if ((udg_Heros[bj_forLoopAIndex] != null)) then
            call ShowUnit(udg_Heros[bj_forLoopAIndex], false)
            call ShowUnit(udg_HerosSetting[bj_forLoopAIndex], false)
            call ShowUnit(udg_HerosAltar[bj_forLoopAIndex], true)
            set ydl_timer = CreateTimer()
            call YDLocalSet(ydl_timer, unit, "hero", udg_Heros[bj_forLoopAIndex])
            call YDLocalSet(ydl_timer, unit, "dummy", CreateUnit(GetOwningPlayer(udg_Heros[bj_forLoopAIndex]), 'e00W', GetUnitX(udg_Heros[bj_forLoopAIndex]), GetUnitY(udg_Heros[bj_forLoopAIndex]), 0))
            call YDLocalSet(ydl_timer, real, "rad", 0.00)
            call YDLocalSet(ydl_timer, degree, "rng", GetRandomDirectionDeg())
            call YDLocalSet(ydl_timer, real, "dis", 0.00)
            call YDLocalSet(ydl_timer, degree, "ang", 0.00)
            call YDLocalSet(ydl_timer, real, "spd", 0.00)
            call YDLocalSet(ydl_timer, integer, "tim", 700)
            call YDLocalSet(ydl_timer, real, "high", YDLocal1Get(real, "high"))
            call YDLocalSet(ydl_timer, real, "passtime", YDLocal1Get(real, "passtime"))
            call YDLocalSet(ydl_timer, real, "x", YDLocal1Get(real, "x"))
            call YDLocalSet(ydl_timer, real, "y", YDLocal1Get(real, "y"))
            call TimerStart(ydl_timer, 0.01, true, function Trig_overShowFunc001Func001Func005T)
        else
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call ForGroupBJ(udg_groupHero, function Trig_overShowFunc002A)
    set ydl_timer = CreateTimer()
    call TimerStart(ydl_timer, 7.00, false, function Trig_overShowFunc003T)
    set ydl_timer = CreateTimer()
    call TimerStart(ydl_timer, 10.00, false, function Trig_overShowFunc004T)
    set ydl_trigger = CreateTrigger()
    call TriggerRegisterAnyUnitEventBJ(ydl_trigger, EVENT_PLAYER_UNIT_DEATH)
    call TriggerAddCondition(ydl_trigger, Condition(function Trig_overShowFunc005Conditions))
    call YDLocal1Release()
    set ydl_timer = null
    set ydl_group = null
    set ydl_unit = null
    set ydl_trigger = null
endfunction

//===========================================================================
function InitTrig_overShow takes nothing returns nothing
    set gg_trg_overShow = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_overShow, "overShow")
#endif
    call TriggerAddAction(gg_trg_overShow, function Trig_overShowActions)
endfunction

//===========================================================================
// Trigger: treeShow
//===========================================================================
function Trig_treeShowFunc001Func001Func003A takes nothing returns nothing
    if (((GetDestructableTypeId(GetEnumDestructable()) == 'WTtw') or (GetDestructableTypeId(GetEnumDestructable()) == 'WTst') or (GetDestructableTypeId(GetEnumDestructable()) == 'LTlt') or (GetDestructableTypeId(GetEnumDestructable()) == 'FTtw'))) then
        call hideTree(udg_Heros[bj_forLoopAIndex], GetEnumDestructable())
    else
    endif
endfunction

function Trig_treeShowActions takes nothing returns nothing
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 4
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        if ((udg_Heros[bj_forLoopAIndex] != null)) then
            set udg_point = GetUnitLoc(udg_Heros[bj_forLoopAIndex])
            set udg_point2 = PolarProjectionBJ(udg_point, 120.00, 270.00)
            call EnumDestructablesInCircleBJ(240.00, udg_point2, function Trig_treeShowFunc001Func001Func003A)
            call RemoveLocation(udg_point)
        else
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
endfunction

//===========================================================================
function InitTrig_treeShow takes nothing returns nothing
    set gg_trg_treeShow = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_treeShow, "treeShow")
#endif
    call TriggerRegisterTimerEventPeriodic(gg_trg_treeShow, 0.10)
    call TriggerAddAction(gg_trg_treeShow, function Trig_treeShowActions)
endfunction

//===========================================================================
// Trigger: setting
//===========================================================================
function Trig_settingFunc001Func001Func005Func004Func002A takes nothing returns nothing
    if ((GetItemTypeId(GetEnumItem()) == 'Is00')) then
        if ((udg_player == GetLocalPlayer())) then
            call PingMinimap(GetItemX(GetEnumItem()), GetItemY(GetEnumItem()), 10.00)
        else
        endif
        call DisplayTimedTextToPlayer(udg_player, 0, 0, 30, "|cffffcc00[系统提示]|r：已在小地图上标记所有宝箱位置！")
    else
    endif
endfunction

function Trig_settingFunc001Func001Func005Func005Func006Conditions takes nothing returns nothing
    set udg_hero = YDLocalGet(GetTriggeringTrigger(), unit, "hero")
    if ((GetClickedButtonBJ() != udg_winGameModeButton[1])) then
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = 6
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            if ((GetClickedButtonBJ() == udg_winGameModeButton[(bj_forLoopAIndex + 1)])) then
                call removeBaseAbi(udg_hero, bj_forLoopAIndex, 0)
                call DoNothing() YDNL exitwhen true//()
            else
            endif
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
    else
        call AdjustPlayerStateBJ(500, GetOwningPlayer(YDLocalGet(GetTriggeringTrigger(), unit, "hero")), PLAYER_STATE_RESOURCE_GOLD)
    endif
    call DialogDisplay(GetOwningPlayer(YDLocalGet(GetTriggeringTrigger(), unit, "hero")), udg_winGameMode, false)
    call YDLocal4Release()
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Trig_settingFunc001Func001Func005Conditions takes nothing returns nothing
    local trigger ydl_trigger
    set udg_hero = YDLocalGet(GetTriggeringTrigger(), unit, "hero")
    if ((GetSpellAbilityId() == 'ANta')) then
        if ((udg_flagLockCamera[YDLocalGet(GetTriggeringTrigger(), integer, "id")] == true)) then
            set udg_flagLockCamera[YDLocalGet(GetTriggeringTrigger(), integer, "id")] = false
            call ResetToGameCameraForPlayer(GetOwningPlayer(udg_hero), 0)
            call DisplayTimedTextToPlayer(GetOwningPlayer(udg_hero), 0, 0, 30, "|cffffcc00[系统提示]|r：已解除镜头锁定！")
        else
            set udg_flagLockCamera[YDLocalGet(GetTriggeringTrigger(), integer, "id")] = true
            call SetCameraTargetControllerNoZForPlayer(GetOwningPlayer(udg_hero), udg_hero, 0, 0, false)
            call DisplayTimedTextToPlayer(GetOwningPlayer(udg_hero), 0, 0, 30, "|cffffcc00[系统提示]|r：恢复镜头锁定！")
        endif
    else
    endif
    if ((GetSpellAbilityId() == 'ACro')) then
        set udg_hero = udg_Heros[YDLocalGet(GetTriggeringTrigger(), integer, "id")]
        call DisplayTimedTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, 15.00, "|cff32ec32*** 现在开始一次幸运值概率的计算 ***|r")
        set udg_str = YDWEOperatorString3("[计算|cff3399ff10%|r的概率结果为] = |cffffcc00", R2S(calculateLuckCount(udg_hero, 10)), "%|r")
        call DisplayTimedTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, 15.00, udg_str)
        set udg_str = YDWEOperatorString3("[计算|cff3399ff25%|r的概率结果为] = |cffffcc00", R2S(calculateLuckCount(udg_hero, 25)), "%|r")
        call DisplayTimedTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, 15.00, udg_str)
        set udg_str = YDWEOperatorString3("[计算|cff3399ff50%|r的概率结果为] = |cffffcc00", R2S(calculateLuckCount(udg_hero, 50)), "%|r")
        call DisplayTimedTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, 15.00, udg_str)
        call DisplayTimedTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, 15.00, "|cff32ec32*** ------------------- ***|r")
    else
    endif
    if ((GetSpellAbilityId() == 'Acht')) then
        set udg_player = GetOwningPlayer(GetTriggerUnit())
        call EnumItemsInRectBJ(gg_rct_allMap, function Trig_settingFunc001Func001Func005Func004Func002A)
    else
    endif
    if ((GetSpellAbilityId() == 'AAns')) then
        call DialogClear(udg_winGameMode)
        call DialogSetMessage(udg_winGameMode, "移除一个能力！")
        set udg_winGameModeButton[1] = DialogAddButton(udg_winGameMode, "放弃移除", 0)
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = 6
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            set udg_int = getBaseAbi(udg_hero, bj_forLoopAIndex)
            if ((udg_int > 0)) then
                set udg_str = GetAbilityName(udg_int)
                set udg_winGameModeButton[(bj_forLoopAIndex + 1)] = DialogAddButton(udg_winGameMode, (YDWEOperatorString3("[移除<", I2S(bj_forLoopAIndex), ">]") + udg_str), 0)
            else
            endif
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
        call DialogDisplay(GetOwningPlayer(udg_hero), udg_winGameMode, true)
        set ydl_trigger = CreateTrigger()
        call YDLocalSet(ydl_trigger, unit, "hero", udg_hero)
        call TriggerRegisterDialogEvent(ydl_trigger, udg_winGameMode)
        call TriggerAddCondition(ydl_trigger, Condition(function Trig_settingFunc001Func001Func005Func005Func006Conditions))
    else
    endif
    set ydl_trigger = null
endfunction

function Trig_settingFunc001Func001Func006Conditions takes nothing returns nothing
    call SelectUnitForPlayerSingle(YDLocalGet(GetTriggeringTrigger(), unit, "hero"), GetOwningPlayer(YDLocalGet(GetTriggeringTrigger(), unit, "hero")))
    if (((GetIssuedOrderIdBJ() == String2OrderIdBJ("smart")) or (GetIssuedOrderIdBJ() == String2OrderIdBJ("move")))) then
        call IssueImmediateOrder(GetTriggerUnit(), "stop")
        if ((GetOrderTargetUnit() != null)) then
            call IssueTargetOrder(YDLocalGet(GetTriggeringTrigger(), unit, "hero"), "smart", GetOrderTargetUnit())
        else
            if ((GetOrderTargetItem() != null)) then
                call IssueTargetOrder(YDLocalGet(GetTriggeringTrigger(), unit, "hero"), "smart", GetOrderTargetItem())
            else
                call IssuePointOrder(YDLocalGet(GetTriggeringTrigger(), unit, "hero"), "move", GetOrderPointX(), GetOrderPointY())
            endif
        endif
    else
    endif
endfunction

function Trig_settingActions takes nothing returns nothing
    local trigger ydl_trigger
    YDLocalInitialize()
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 4
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        if ((udg_HerosSetting[bj_forLoopAIndex] != null)) then
            set udg_unit = udg_HerosSetting[bj_forLoopAIndex]
            set udg_hero = udg_Heros[bj_forLoopAIndex]
            call AroundUwithU(udg_unit,udg_hero, 0, 0, 3600)
            call YDLocal1Set(unit, "set", udg_unit)
            set ydl_trigger = CreateTrigger()
            call YDLocalSet(ydl_trigger, unit, "hero", udg_hero)
            call YDLocalSet(ydl_trigger, integer, "id", bj_forLoopAIndex)
            call TriggerRegisterUnitEvent(ydl_trigger, YDLocal1Get(unit, "set"), EVENT_UNIT_SPELL_EFFECT)
            call TriggerAddCondition(ydl_trigger, Condition(function Trig_settingFunc001Func001Func005Conditions))
            set ydl_trigger = CreateTrigger()
            call YDLocalSet(ydl_trigger, unit, "hero", udg_hero)
            call YDLocalSet(ydl_trigger, integer, "id", bj_forLoopAIndex)
            call TriggerRegisterUnitEvent(ydl_trigger, YDLocal1Get(unit, "set"), EVENT_UNIT_ISSUED_TARGET_ORDER)
            call TriggerRegisterUnitEvent(ydl_trigger, YDLocal1Get(unit, "set"), EVENT_UNIT_ISSUED_POINT_ORDER)
            call TriggerRegisterUnitEvent(ydl_trigger, YDLocal1Get(unit, "set"), EVENT_UNIT_ISSUED_ORDER)
            call TriggerAddCondition(ydl_trigger, Condition(function Trig_settingFunc001Func001Func006Conditions))
        else
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call YDLocal1Release()
    set ydl_trigger = null
endfunction

//===========================================================================
function InitTrig_setting takes nothing returns nothing
    set gg_trg_setting = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_setting, "setting")
#endif
    call TriggerAddAction(gg_trg_setting, function Trig_settingActions)
endfunction

//===========================================================================
// Trigger: mode
//===========================================================================
function Trig_modeFunc022Func001Func013T takes nothing returns nothing
    call SelectUnitForPlayerSingle(udg_hero, GetOwningPlayer(udg_hero))
    call ResetToGameCamera(0)
    call oneAbilitySelect(udg_hero, true)
    set udg_intItemCDLoop = 1
    loop
        exitwhen udg_intItemCDLoop > 6
        call UnitAddAbility(udg_hero, 'bke0' + udg_intItemCDLoop)
        set udg_intItemCDLoop = udg_intItemCDLoop + 1
    endloop
    call TriggerRegisterTimerEventPeriodic(gg_trg_camera, 0.10)
    call TriggerRegisterTimerEventPeriodic(gg_trg_score, 0.03)
    call TriggerExecute(gg_trg_bossRect)
    call TriggerExecute(gg_trg_setting)
endfunction

function Trig_modeFunc022Func001Func029T takes nothing returns nothing
    set udg_overTime = 30.00
    call SetTimeOfDay(18.00)
    call StartTimerBJ(udg_systemTimer, true, 1.00)
    call EnableTrigger(gg_trg_refresh)
endfunction

function Trig_modeFunc022Func001Func030T takes nothing returns nothing
    if ((GetHeroLevel(YDLocalGet(GetExpiredTimer(), unit, "h")) == YDLocalGet(GetExpiredTimer(), integer, "max"))) then
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
        if ((GetHeroSkillPoints(YDLocalGet(GetExpiredTimer(), unit, "h")) < 20)) then
            call SetHeroLevel(YDLocalGet(GetExpiredTimer(), unit, "h"), (GetHeroLevel(YDLocalGet(GetExpiredTimer(), unit, "h")) + 1), true)
        else
        endif
    endif
endfunction

function Trig_modeFunc022Func001Func031T takes nothing returns nothing
    call SetUnitLifePercentBJ(YDLocalGet(GetExpiredTimer(), unit, "h"), 100)
endfunction

function Trig_modeFunc022Conditions takes nothing returns nothing
    local timer ydl_timer
    if ((GetClickedButtonBJ() == udg_winGameModeButton[5])) then
        set udg_GameMode = 0
        set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
        set udg_Heros[udg_int] = CreateUnit(udg_player, 'U000', 0, 0, 0)
        set udg_hero = udg_Heros[udg_int]
        set udg_HerosSetting[bj_forLoopAIndex] = CreateUnit(udg_player, 'Udre', 0, 0, 0)
        set udg_posNextMove[bj_forLoopAIndex] = GetUnitLoc(udg_hero)
        call TriggerRegisterUnitEvent(gg_trg_blood_bedmg, udg_hero, EVENT_UNIT_DAMAGED)
        call TriggerRegisterUnitEvent(gg_trg_moveFix_1, udg_hero, EVENT_UNIT_ISSUED_POINT_ORDER)
        call TriggerRegisterUnitEvent(gg_trg_moveFix_2, udg_hero, EVENT_UNIT_SELL)
        call TriggerRegisterUnitEvent(gg_trg_reward_refresh, udg_hero, EVENT_UNIT_SPELL_EFFECT)
        call GroupAddUnit(udg_groupHero, udg_hero)
        call SetCameraTargetControllerNoZForPlayer(GetOwningPlayer(udg_hero), udg_hero, 0, 0, false)
        set ydl_timer = CreateTimer()
        call TimerStart(ydl_timer, 0.10, false, function Trig_modeFunc022Func001Func013T)
        call SetPlayerAlliance(Player(PLAYER_NEUTRAL_PASSIVE), udg_player, ALLIANCE_SHARED_ADVANCED_CONTROL, true)
        call SetPlayerStateBJ(udg_player, PLAYER_STATE_RESOURCE_FOOD_CAP, 30)
        call SetPlayerStateBJ(udg_player, PLAYER_STATE_RESOURCE_FOOD_USED, 60)
        call CreateFogModifierRectBJ(true, udg_player, FOG_OF_WAR_VISIBLE, gg_rct_center)
        call SetPlayerAlliance(Player(PLAYER_NEUTRAL_PASSIVE), udg_player, ALLIANCE_SHARED_VISION, true)
        set udg_maxPlayer = 1
        set udg_armyMax = 8
        set bj_forLoopAIndex = 5
        set bj_forLoopAIndexEnd = 12
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            set udg_player = ConvertedPlayer(OperatorIntegerAdd(bj_forLoopAIndex, 0))
            call CreateFogModifierRectBJ(true, udg_player, FOG_OF_WAR_VISIBLE, GetPlayableMapRect())
            call SetPlayerColor(udg_player, PLAYER_COLOR_YELLOW)
            call SetPlayerName(udg_player, "烈阳军")
            call SetPlayerAlliance(udg_player, Player(PLAYER_NEUTRAL_AGGRESSIVE), ALLIANCE_PASSIVE, true)
            call SetPlayerAlliance(Player(PLAYER_NEUTRAL_AGGRESSIVE), udg_player, ALLIANCE_PASSIVE, true)
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
        call ModifyGateBJ(bj_GATEOPERATION_OPEN, gg_dest_LTg2_1784)
        call ModifyGateBJ(bj_GATEOPERATION_OPEN, gg_dest_ZTg2_1903)
        call WaygateActivateBJ(true, gg_unit_nwgt_0024)
        call WaygateSetDestination(gg_unit_nwgt_0024, GetUnitX(gg_unit_nwgt_0025), GetUnitY(gg_unit_nwgt_0025))
        call WaygateActivateBJ(true, gg_unit_nwgt_0025)
        call WaygateSetDestination(gg_unit_nwgt_0025, GetUnitX(gg_unit_nwgt_0024), GetUnitY(gg_unit_nwgt_0024))
        call DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, 30, udg_strGameMode[5])
        set ydl_timer = CreateTimer()
        call TimerStart(ydl_timer, 30.00, false, function Trig_modeFunc022Func001Func029T)
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, integer, "max", (GetHeroLevel(udg_hero) + 10))
        call YDLocalSet(ydl_timer, unit, "h", udg_hero)
        call TimerStart(ydl_timer, 0.10, true, function Trig_modeFunc022Func001Func030T)
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, unit, "h", udg_hero)
        call TimerStart(ydl_timer, 0.10, true, function Trig_modeFunc022Func001Func031T)
    else
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = 4
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            if ((GetClickedButtonBJ() == udg_winGameModeButton[bj_forLoopAIndex])) then
                call DialogDisplay(GetTriggerPlayer(), udg_winGameMode, false)
                set udg_GameMode = bj_forLoopAIndex
                call TriggerRegisterTimerEventPeriodic(gg_trg_init, 1.00)
                call YDLocal4Release()
                call DestroyTrigger(GetTriggeringTrigger())
            else
            endif
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
    endif
    set ydl_timer = null
endfunction

function Trig_modeActions takes nothing returns nothing
    local trigger ydl_trigger
    call Loading()
    call handBook()
    call barAss()
    call initItem()
    call SetTimeOfDay(17.00)
    call CameraSetupApplyForceDuration(gg_cam_Camera_002, true, 0.00)
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 4
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        set udg_player = ConvertedPlayer(bj_forLoopAIndex)
        set udg_pgroupHeros[bj_forLoopAIndex] = GetForceOfPlayer(udg_player)
        call SetCameraBoundsToRectForPlayerBJ(udg_player, gg_rct_initArea)
        if ((GetPlayerController(udg_player) == MAP_CONTROL_USER) and (GetPlayerSlotState(udg_player) == PLAYER_SLOT_STATE_PLAYING)) then
            call DoNothing() YDNL exitwhen true//()
        else
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, 30, YDWEOperatorString3("等待|cffffcc00[", GetPlayerName(udg_player), "]|r选择游戏模式！"))
    call DialogSetMessage(udg_winGameMode, "选择游戏难度！")
    set udg_winGameModeButton[1] = DialogAddButton(udg_winGameMode, "简单[1]", '1')
    set udg_strGameMode[1] = "已选择当前难度|cff00ff00[简单]|r"
    set udg_winGameModeButton[2] = DialogAddButton(udg_winGameMode, "普通[2]", '2')
    set udg_strGameMode[2] = "已选择当前难度|cff00ff00[普通]|r：难度上升后掉落治疗将更少，敌人移动速度将更快"
    set udg_winGameModeButton[3] = DialogAddButton(udg_winGameMode, "困难[3]", '3')
    set udg_strGameMode[3] = "已选择当前难度|cff00ff00[困难]|r：掉落治疗将更少，敌人移动速度将更快，玩家受到的伤害将更高"
    set udg_winGameModeButton[4] = DialogAddButton(udg_winGameMode, "地狱[4]", '4')
    set udg_strGameMode[4] = "已选择当前难度|cff00ff00[地狱]|r：掉落治疗将更少，敌人移动速度将更快，玩家受到的伤害将更高，玩家造成伤害将更低"
    set udg_int = 0
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 4
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        if ((GetPlayerSlotState(ConvertedPlayer(bj_forLoopAIndex)) == PLAYER_SLOT_STATE_PLAYING) and (GetPlayerController(ConvertedPlayer(bj_forLoopAIndex)) == MAP_CONTROL_USER)) then
            set udg_int = (udg_int + 1)
        else
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call DialogDisplay(udg_player, udg_winGameMode, true)
    set ydl_trigger = CreateTrigger()
    call TriggerRegisterDialogEvent(ydl_trigger, udg_winGameMode)
    call TriggerAddCondition(ydl_trigger, Condition(function Trig_modeFunc022Conditions))
    set ydl_trigger = null
endfunction

//===========================================================================
function InitTrig_mode takes nothing returns nothing
    set gg_trg_mode = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_mode, "mode")
#endif
    call TriggerRegisterTimerEventSingle(gg_trg_mode, 0.00)
    call TriggerAddAction(gg_trg_mode, function Trig_modeActions)
endfunction

//===========================================================================
// Trigger: init
//===========================================================================
function Trig_initFunc001Func033T takes nothing returns nothing
    if ((udg_Heros[YDLocalGet(GetExpiredTimer(), integer, "n")] != null)) then
        set udg_point = GetUnitLoc(YDLocalGet(GetExpiredTimer(), unit, "unit"))
        set udg_point2 = GetUnitLoc(udg_Heros[YDLocalGet(GetExpiredTimer(), integer, "n")])
        set udg_dummy = CreateUnitAtLoc(udg_player, 'e00D', udg_point, 0)
        call UnitAddAbility(udg_dummy, 'Afod')
        call IssueTargetOrder(udg_dummy, "fingerofdeath", CreateUnitAtLoc(Player(bj_PLAYER_NEUTRAL_VICTIM), 'nvil', udg_point2, 0))
        call UnitApplyTimedLife(udg_dummy, 'BHwe', 1.00)
        call SetDestructableAnimation(YDLocalArrayGet(GetExpiredTimer(), destructable, "火炬", YDLocalGet(GetExpiredTimer(), integer, "n")), "death")
        call SetUnitTimeScale(udg_Heros[YDLocalGet(GetExpiredTimer(), integer, "n")], (-0.80 + 0))
        call SetUnitAnimation(udg_unit, "stand work gold")
        call RemoveLocation(udg_point)
        call RemoveLocation(udg_point2)
    else
    endif
    if ((YDLocalGet(GetExpiredTimer(), integer, "n") == udg_maxPlayer)) then
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
        call YDLocalSet(GetExpiredTimer(), integer, "n", (YDLocalGet(GetExpiredTimer(), integer, "n") + 1))
    endif
endfunction

function Trig_initFunc003Func007A takes nothing returns nothing
    set udg_hero = GetEnumUnit()
    call SetUnitTimeScale(udg_hero, 1.00)
    call SetUnitAnimation(udg_hero, "stand")
    call SelectUnitForPlayerSingle(udg_hero, GetOwningPlayer(udg_hero))
    call TriggerRegisterUnitEvent(gg_trg_recall, udg_hero, EVENT_UNIT_SPELL_FINISH)
    call oneAbilitySelect(udg_hero, true)
    call addState(udg_hero, "暴击伤害", 50)
    call addState(udg_hero, "拾取范围", 450)
endfunction

function Trig_initFunc005Func002A takes nothing returns nothing
    set udg_hero = GetEnumUnit()
    call PauseUnit(udg_hero, true)
    call YDWETimerDestroyEffect(3.00, AddSpecialEffect("Abilities\\Spells\\Items\\AIso\\AIsoTarget.mdl", GetUnitX(udg_hero), GetUnitY(udg_hero)))
    call SetUnitAnimation(udg_hero, "death")
    call SetCameraBoundsToRectForPlayerBJ(GetOwningPlayer(udg_hero), gg_rct_allMap)
endfunction

function Trig_initFunc006Func004A takes nothing returns nothing
    set udg_hero = GetEnumUnit()
    call SetUnitX(udg_hero, GetRandomReal(-300.00, 300.00))
    call SetUnitY(udg_hero, GetRandomReal(-300.00, 300.00))
    call YDWETimerDestroyEffect(1.00, AddSpecialEffect("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl", GetUnitX(udg_hero), GetUnitY(udg_hero)))
    call SetUnitTimeScale(udg_hero, (-1.00 + 0))
endfunction

function Trig_initFunc007Func003A takes nothing returns nothing
    set udg_hero = GetEnumUnit()
    call PauseUnit(udg_hero, false)
    call SetUnitTimeScale(udg_hero, 1.00)
    call SetUnitAnimationByIndex(udg_hero, 3)
    call ShowUnit(udg_HerosSetting[GetConvertedPlayerId(GetOwningPlayer(udg_hero))], true)
    call SetCameraTargetControllerNoZForPlayer(GetOwningPlayer(udg_hero), udg_hero, 0, 0, false)
    call SelectUnitForPlayerSingle(udg_hero, GetOwningPlayer(udg_hero))
    if ((getState(udg_hero, "重生次数") > 0.00)) then
        call UnitAddAbility(udg_hero, 'ACrn')
    else
    endif
    if ((getState(udg_hero, "吸血鬼领域") > 0.00)) then
        set udg_dummy = CreateUnit(GetOwningPlayer(udg_hero), 'e00D', 0, 0, 0)
        call UnitAddAbility(udg_dummy, 'Atdg')
        call SetUnitAbilityLevel(udg_dummy, 'Atdg', R2I(getState(udg_hero, "吸血鬼领域")))
        call UnitApplyTimedLife(udg_dummy, 'BHwe', (60.00 * getState(udg_hero, "吸血鬼领域")))
        call YDUserDataSet(unit, udg_dummy, "cast", string, "吸血鬼领域")
        call YDUserDataSet(unit, udg_dummy, "icon", string, "ReplaceableTextures\\CommandButtons\\BTNAcidBomb.blp")
        call AroundUwithU(udg_dummy,udg_hero,0,0,9999)
    else
    endif
    if ((getState(udg_hero, "诅咒反哺") > 0.00)) then
        call UnitAddAbility(udg_hero, 'Ad08')
        call SetUnitAbilityLevel(udg_hero, 'Ad08', R2I(getState(udg_hero, "诅咒反哺")))
    else
    endif
endfunction

function Trig_initActions takes nothing returns nothing
    local timer ydl_timer
    local group ydl_group
    local unit ydl_unit
    YDLocalInitialize()
    if ((GetTriggerExecCount(GetTriggeringTrigger()) == 1)) then
        set udg_rectRefresh[1] = gg_rct_Bar_1
        set udg_rectRefresh[2] = gg_rct_Bar_2
        set udg_rectRefresh[3] = gg_rct_Bar_3
        set udg_rectRefresh[4] = gg_rct_Bar_4
        set udg_rectRefresh[5] = gg_rct_Bar_5
        set udg_rectRefresh[6] = gg_rct_Bar_6
        set udg_rectBoss[1] = gg_rct_Boss_1
        set udg_rectBoss[2] = gg_rct_Boss_2
        set udg_rectBoss[3] = gg_rct_Boss_3
        set udg_rectBoss[4] = gg_rct_Boss_4
        set udg_rectBoss[5] = gg_rct_Boss_5
        set udg_rectBoss[6] = gg_rct_Boss_6
        call PlayMusicBJ(gg_snd_BloodElfTheme)
        call CinematicModeExBJ(true, GetPlayersAll(), 0.20)
        call ForceCinematicSubtitles(true)
        set udg_unit = gg_unit_uaco_0095
        call AddSpecialEffectTargetUnitBJ("origin", udg_unit, "Abilities\\Spells\\Human\\FlameStrike\\FlameStrikeTarget.mdl")
        call QueueUnitAnimation(udg_unit, "stand work gold")
        call TransmissionFromUnitWithNameBJ(GetPlayersAll(), udg_unit, "眷属", gg_snd_GameStart, "苏醒吧，血族们！", bj_TIMETYPE_ADD, 5.00, false)
        call UnitApplyTimedLife(udg_unit, 'BHwe', 20.00)
        call FogMaskEnable(false)
        call FogEnable(false)
        call YDLocal1ArraySet(destructable, "火炬", 1,gg_dest_ITf3_0001)
        call YDLocal1ArraySet(destructable, "火炬", 2,gg_dest_ITf3_0343)
        call YDLocal1ArraySet(destructable, "火炬", 3,gg_dest_ITf3_0339)
        call YDLocal1ArraySet(destructable, "火炬", 4,gg_dest_ITf3_0347)
        set udg_HerosAltar[1] = gg_unit_uaod_0091
        set udg_HerosAltar[2] = gg_unit_uaod_0092
        set udg_HerosAltar[3] = gg_unit_uaod_0093
        set udg_HerosAltar[4] = gg_unit_uaod_0094
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = 4
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            set udg_player = ConvertedPlayer(bj_forLoopAIndex)
            if ((GetPlayerSlotState(udg_player) == PLAYER_SLOT_STATE_PLAYING) and (GetPlayerController(udg_player) == MAP_CONTROL_USER)) then
                set udg_point = GetUnitLoc(udg_HerosAltar[bj_forLoopAIndex])
                set udg_point2 = PolarProjectionBJ(udg_point, 250.00, YDWER2Deg(YDWEOperatorReal3(140.00, +, 180.00, *, I2R(bj_forLoopAIndex))))
                set udg_Heros[bj_forLoopAIndex] = CreateUnitAtLoc(udg_player, 'U000', udg_point2, OperatorDegreeAdd(AngleUtoL(udg_unit, udg_point, false) * bj_RADTODEG, 180.00))
                set udg_hero = udg_Heros[bj_forLoopAIndex]
                set udg_HerosSetting[bj_forLoopAIndex] = CreateUnit(udg_player, 'Udre', 0, 0, 0)
                call ShowUnit(udg_HerosSetting[bj_forLoopAIndex], false)
                call AroundUwithU(udg_HerosSetting[bj_forLoopAIndex],udg_Heros[bj_forLoopAIndex],0,0,9999)
                set udg_posNextMove[bj_forLoopAIndex] = GetUnitLoc(udg_hero)
                set udg_flagLockCamera[bj_forLoopAIndex] = true
                call SetUnitTimeScale(udg_hero, 5.00)
                call SetUnitAnimation(udg_hero, "death")
                call TriggerRegisterUnitEvent(gg_trg_blood_bedmg, udg_hero, EVENT_UNIT_DAMAGED)
                call TriggerRegisterUnitEvent(gg_trg_moveFix_1, udg_hero, EVENT_UNIT_ISSUED_POINT_ORDER)
                call TriggerRegisterUnitEvent(gg_trg_moveFix_2, udg_hero, EVENT_UNIT_SELL)
                call TriggerRegisterUnitEvent(gg_trg_moveFix_2, udg_hero, EVENT_UNIT_SPELL_ENDCAST)
                call TriggerRegisterUnitEvent(gg_trg_reward_refresh, udg_hero, EVENT_UNIT_SPELL_EFFECT)
                call GroupAddUnit(udg_groupHero, udg_hero)
                call SetPlayerAlliance(Player(PLAYER_NEUTRAL_PASSIVE), udg_player, ALLIANCE_SHARED_ADVANCED_CONTROL, true)
                call SetPlayerStateBJ(udg_player, PLAYER_STATE_RESOURCE_FOOD_CAP, 30)
                call SetPlayerStateBJ(udg_player, PLAYER_STATE_RESOURCE_FOOD_USED, 60)
                call SetPlayerAlliance(Player(PLAYER_NEUTRAL_PASSIVE), udg_player, ALLIANCE_SHARED_VISION, true)
                set udg_intItemCDLoop = 1
                loop
                    exitwhen udg_intItemCDLoop > 6
                    call UnitAddAbility(udg_hero, 'bke0' + udg_intItemCDLoop)
                    set udg_intItemCDLoop = udg_intItemCDLoop + 1
                endloop
                set udg_maxPlayer = (udg_maxPlayer + 1)
                call RemoveLocation(udg_point)
                call RemoveLocation(udg_point2)
            else
                set udg_Heros[bj_forLoopAIndex] = null
            endif
            set udg_rectNowRefresh[bj_forLoopAIndex] = gg_rct_BarMap_2
            set udg_rectResetRefresh[bj_forLoopAIndex] = gg_rct_Bar_2
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
        set udg_armyMax = YDWEOperatorInt3(8, +, udg_maxPlayer, *, 2)
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, integer, "n", 1)
        call YDLocalSet(ydl_timer, unit, "unit", udg_unit)
        call YDLocalSet(ydl_timer, destructable, "火炬", YDLocal1Get(destructable, "火炬"))
        call TimerStart(ydl_timer, 1.20, true, function Trig_initFunc001Func033T)
        set bj_forLoopAIndex = 5
        set bj_forLoopAIndexEnd = 12
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            set udg_player = ConvertedPlayer(OperatorIntegerAdd(bj_forLoopAIndex, 0))
            call CreateFogModifierRectBJ(true, udg_player, FOG_OF_WAR_VISIBLE, GetPlayableMapRect())
            call SetPlayerColor(udg_player, PLAYER_COLOR_YELLOW)
            call SetPlayerName(udg_player, "烈阳军")
            call SetPlayerAlliance(udg_player, Player(PLAYER_NEUTRAL_AGGRESSIVE), ALLIANCE_PASSIVE, true)
            call SetPlayerAlliance(Player(PLAYER_NEUTRAL_AGGRESSIVE), udg_player, ALLIANCE_PASSIVE, true)
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
    else
    endif
    if ((GetTriggerExecCount(GetTriggeringTrigger()) == 2)) then
        call ModifyGateBJ(bj_GATEOPERATION_OPEN, gg_dest_LTg2_1784)
        call ModifyGateBJ(bj_GATEOPERATION_OPEN, gg_dest_ZTg2_1903)
        call WaygateActivateBJ(true, gg_unit_nwgt_0024)
        call WaygateSetDestination(gg_unit_nwgt_0024, GetUnitX(gg_unit_nwgt_0025), GetUnitY(gg_unit_nwgt_0025))
        call WaygateActivateBJ(true, gg_unit_nwgt_0025)
        call WaygateSetDestination(gg_unit_nwgt_0025, GetUnitX(gg_unit_nwgt_0024), GetUnitY(gg_unit_nwgt_0024))
        call DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, 30, udg_strGameMode[udg_GameMode])
        call TriggerExecute(gg_trg_bossRect)
        call TriggerExecute(gg_trg_setting)
        call talentCreate()
        call ResetToGameCamera(5.00)
    else
    endif
    if ((GetTriggerExecCount(GetTriggeringTrigger()) == 6)) then
        call Debug("map seed="+I2S(intMapSeed))
        call PlaySoundBJ(gg_snd_Show_TheNightBecame)
        call FogMaskEnable(true)
        call FogEnable(true)
        call CinematicModeExBJ(false, GetPlayersAll(), 1.00)
        call ForGroupBJ(udg_groupHero, function Trig_initFunc003Func007A)
        call CameraSetSmoothingFactor(3.00)
        call SetCameraTargetController(gg_unit_uaco_0095, 0, 0, false)
        call TriggerRegisterTimerEventPeriodic(gg_trg_score, 0.03)
        call Debug("游戏载入成功===============")
        call Debug("玩家人数："+I2S(udg_maxPlayer))
        call Debug("可使用的装备数量："+I2S(udg_itemListNum))
    else
    endif
    if ((GetTriggerExecCount(GetTriggeringTrigger()) == 7)) then
        call AddSpecialEffectTargetUnitBJ("overhead", gg_unit_ugrv_0027, "Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl")
        call AddSpecialEffectTargetUnitBJ("overhead", gg_unit_usap_0002, "Abilities\\Spells\\Undead\\Darksummoning\\DarkSummonTarget.mdl")
        call DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, 30, "|cffffcc00[系统]|r在英雄面板上，选择你的初始装备！")
        call TransmissionFromUnitWithNameBJ(GetPlayersAll(), gg_unit_uaco_0095, "眷属", null, "白昼行将遁去，夜幕降临，猎杀时刻到来了", bj_TIMETYPE_ADD, 13.00, false)
    else
    endif
    if ((GetTriggerExecCount(GetTriggeringTrigger()) == 22)) then
        call CinematicFilterGenericBJ(4.00, BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\Black_mask.blp", 0.00, 0.00, 0.00, 80.00, 0, 0, 0, 0.00)
        call ForGroupBJ(udg_groupHero, function Trig_initFunc005Func002A)
    else
    endif
    if ((GetTriggerExecCount(GetTriggeringTrigger()) == 25)) then
        call CinematicFilterGenericBJ(2.00, BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\Black_mask.blp", 0.00, 0.00, 0.00, 0.00, 0, 0, 0, 100.00)
        call CameraSetupApplyForceDuration(gg_cam_Camera_001, true, 0.00)
        call CreateFogModifierRectBJ(true, udg_player, FOG_OF_WAR_VISIBLE, gg_rct_center)
        call ForGroupBJ(udg_groupHero, function Trig_initFunc006Func004A)
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = 4
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            call ShowUnit(udg_HerosAltar[bj_forLoopAIndex], false)
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
    else
    endif
    if ((GetTriggerExecCount(GetTriggeringTrigger()) == 27)) then
        call TriggerRegisterTimerEventPeriodic(gg_trg_camera, 0.01)
        call TriggerRegisterTimerEventPeriodic(gg_trg_ItemCD, 0.01)
        call ForGroupBJ(udg_groupHero, function Trig_initFunc007Func003A)
    else
    endif
    if ((GetTriggerExecCount(GetTriggeringTrigger()) == 30)) then
        set udg_overTime = 30.00
        call SetTimeOfDay(18.00)
        call StartTimerBJ(udg_systemTimer, true, 1.00)
        call EnableTrigger(gg_trg_refresh)
        call DestroyTrigger(GetTriggeringTrigger())
    else
    endif
    call YDLocal1Release()
    set ydl_timer = null
    set ydl_group = null
    set ydl_unit = null
endfunction

//===========================================================================
function InitTrig_init takes nothing returns nothing
    set gg_trg_init = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_init, "init")
#endif
    call TriggerAddAction(gg_trg_init, function Trig_initActions)
endfunction

//===========================================================================
// Trigger: Time
//===========================================================================
function Trig_TimeActions takes nothing returns nothing
    set udg_gameTime = OperatorIntegerAdd(udg_gameTime, 1)
    set udg_gameTime_sec = OperatorIntegerAdd(udg_gameTime_sec, 1)
    if ((ModuloInteger(udg_gameTime, 60) == 0)) then
        set udg_gameTime_min = OperatorIntegerAdd(udg_gameTime_min, 1)
        set udg_gameTime_sec = 0
    else
    endif
    if ((ModuloInteger(udg_gameTime, 240) == 0) and (udg_armyLevel < udg_armyTypeTotal)) then
        set udg_armyLevel = OperatorIntegerAdd(udg_armyLevel, 1)
    else
    endif
    if ((ModuloInteger(udg_gameTime, 120) == 0) and (udg_gameTime_min < 21) and (udg_bossLevel < udg_bossTypeTotal)) then
        set udg_flagRefreshBoss = udg_maxPlayer
        set udg_bossNowType = udg_bossType[udg_bossLevel]
    else
    endif
    if ((ModuloInteger(udg_gameTime, 240) == 0) and (udg_gameTime_min < 21) and (udg_bossLevel < udg_bossTypeTotal)) then
        set udg_bossLevel = OperatorIntegerAdd(udg_bossLevel, 1)
    else
    endif
    if ((udg_gameTime == (25 * 60))) then
        set udg_flagRefreshBoss = 1
        set udg_bossNowType = udg_bossFinalType[GetRandomInt(0, 6)]
        set udg_armyMax = 3
    else
    endif
    if ((udg_gameTime_min >= 30)) then
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = udg_maxPlayer
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            call UnitDamageTarget(udg_Heros[bj_forLoopAIndex], udg_Heros[bj_forLoopAIndex], 200.00, true, false, ATTACK_TYPE_HERO, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
            call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Undead\\UndeadDissipate\\UndeadDissipate.mdl", udg_Heros[bj_forLoopAIndex], "origin"))
            call CinematicFilterGenericBJ(5.00, BLEND_MODE_BLEND, "ReplaceableTextures\\CameraMasks\\DreamFilter_Mask.blp", 30.00, 30.00, 30.00, 50.00, 100.00, 100.00, 0.00, 0)
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
    else
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = udg_maxPlayer
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            call SetPlayerStateBJ(ConvertedPlayer(bj_forLoopAIndex), PLAYER_STATE_RESOURCE_FOOD_USED, udg_gameTime_min)
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
        set udg_str = YDWEOperatorString3("|cffffcc00距离日出还剩下：", (I2S((29 - udg_gameTime_min)) + "分："), (I2S((59 - udg_gameTime_sec)) + "秒"))
        call MultiboardSetTitleText(udg_gameBorad, udg_str)
    endif
endfunction

//===========================================================================
function InitTrig_Time takes nothing returns nothing
    set gg_trg_Time = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_Time, "Time")
#endif
    call TriggerRegisterTimerExpireEvent(gg_trg_Time, udg_systemTimer)
    call TriggerAddAction(gg_trg_Time, function Trig_TimeActions)
endfunction

//===========================================================================
// Trigger: camera
//===========================================================================
function Trig_cameraActions takes nothing returns nothing
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = udg_maxPlayer
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        set udg_point = GetUnitLoc(udg_Heros[bj_forLoopAIndex])
        set udg_player = ConvertedPlayer(bj_forLoopAIndex)
        call SetCameraQuickPositionLocForPlayer(udg_player, udg_point)
        if ((RectContainsLoc(gg_rct_SpcSnow, udg_point) == true)) then
            set udg_real = 3000.00
        else
            set udg_real = RMaxBJ(2100.00, YDWEOperatorReal3(1800.00, +, GetLocationZ(udg_point), *, 0.60))
        endif
        if ((GetCameraField(CAMERA_FIELD_TARGET_DISTANCE) < udg_real)) then
            call SetCameraFieldForPlayer(udg_player, CAMERA_FIELD_TARGET_DISTANCE, (GetCameraField(CAMERA_FIELD_TARGET_DISTANCE) + 1.00), 0.00)
        else
        endif
        set udg_real = 0.00
        call RemoveLocation(udg_point)
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
endfunction

//===========================================================================
function InitTrig_camera takes nothing returns nothing
    set gg_trg_camera = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_camera, "camera")
#endif
    call TriggerAddAction(gg_trg_camera, function Trig_cameraActions)
endfunction

//===========================================================================
// Trigger: gameOver
//===========================================================================
function Trig_gameOverConditions takes nothing returns boolean
    return ((IsUnitInGroup(GetTriggerUnit(), udg_groupHero) == true))
endfunction

function Trig_gameOverFunc004Func007T takes nothing returns nothing
    call YDLocalSet(GetExpiredTimer(), real, "c", RMinBJ(3.00, (YDLocalGet(GetExpiredTimer(), real, "c") + 0.05)))
    call SetUnitScale(YDLocalGet(GetExpiredTimer(), unit, "GetKillingUnit"), YDLocalGet(GetExpiredTimer(), real, "c"), YDLocalGet(GetExpiredTimer(), real, "c"), YDLocalGet(GetExpiredTimer(), real, "c"))
endfunction

function Trig_gameOverFunc006Func002Func001A takes nothing returns nothing
    call RemoveUnit(GetEnumUnit())
endfunction

function Trig_gameOverFunc006Func004T takes nothing returns nothing
    call saveGameOver()
endfunction

function Trig_gameOverActions takes nothing returns nothing
    local timer ydl_timer
    local group ydl_group
    local unit ydl_unit
    YDLocalInitialize()
    call GroupRemoveUnit(udg_groupHero, GetTriggerUnit())
    call GroupAddUnit(udg_groupDeath, GetTriggerUnit())
    if ((GetTriggerUnit() == GetKillingUnitBJ())) then
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, YDWEOperatorString3("你被|cffaa5555", "太阳", "|r打败了！"))
    else
        call DisplayTextToPlayer(GetLocalPlayer(), 0, 0, YDWEOperatorString3("有一位吸血鬼被|cffaa5555", GetUnitName(GetKillingUnitBJ()), "|r打败了！"))
        if ((udg_maxPlayer > 0)) then
            call DisplayTextToPlayer(GetLocalPlayer(), 0, 0, "其他的吸血鬼们可以尝试在出生墓地的复活石像前点击石像来复活他...")
        else
        endif
        set udg_flagLockCamera[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] = false
        call ResetToGameCameraForPlayer(GetOwningPlayer(GetTriggerUnit()), 0)
    endif
    if ((IsUnitType(GetKillingUnitBJ(), UNIT_TYPE_TAUREN) == false)) then
        call PauseUnit(GetKillingUnitBJ(), true)
        call SetUnitInvulnerable(GetKillingUnitBJ(), true)
        call SetUnitFacingTimed(GetKillingUnitBJ(), 270.00, 0.50)
        call SetUnitAnimation(GetKillingUnitBJ(), "victory")
        call AddSpecialEffectTargetUnitBJ("overhead", GetKillingUnitBJ(), "Abilities\\Spells\\Other\\SoulBurn\\SoulBurnbuff.mdl")
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, real, "c", 1.00)
        call YDLocalSet(ydl_timer, unit, "GetKillingUnit", GetKillingUnit())
        call TimerStart(ydl_timer, 0.10, true, function Trig_gameOverFunc004Func007T)
    else
    endif
    call GroupRemoveUnit(udg_groupArmy[GetConvertedPlayerId(GetOwningPlayer(GetKillingUnitBJ()))], GetKillingUnitBJ())
    if ((CountUnitsInGroup(udg_groupHero) == 0)) then
        call DisplayTextToPlayer(GetLocalPlayer(), 0, 0, "游戏结束！！！！！！！！！！！！！！")
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = 8
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            call ForGroupBJ(udg_groupArmy[bj_forLoopAIndex], function Trig_gameOverFunc006Func002Func001A)
            call DisableTrigger(gg_trg_refresh)
            call DisableTrigger(gg_trg_Time)
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
        call CinematicModeExBJ(true, GetPlayersAll(), 1.00)
        set ydl_timer = CreateTimer()
        call TimerStart(ydl_timer, 3.00, false, function Trig_gameOverFunc006Func004T)
    else
    endif
    call YDLocal1Release()
    set ydl_timer = null
    set ydl_group = null
    set ydl_unit = null
endfunction

//===========================================================================
function InitTrig_gameOver takes nothing returns nothing
    set gg_trg_gameOver = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_gameOver, "gameOver")
#endif
    call TriggerRegisterAnyUnitEventBJ(gg_trg_gameOver, EVENT_PLAYER_UNIT_DEATH)
    call TriggerAddCondition(gg_trg_gameOver, Condition(function Trig_gameOverConditions))
    call TriggerAddAction(gg_trg_gameOver, function Trig_gameOverActions)
endfunction

//===========================================================================
// Trigger: dropItem
//===========================================================================
function Trig_dropItemConditions takes nothing returns boolean
    return ((GetItemType(GetManipulatedItem()) == ITEM_TYPE_POWERUP))
endfunction

function Trig_dropItemActions takes nothing returns nothing
    call SetWidgetLife(GetManipulatedItem(), 50)
    call YDWETimerRemoveItem(0.10, GetManipulatedItem())
endfunction

//===========================================================================
function InitTrig_dropItem takes nothing returns nothing
    set gg_trg_dropItem = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_dropItem, "dropItem")
#endif
    call TriggerRegisterAnyUnitEventBJ(gg_trg_dropItem, EVENT_PLAYER_UNIT_DROP_ITEM)
    call TriggerAddCondition(gg_trg_dropItem, Condition(function Trig_dropItemConditions))
    call TriggerAddAction(gg_trg_dropItem, function Trig_dropItemActions)
endfunction

//===========================================================================
// Trigger: getItem
//===========================================================================
function Trig_getItemActions takes nothing returns nothing
    if ((GetItemType(GetManipulatedItem()) == ITEM_TYPE_ARTIFACT)) then
        call DisplayTimedTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, 30, YDWEOperatorString3("获得了[", GetItemName(GetManipulatedItem()), "]!!!!!!!"))
    else
        call itemLevelUp(GetTriggerUnit(), GetManipulatedItem())
    endif
endfunction

//===========================================================================
function InitTrig_getItem takes nothing returns nothing
    set gg_trg_getItem = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_getItem, "getItem")
#endif
    call TriggerRegisterAnyUnitEventBJ(gg_trg_getItem, EVENT_PLAYER_UNIT_PICKUP_ITEM)
    call TriggerAddAction(gg_trg_getItem, function Trig_getItemActions)
endfunction

//===========================================================================
// Trigger: smart-Jass
//===========================================================================
//TESH.scrollpos=0
//TESH.alwaysfold=0
function Trig_smartConditions takes nothing returns boolean
    return ((GetSpellAbilityId() == 'A00V'))
endfunction

function Trig_smartActions takes nothing returns nothing
    local integer id = GetPlayerId(GetOwningPlayer(GetTriggerUnit()))+1
    call Debug("smart-"+U2S(GetTriggerUnit())+"|target="+U2S(GetSpellTargetUnit())+T2S(GetSpellTargetItem()))
    if GetSpellTargetUnit() != null then
        call MoveLocation(udg_posNextMove[id], GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit()))
        call smartUnit(GetTriggerUnit(),GetSpellTargetUnit())
    elseif GetSpellTargetItem() != null then
        call MoveLocation(udg_posNextMove[id], GetItemX(GetSpellTargetItem()), GetItemY(GetSpellTargetItem()))
        call smartChange(GetTriggerUnit(), GetSpellTargetItem())
    endif
endfunction

//===========================================================================
function InitTrig_smart_Jass takes nothing returns nothing
    set gg_trg_smart_Jass = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_smart_Jass, "smart")
#endif
    call TriggerRegisterAnyUnitEventBJ(gg_trg_smart_Jass, EVENT_PLAYER_UNIT_SPELL_EFFECT)
    call TriggerAddCondition(gg_trg_smart_Jass, Condition(function Trig_smartConditions))
    call TriggerAddAction(gg_trg_smart_Jass, function Trig_smartActions)
endfunction

//===========================================================================
// Trigger: bossRect
//===========================================================================
function Trig_bossRectFunc034Func012T takes nothing returns nothing
    call SetUnitTimeScale(YDLocalGet(GetExpiredTimer(), unit, "tarGate"), 0.00)
endfunction

function Trig_bossRectFunc034Func014Func015T takes nothing returns nothing
    call DestroyEffect(AddSpecialEffectLoc("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", YDLocalGet(GetExpiredTimer(), location, "geteTar")))
    call DestroyEffect(YDLocalGet(GetExpiredTimer(), effect, "eff"))
endfunction

function Trig_bossRectFunc034Func014Conditions takes nothing returns nothing
    local timer ydl_timer
    call DestroyTimer(YDLocalGet(GetTriggeringTrigger(), timer, "insTimer"))
    call YDLocalSet(GetTriggeringTrigger(), unit, "gate", CreateUnit(Player(PLAYER_NEUTRAL_PASSIVE), 'nwgt', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), YDWEAngleBetweenUnits(GetTriggerUnit(), GetKillingUnitBJ())))
    call SetUnitAnimation(YDLocalGet(GetTriggeringTrigger(), unit, "gate"), "birth")
    call WaygateActivateBJ(true, YDLocalGet(GetTriggeringTrigger(), unit, "gate"))
    call WaygateSetDestinationLocBJ(YDLocalGet(GetTriggeringTrigger(), unit, "gate"), YDLocalGet(GetTriggeringTrigger(), location, "gateTar"))
    call YDLocalSet(GetTriggeringTrigger(), degree, "gateFacing", GetUnitFacing(YDLocalGet(GetTriggeringTrigger(), unit, "tarGate")))
    call RemoveUnit(YDLocalGet(GetTriggeringTrigger(), unit, "tarGate"))
    call YDLocalSet(GetTriggeringTrigger(), unit, "tarGate", CreateUnitAtLoc(Player(PLAYER_NEUTRAL_PASSIVE), 'nwgt', YDLocalGet(GetTriggeringTrigger(), location, "gateTar"), YDLocalGet(GetTriggeringTrigger(), degree, "gateFacing")))
    call SetUnitAnimation(YDLocalGet(GetTriggeringTrigger(), unit, "tarGate"), "birth")
    call WaygateActivateBJ(true, YDLocalGet(GetTriggeringTrigger(), unit, "tarGate"))
    call WaygateSetDestination(YDLocalGet(GetTriggeringTrigger(), unit, "tarGate"), GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()))
    set ydl_timer = CreateTimer()
    call YDLocalSet(ydl_timer, effect, "eff", AddSpecialEffectLoc("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", YDLocalGet(GetTriggeringTrigger(), location, "gateTar")))
    call YDLocalSet(ydl_timer, location, "gateTar", YDLocalGet(GetTriggeringTrigger(), location, "geteTar"))
    call YDLocalSet(ydl_timer, unit, "gate", YDLocalGet(GetTriggeringTrigger(), unit, "gate"))
    call YDLocalSet(ydl_timer, location, "geteTar", YDLocalGet(GetTriggeringTrigger(), location, "geteTar"))
    call TimerStart(ydl_timer, 9.00, false, function Trig_bossRectFunc034Func014Func015T)
    call YDLocal4Release()
    call DestroyTrigger(GetTriggeringTrigger())
    set ydl_timer = null
endfunction

function Trig_bossRectFunc035Conditions takes nothing returns nothing
    set udg_dummy = GetSoldUnit()
    set udg_int = GetUnitTypeId(udg_dummy) - 'ubi0'
    if ((udg_bossRects[udg_int] != null)) then
        set udg_intBossInsTar[GetConvertedPlayerId(GetOwningPlayer(udg_dummy))] = udg_int
    else
    endif
    call DisplayTimedTextToPlayer(GetOwningPlayer(udg_hero), 0, 0, 30, YDWEOperatorString3("准备开始追踪[", GetUnitName(udg_bossRects[udg_int]), "]"))
    call RemoveUnit(udg_dummy)
endfunction

function Trig_bossRectActions takes nothing returns nothing
    local timer ydl_timer
    local trigger ydl_trigger
    YDLocalInitialize()
    call YDLocal1ArraySet(location, "bossPos", 1,GetRectCenter(gg_rct_Boss_1))
    call YDLocal1ArraySet(location, "bossPos", 2,GetRectCenter(gg_rct_Boss_2))
    call YDLocal1ArraySet(location, "bossPos", 3,GetRectCenter(gg_rct_Boss_3))
    call YDLocal1ArraySet(location, "bossPos", 4,GetRectCenter(gg_rct_Boss_4))
    call YDLocal1ArraySet(location, "bossPos", 5,GetRectCenter(gg_rct_Boss_5))
    call YDLocal1ArraySet(location, "bossPos", 6,GetRectCenter(gg_rct_Boss_6))
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 6
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        set udg_posRectBoss[bj_forLoopAIndex] = YDLocal1ArrayGet(location, "bossPos", bj_forLoopAIndex)
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call YDLocal1ArraySet(unitcode, "bossType", 1,'ur01')
    call YDLocal1ArraySet(unitcode, "bossType", 2,'ur02')
    call YDLocal1ArraySet(unitcode, "bossType", 3,'ur03')
    call YDLocal1ArraySet(unitcode, "bossType", 4,'ur04')
    call YDLocal1ArraySet(unitcode, "bossType", 5,'ur05')
    call YDLocal1ArraySet(unitcode, "bossType", 6,'ur06')
    call YDLocal1ArraySet(unit, "enterGate", 1,gg_unit_nwgt_0059)
    call YDLocal1ArraySet(unit, "enterGate", 2,gg_unit_nwgt_0058)
    call YDLocal1ArraySet(unit, "enterGate", 3,gg_unit_nwgt_0057)
    call YDLocal1ArraySet(unit, "enterGate", 4,gg_unit_nwgt_0062)
    call YDLocal1ArraySet(unit, "enterGate", 5,gg_unit_nwgt_0061)
    call YDLocal1ArraySet(unit, "enterGate", 6,gg_unit_nwgt_0060)
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 6
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        set udg_posFristGate[bj_forLoopAIndex] = GetUnitLoc(YDLocal1ArrayGet(unit, "enterGate", bj_forLoopAIndex))
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call YDLocal1ArraySet(unit, "passWay", 11,gg_unit_nech_0063)
    call YDLocal1ArraySet(unit, "passWay", 12,gg_unit_nech_0064)
    call YDLocal1ArraySet(unit, "passWay", 21,gg_unit_nech_0071)
    call YDLocal1ArraySet(unit, "passWay", 22,gg_unit_nech_0072)
    call YDLocal1ArraySet(unit, "passWay", 31,gg_unit_nech_0065)
    call YDLocal1ArraySet(unit, "passWay", 32,gg_unit_nech_0066)
    call YDLocal1ArraySet(unit, "passWay", 41,gg_unit_nech_0067)
    call YDLocal1ArraySet(unit, "passWay", 42,gg_unit_nech_0068)
    call YDLocal1ArraySet(unit, "passWay", 51,gg_unit_nech_0069)
    call YDLocal1ArraySet(unit, "passWay", 52,gg_unit_nech_0026)
    call YDLocal1ArraySet(unit, "passWay", 61,gg_unit_nech_0069)
    call YDLocal1ArraySet(unit, "passWay", 62,gg_unit_nech_0070)
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 6
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        set bj_forLoopBIndex = 1
        set bj_forLoopBIndexEnd = 2
        loop
            exitwhen bj_forLoopBIndex > bj_forLoopBIndexEnd
            set udg_posPassWay[YDWEOperatorInt3(bj_forLoopAIndex, *, 10, +, bj_forLoopBIndex)] = GetUnitLoc(YDLocal1ArrayGet(unit, "passWay", YDWEOperatorInt3(bj_forLoopAIndex, *, 10, +, bj_forLoopBIndex)))
            set bj_forLoopBIndex = bj_forLoopBIndex + 1
        endloop
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 6
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        set udg_bossRects[bj_forLoopAIndex] = CreateUnitAtLoc(Player(PLAYER_NEUTRAL_AGGRESSIVE), YDLocal1ArrayGet(unitcode, "bossType", bj_forLoopAIndex), udg_posRectBoss[bj_forLoopAIndex], GetRandomDirectionDeg())
        call UnitAddAbility(udg_bossRects[bj_forLoopAIndex], 'AId1')
        if ((udg_GameMode >= 3)) then
            call UnitAddAbility(udg_bossRects[bj_forLoopAIndex], 'AItx')
        else
        endif
        if ((udg_GameMode >= 4)) then
            call UnitAddAbility(udg_bossRects[bj_forLoopAIndex], 'AIsr')
        else
        endif
        call UnitAddType(udg_bossRects[bj_forLoopAIndex], UNIT_TYPE_TAUREN)
        call TriggerRegisterUnitEvent(gg_trg_reward_bossRect, udg_bossRects[bj_forLoopAIndex], EVENT_UNIT_DEATH)
        call YDUserDataSet(unit, udg_bossRects[bj_forLoopAIndex], "id", integer, bj_forLoopAIndex)
        call YDLocal1Set(timer, "insTimer", CreateTimer())
        call WaygateActivateBJ(false, YDLocal1ArrayGet(unit, "enterGate", bj_forLoopAIndex))
        call UnitAddAbility(YDLocal1ArrayGet(unit, "enterGate", bj_forLoopAIndex), 'Aloc')
        call SetUnitAnimation(YDLocal1ArrayGet(unit, "enterGate", bj_forLoopAIndex), "birth")
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, unit, "tarGate", YDLocal1ArrayGet(unit, "enterGate", bj_forLoopAIndex))
        call TimerStart(ydl_timer, 0.01, false, function Trig_bossRectFunc034Func012T)
        call YDLocal1Set(unit, "boss", udg_bossRects[bj_forLoopAIndex])
        set ydl_trigger = CreateTrigger()
        call YDLocalSet(ydl_trigger, location, "gateTar", udg_posFristGate[bj_forLoopAIndex])
        call YDLocalSet(ydl_trigger, unit, "tarGate", YDLocal1ArrayGet(unit, "enterGate", bj_forLoopAIndex))
        call YDLocalSet(ydl_trigger, timer, "insTimer", YDLocal1Get(timer, "insTimer"))
        call YDLocalSet(ydl_trigger, unit, "gate", YDLocal1Get(unit, "gate"))
        call YDLocalSet(ydl_trigger, degree, "gateFacing", YDLocal1Get(degree, "gateFacing"))
        call YDLocalSet(ydl_trigger, location, "geteTar", YDLocal1Get(location, "geteTar"))
        call TriggerRegisterUnitEvent(ydl_trigger, YDLocal1Get(unit, "boss"), EVENT_UNIT_DEATH)
        call TriggerAddCondition(ydl_trigger, Condition(function Trig_bossRectFunc034Func014Conditions))
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    set ydl_trigger = CreateTrigger()
    call TriggerRegisterUnitEvent(ydl_trigger, gg_unit_ugrv_0027, EVENT_UNIT_SELL)
    call TriggerAddCondition(ydl_trigger, Condition(function Trig_bossRectFunc035Conditions))
    call TriggerRegisterTimerEventPeriodic(gg_trg_bossIns, 5.00)
    call YDLocal1Release()
    set ydl_timer = null
    set ydl_trigger = null
endfunction

//===========================================================================
function InitTrig_bossRect takes nothing returns nothing
    set gg_trg_bossRect = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_bossRect, "bossRect")
#endif
    call TriggerAddAction(gg_trg_bossRect, function Trig_bossRectActions)
endfunction

//===========================================================================
// Trigger: bossIns
//===========================================================================
function Trig_bossInsActions takes nothing returns nothing
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 4
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        if ((udg_intBossInsTar[bj_forLoopAIndex] > 0)) then
            set udg_dummy = CreateUnit(ConvertedPlayer(bj_forLoopAIndex), 'ushd', GetUnitX(gg_unit_ugrv_0027), GetUnitY(gg_unit_ugrv_0027), 0)
            call addBossIns(udg_dummy, udg_intBossInsTar[bj_forLoopAIndex])
        else
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
endfunction

//===========================================================================
function InitTrig_bossIns takes nothing returns nothing
    set gg_trg_bossIns = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_bossIns, "bossIns")
#endif
    call TriggerAddAction(gg_trg_bossIns, function Trig_bossInsActions)
endfunction

//===========================================================================
// Trigger: moveFix-1
//===========================================================================
function Trig_moveFix_1Actions takes nothing returns nothing
    set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
    call MoveLocation(udg_posNextMove[udg_int], GetOrderPointX(), GetOrderPointY())
endfunction

//===========================================================================
function InitTrig_moveFix_1 takes nothing returns nothing
    set gg_trg_moveFix_1 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_moveFix_1, "moveFix-1")
#endif
    call TriggerAddAction(gg_trg_moveFix_1, function Trig_moveFix_1Actions)
endfunction

//===========================================================================
// Trigger: moveFix-2
//===========================================================================
function Trig_moveFix_2Actions takes nothing returns nothing
    set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
    set udg_hero = GetTriggerUnit()
    if ((DistanceUtoL(udg_hero, udg_posNextMove[udg_int]) > 50.00)) then
        call IssuePointOrderLoc(udg_hero, "move", udg_posNextMove[udg_int])
    else
    endif
endfunction

//===========================================================================
function InitTrig_moveFix_2 takes nothing returns nothing
    set gg_trg_moveFix_2 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_moveFix_2, "moveFix-2")
#endif
    call TriggerAddAction(gg_trg_moveFix_2, function Trig_moveFix_2Actions)
endfunction

//===========================================================================
// Trigger: recall
//===========================================================================
function Trig_recallConditions takes nothing returns boolean
    return ((GetSpellAbilityId() == 'AOeq'))
endfunction

function Trig_recallActions takes nothing returns nothing
    set udg_hero = FirstOfGroup(udg_groupDeath)
    call GroupRemoveUnit(udg_groupDeath, udg_hero)
    call GroupAddUnit(udg_groupHero, udg_hero)
    set udg_unit = YDUserDataGet(unit, GetTriggerUnit(), "recall", unit)
    call ReviveHero(udg_hero, GetUnitX(GetTriggerUnit()), (GetUnitY(GetTriggerUnit()) - 175.00), true)
    call SetUnitAnimationByIndex(udg_unit, 1)
    set udg_unit = udg_HerosSetting[GetConvertedPlayerId(GetOwningPlayer(udg_hero))]
    call AroundUwithU(udg_unit,udg_hero, 0, 0, 3600)
endfunction

//===========================================================================
function InitTrig_recall takes nothing returns nothing
    set gg_trg_recall = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_recall, "recall")
#endif
    call TriggerAddCondition(gg_trg_recall, Condition(function Trig_recallConditions))
    call TriggerAddAction(gg_trg_recall, function Trig_recallActions)
endfunction

//===========================================================================
// Trigger: ItemSpell-1
//===========================================================================
function Trig_ItemSpell_1Actions takes nothing returns nothing
    set udg_unitType = 'e000'
    set udg_dummy = createItemDummy(udg_unitType, udg_point)
    call IssueImmediateOrder(udg_dummy, "fanofknives")
endfunction

//===========================================================================
function InitTrig_ItemSpell_1 takes nothing returns nothing
    set gg_trg_ItemSpell_1 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_1, "ItemSpell-1")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_1, function Trig_ItemSpell_1Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-2
//===========================================================================
function Trig_ItemSpell_2Actions takes nothing returns nothing
    set udg_unitType = 'e000'
    set udg_dummy = createItemDummy(udg_unitType, udg_point)
    call IssueImmediateOrder(udg_dummy, "fanofknives")
endfunction

//===========================================================================
function InitTrig_ItemSpell_2 takes nothing returns nothing
    set gg_trg_ItemSpell_2 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_2, "ItemSpell-2")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_2, function Trig_ItemSpell_2Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-3
//===========================================================================
function Trig_ItemSpell_3Actions takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    set udg_unitType = 'e00D'
    set udg_dummy = createItemDummy(udg_unitType, udg_point)
    call UnitApplyTimedLife(udg_dummy, 'BHwe', 1.00)
    set ydl_group = CreateGroup()
    call GroupEnumUnitsInRange(ydl_group, GetLocationX(udg_point), GetLocationY(udg_point), 625.00, null)
    loop
        set ydl_unit = FirstOfGroup(ydl_group)
        exitwhen ydl_unit == null
        call GroupRemoveUnit(ydl_group, ydl_unit)
        if ((IsUnitEnemy(ydl_unit, udg_player) == true) and (IsUnitPausedBJ(ydl_unit) == false) and (IsUnitAliveBJ(ydl_unit) == true)) then
            call IssueTargetOrder(udg_dummy, "chainlightning", ydl_unit)
        else
        endif
    endloop
    call DestroyGroup(ydl_group)
    set ydl_group = null
    set ydl_unit = null
endfunction

//===========================================================================
function InitTrig_ItemSpell_3 takes nothing returns nothing
    set gg_trg_ItemSpell_3 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_3, "ItemSpell-3")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_3, function Trig_ItemSpell_3Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-4
//===========================================================================
function Trig_ItemSpell_4Func005T takes nothing returns nothing
    set udg_point2 = PolarProjectionBJ(YDLocalGet(GetExpiredTimer(), location, "point"), GetRandomReal(325.00, 450.00), YDWER2Deg(YDWEOperatorReal3(YDLocalGet(GetExpiredTimer(), real, "sang"), +, YDLocalGet(GetExpiredTimer(), real, "ang"), *, I2R(YDLocalGet(GetExpiredTimer(), integer, "n")))))
    call IssuePointOrderLoc(YDLocalGet(GetExpiredTimer(), unit, "dummy"), "flamestrike", udg_point2)
    call RemoveLocation(udg_point2)
    call YDLocalSet(GetExpiredTimer(), integer, "n", (YDLocalGet(GetExpiredTimer(), integer, "n") - 1))
    if ((YDLocalGet(GetExpiredTimer(), integer, "n") == 0)) then
        call RemoveLocation(YDLocalGet(GetExpiredTimer(), location, "point"))
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
    endif
endfunction

function Trig_ItemSpell_4Actions takes nothing returns nothing
    local timer ydl_timer
    YDLocalInitialize()
    set udg_unitType = 'e00D'
    set udg_dummy = createItemDummy(udg_unitType, udg_point)
    call UnitApplyTimedLife(udg_dummy, 'BHwe', 5.00)
    call YDUserDataSet(item, udg_item, "pause", real, 4.00)
    set ydl_timer = CreateTimer()
    call YDLocalSet(ydl_timer, unit, "dummy", udg_dummy)
    call YDLocalSet(ydl_timer, location, "point", GetUnitLoc(udg_dummy))
    call YDLocalSet(ydl_timer, integer, "n", udg_itemSpellLevel)
    call YDLocalSet(ydl_timer, real, "ang", (360.00 / I2R(udg_itemSpellLevel)))
    call YDLocalSet(ydl_timer, real, "sang", GetRandomReal(0, 360.00))
    call TimerStart(ydl_timer, 0.10, true, function Trig_ItemSpell_4Func005T)
    call YDLocal1Release()
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_ItemSpell_4 takes nothing returns nothing
    set gg_trg_ItemSpell_4 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_4, "ItemSpell-4")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_4, function Trig_ItemSpell_4Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-5
//===========================================================================
function Trig_ItemSpell_5Actions takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    if ((triType == 'I05K')) then
        set udg_group = CreateGroup()
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = 2
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            set udg_unitType = 'e00D'
            set udg_dummy = createItemDummy(udg_unitType, udg_point)
            call UnitApplyTimedLife(udg_dummy, 'BHwe', 1.00)
            set ydl_group = CreateGroup()
            call GroupEnumUnitsInRange(ydl_group, GetLocationX(udg_point), GetLocationY(udg_point), 750.00, null)
            loop
                set ydl_unit = FirstOfGroup(ydl_group)
                exitwhen ydl_unit == null
                call GroupRemoveUnit(ydl_group, ydl_unit)
                if ((IsUnitEnemy(ydl_unit, udg_player) == true) and (IsUnitPausedBJ(ydl_unit) == false) and (IsUnitAliveBJ(ydl_unit) == true) and (IsUnitInGroup(ydl_unit, udg_group) == false)) then
                    call IssueTargetOrder(udg_dummy, "fingerofdeath", ydl_unit)
                    call addHeal(udg_hero, 2)
                    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\DemonBoltImpact\\DemonBoltImpact.mdl", udg_hero, "origin"))
                    call GroupAddUnit(udg_group, ydl_unit)
                    call DoNothing() YDNL exitwhen true//()
                else
                endif
            endloop
            call DestroyGroup(ydl_group)
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
    else
        set udg_unitType = 'e00D'
        set udg_dummy = createItemDummy(udg_unitType, udg_point)
        call UnitApplyTimedLife(udg_dummy, 'BHwe', 1.00)
        set ydl_group = CreateGroup()
        call GroupEnumUnitsInRange(ydl_group, GetLocationX(udg_point), GetLocationY(udg_point), 750.00, null)
        loop
            set ydl_unit = FirstOfGroup(ydl_group)
            exitwhen ydl_unit == null
            call GroupRemoveUnit(ydl_group, ydl_unit)
            if ((IsUnitEnemy(ydl_unit, udg_player) == true) and (IsUnitPausedBJ(ydl_unit) == false) and (IsUnitAliveBJ(ydl_unit) == true)) then
                call IssueTargetOrder(udg_dummy, "fingerofdeath", ydl_unit)
                call addHeal(udg_hero, 2)
                call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\DemonBoltImpact\\DemonBoltImpact.mdl", udg_hero, "origin"))
                call DoNothing() YDNL exitwhen true//()
            else
            endif
        endloop
        call DestroyGroup(ydl_group)
    endif
    set ydl_group = null
    set ydl_unit = null
endfunction

//===========================================================================
function InitTrig_ItemSpell_5 takes nothing returns nothing
    set gg_trg_ItemSpell_5 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_5, "ItemSpell-5")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_5, function Trig_ItemSpell_5Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-6
//===========================================================================
function Trig_ItemSpell_6Actions takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    set udg_unitType = 'e00D'
    set udg_dummy = createItemDummy(udg_unitType, udg_point)
    call UnitApplyTimedLife(udg_dummy, 'BHwe', 3.00)
    call SetUnitScale(udg_dummy, 1.50, 1.50, 1.50)
    set ydl_group = CreateGroup()
    call GroupEnumUnitsInRange(ydl_group, GetLocationX(udg_point), GetLocationY(udg_point), 675.00, null)
    loop
        set ydl_unit = FirstOfGroup(ydl_group)
        exitwhen ydl_unit == null
        call GroupRemoveUnit(ydl_group, ydl_unit)
        if ((IsUnitEnemy(ydl_unit, udg_player) == true) and (IsUnitPausedBJ(ydl_unit) == false) and (IsUnitAliveBJ(ydl_unit) == true)) then
            call IssueTargetOrder(udg_dummy, "acidbomb", ydl_unit)
        else
        endif
    endloop
    call DestroyGroup(ydl_group)
    set ydl_group = null
    set ydl_unit = null
endfunction

//===========================================================================
function InitTrig_ItemSpell_6 takes nothing returns nothing
    set gg_trg_ItemSpell_6 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_6, "ItemSpell-6")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_6, function Trig_ItemSpell_6Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-7
//===========================================================================
function Trig_ItemSpell_7Actions takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    set udg_unitType = 'e000'
    set udg_dummy = createItemDummy(udg_unitType, udg_point)
    set ydl_group = CreateGroup()
    call GroupEnumUnitsInRange(ydl_group, GetLocationX(udg_point), GetLocationY(udg_point), 450.00, null)
    loop
        set ydl_unit = FirstOfGroup(ydl_group)
        exitwhen ydl_unit == null
        call GroupRemoveUnit(ydl_group, ydl_unit)
        if ((IsUnitEnemy(ydl_unit, udg_player) == true) and (IsUnitPausedBJ(ydl_unit) == false) and (IsUnitAliveBJ(ydl_unit) == true)) then
            set udg_point2 = GetUnitLoc(ydl_unit)
            call DoNothing() YDNL exitwhen true//()
        else
        endif
    endloop
    call DestroyGroup(ydl_group)
    if (             (udg_point2 == null)) then
        set udg_point2 = PolarProjectionBJ(udg_point, 256, GetRandomDirectionDeg())
    else
    endif
    call IssuePointOrderLoc(udg_dummy, "breathoffrost", udg_point2)
    call RemoveLocation(udg_point2)
    set ydl_group = null
    set ydl_unit = null
endfunction

//===========================================================================
function InitTrig_ItemSpell_7 takes nothing returns nothing
    set gg_trg_ItemSpell_7 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_7, "ItemSpell-7")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_7, function Trig_ItemSpell_7Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-8
//===========================================================================
function Trig_ItemSpell_8Actions takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    set udg_unitType = 'e000'
    set udg_dummy = createItemDummy(udg_unitType, udg_point)
    call SetUnitScale(udg_dummy, 1.50, 1.50, 1.50)
    set ydl_group = CreateGroup()
    call GroupEnumUnitsInRange(ydl_group, GetLocationX(udg_point), GetLocationY(udg_point), 750.00, null)
    loop
        set ydl_unit = FirstOfGroup(ydl_group)
        exitwhen ydl_unit == null
        call GroupRemoveUnit(ydl_group, ydl_unit)
        if ((IsUnitEnemy(ydl_unit, udg_player) == true) and (IsUnitPausedBJ(ydl_unit) == false) and (IsUnitAliveBJ(ydl_unit) == true)) then
            set udg_point2 = GetUnitLoc(ydl_unit)
            call DoNothing() YDNL exitwhen true//()
        else
        endif
    endloop
    call DestroyGroup(ydl_group)
    if (             (udg_point2 == null)) then
        set udg_point2 = PolarProjectionBJ(udg_point, 256, GetRandomDirectionDeg())
    else
    endif
    call IssuePointOrderLoc(udg_dummy, "blizzard", udg_point2)
    call RemoveLocation(udg_point2)
    set ydl_group = null
    set ydl_unit = null
endfunction

//===========================================================================
function InitTrig_ItemSpell_8 takes nothing returns nothing
    set gg_trg_ItemSpell_8 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_8, "ItemSpell-8")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_8, function Trig_ItemSpell_8Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-9
//===========================================================================
function Trig_ItemSpell_9Actions takes nothing returns nothing
    set udg_unitType = 'e000'
    set udg_dummy = createItemDummy(udg_unitType, udg_point)
    set udg_point2 = PolarProjectionBJ(udg_point, 256, GetUnitFacing(udg_hero))
    call IssuePointOrderLoc(udg_dummy, "carrionswarm", udg_point2)
    call RemoveLocation(udg_point2)
endfunction

//===========================================================================
function InitTrig_ItemSpell_9 takes nothing returns nothing
    set gg_trg_ItemSpell_9 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_9, "ItemSpell-9")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_9, function Trig_ItemSpell_9Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-10
//===========================================================================
function Trig_ItemSpell_10Actions takes nothing returns nothing
    set udg_unitType = 'e000'
    set udg_dummy = createItemDummy(udg_unitType, udg_point)
    call IssueImmediateOrder(udg_dummy, "fanofknives")
endfunction

//===========================================================================
function InitTrig_ItemSpell_10 takes nothing returns nothing
    set gg_trg_ItemSpell_10 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_10, "ItemSpell-10")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_10, function Trig_ItemSpell_10Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-11
//===========================================================================
function Trig_ItemSpell_11Actions takes nothing returns nothing
    set udg_unitType = 'e00K'
    set udg_dummy = createItemDummy(udg_unitType, udg_point)
    set udg_real = lifeCount(udg_hero, 8)
    call UnitApplyTimedLife(udg_dummy, 'BHwe', udg_real)
    call YDUserDataSet(item, udg_item, "pause", real, udg_real)
    call SetUnitMoveSpeed(udg_dummy, GetUnitMoveSpeed(udg_hero))
    call IssueTargetOrder(udg_dummy, "move", udg_hero)
endfunction

//===========================================================================
function InitTrig_ItemSpell_11 takes nothing returns nothing
    set gg_trg_ItemSpell_11 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_11, "ItemSpell-11")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_11, function Trig_ItemSpell_11Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-12
//===========================================================================
function Trig_ItemSpell_12Actions takes nothing returns nothing
    set udg_unitType = 'e00D'
    set udg_dummy = createItemDummy(udg_unitType, udg_point)
    set udg_real = lifeCount(udg_hero, 4)
    call UnitApplyTimedLife(udg_dummy, 'BHwe', udg_real)
    call YDUserDataSet(item, udg_item, "pause", real, udg_real)
    call SetUnitScale(udg_dummy, 1.50, 1.50, 1.50)
    call IssuePointOrderLoc(udg_dummy, "stampede", udg_point)
endfunction

//===========================================================================
function InitTrig_ItemSpell_12 takes nothing returns nothing
    set gg_trg_ItemSpell_12 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_12, "ItemSpell-12")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_12, function Trig_ItemSpell_12Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-13
//===========================================================================
function Trig_ItemSpell_13Func006T takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    if ((IsUnitAliveBJ(YDLocalGet(GetExpiredTimer(), unit, "dummy")) == true)) then
        set ydl_group = CreateGroup()
        call GroupEnumUnitsInRange(ydl_group, GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy")), GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy")), 150.00, null)
        loop
            set ydl_unit = FirstOfGroup(ydl_group)
            exitwhen ydl_unit == null
            call GroupRemoveUnit(ydl_group, ydl_unit)
            if ((IsUnitEnemy(ydl_unit, GetOwningPlayer(YDLocalGet(GetExpiredTimer(), unit, "dummy"))) == true) and (IsUnitAliveBJ(ydl_unit) == true) and (IsUnitPausedBJ(ydl_unit) == false)) then
                call KillUnit(YDLocalGet(GetExpiredTimer(), unit, "dummy"))
                call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\FragmentationShards\\FragBoomSpawn.mdl", GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy")), GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy"))))
                call YDLocal3Release()
                call DestroyTimer(GetExpiredTimer())
                set ydl_group = null
                set ydl_unit = null
                return
            else
            endif
        endloop
        call DestroyGroup(ydl_group)
    else
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    endif
    set ydl_group = null
    set ydl_unit = null
endfunction

function Trig_ItemSpell_13Actions takes nothing returns nothing
    local timer ydl_timer
    YDLocalInitialize()
    set udg_point2 = PolarProjectionBJ(udg_point, GetRandomReal(150.00, 250.00), GetRandomDirectionDeg())
    set udg_unitType = 'e00S'
    set udg_dummy = createItemDummy(udg_unitType, udg_point2)
    set udg_real = lifeCount(udg_hero, 25)
    call UnitApplyTimedLife(udg_dummy, 'BHwe', udg_real)
    set ydl_timer = CreateTimer()
    call YDLocalSet(ydl_timer, unit, "dummy", udg_dummy)
    call TimerStart(ydl_timer, 0.10, true, function Trig_ItemSpell_13Func006T)
    call RemoveLocation(udg_point2)
    call YDLocal1Release()
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_ItemSpell_13 takes nothing returns nothing
    set gg_trg_ItemSpell_13 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_13, "ItemSpell-13")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_13, function Trig_ItemSpell_13Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-14
//===========================================================================
function Trig_ItemSpell_14Actions takes nothing returns nothing
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 2
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        set udg_point2 = PolarProjectionBJ(udg_point, 800.00, YDWER2Deg(YDWEOperatorReal3(YDWEDeg2R(GetUnitFacing(udg_hero)), +, 90.00, *, Pow(-1.00, I2R(bj_forLoopAIndex)))))
        set udg_unitType = 'e00L'
        set udg_dummy = createItemDummy(udg_unitType, udg_point)
        set udg_real = 4.00
        call UnitApplyTimedLife(udg_dummy, 'BHwe', udg_real)
        call IssuePointOrderLoc(udg_dummy, "move", udg_point2)
        call RemoveLocation(udg_point2)
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
endfunction

//===========================================================================
function InitTrig_ItemSpell_14 takes nothing returns nothing
    set gg_trg_ItemSpell_14 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_14, "ItemSpell-14")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_14, function Trig_ItemSpell_14Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-15
//===========================================================================
function Trig_ItemSpell_15Actions takes nothing returns nothing
    set udg_int = (udg_itemSpellLevel + 1)
    set udg_real = (360.00 / I2R(udg_int))
    set udg_real2 = lifeCount(udg_hero, 5)
    call YDUserDataSet(item, udg_item, "pause", real, 6.00)
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = udg_int
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        set udg_point2 = PolarProjectionBJ(udg_point, 300.00, YDWER2Deg((I2R(bj_forLoopAIndex) * udg_real)))
        set udg_unitType = 'e00M'
        set udg_dummy = createItemDummy(udg_unitType, udg_point2)
        call UnitApplyTimedLife(udg_dummy, 'BHwe', udg_real2)
        call AroundUwithU(udg_dummy,udg_hero,300,120, udg_real2)
        call RemoveLocation(udg_point2)
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
endfunction

//===========================================================================
function InitTrig_ItemSpell_15 takes nothing returns nothing
    set gg_trg_ItemSpell_15 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_15, "ItemSpell-15")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_15, function Trig_ItemSpell_15Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-16
//===========================================================================
function Trig_ItemSpell_16Actions takes nothing returns nothing
    if ((triType == 'I16K')) then
        set udg_int = 4
    else
        set udg_int = 2
    endif
    set udg_real = GetRandomReal(0.00, 360.00)
    set udg_real2 = lifeCount(udg_hero, 12)
    call YDUserDataSet(item, udg_item, "pause", real, udg_real2)
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = udg_int
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        set udg_point2 = PolarProjectionBJ(udg_point, 450.00, YDWER2Deg(YDWEOperatorReal3(udg_real, +, (180.00 / I2R(udg_int)), *, I2R(bj_forLoopAIndex))))
        set udg_unitType = 'e00N'
        set udg_dummy = createItemDummy(udg_unitType, udg_point2)
        call UnitApplyTimedLife(udg_dummy, 'BHwe', udg_real2)
        call ShockUwithU(udg_dummy,udg_hero,450,GetRandomReal(1.8, 2.2),GetRandomReal(20, 40), udg_real2)
        call RemoveLocation(udg_point2)
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
endfunction

//===========================================================================
function InitTrig_ItemSpell_16 takes nothing returns nothing
    set gg_trg_ItemSpell_16 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_16, "ItemSpell-16")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_16, function Trig_ItemSpell_16Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-17
//===========================================================================
function Trig_ItemSpell_17Func001Func011T takes nothing returns nothing
    if ((IsUnitAliveBJ(YDLocalGet(GetExpiredTimer(), unit, "dummy")) == true)) then
        call IssuePointOrder(YDLocalGet(GetExpiredTimer(), unit, "dummy"), "carrionswarm", (GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "hero")) + GetRandomReal(-100.00, 100.00)), (GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "hero")) + GetRandomReal(-100.00, 100.00)))
    else
        call YDUserDataSet(item, YDLocalGet(GetExpiredTimer(), item, "item"), "count", integer, (YDUserDataGet(item, YDLocalGet(GetExpiredTimer(), item, "item"), "count", integer) - 1))
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    endif
endfunction

function Trig_ItemSpell_17Actions takes nothing returns nothing
    local timer ydl_timer
    YDLocalInitialize()
    if ((YDUserDataGet(item, udg_item, "count", integer) < 6)) then
        set udg_point2 = PolarProjectionBJ(udg_point, GetRandomReal(400.00, 600.00), GetRandomDirectionDeg())
        set udg_unitType = 'e00O'
        set udg_dummy = createItemDummy(udg_unitType, udg_point2)
        set udg_real2 = lifeCount(udg_hero, 20)
        call UnitApplyTimedLife(udg_dummy, 'BHwe', udg_real2)
        if ((triType == 'I17K')) then
            set udg_real = GetRandomReal(1.00, 1.25)
            call SetUnitScale(udg_dummy, 1.30, 1.30, 1.30)
            call SetUnitVertexColor(udg_dummy, 255, 100, 100, 255)
        else
            set udg_real = GetRandomReal(2.00, 2.50)
        endif
        call YDUserDataSet(item, udg_item, "count", integer, (YDUserDataGet(item, udg_item, "count", integer) + 1))
        call SetUnitAnimation(udg_dummy, "birth")
        call IssuePointOrder(udg_dummy, "carrionswarm", (GetUnitX(udg_hero) + GetRandomReal(-100.00, 100.00)), (GetUnitY(udg_hero) + GetRandomReal(-100.00, 100.00)))
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, unit, "dummy", udg_dummy)
        call YDLocalSet(ydl_timer, unit, "hero", udg_hero)
        call YDLocalSet(ydl_timer, item, "item", udg_item)
        call TimerStart(ydl_timer, udg_real, true, function Trig_ItemSpell_17Func001Func011T)
        call RemoveLocation(udg_point2)
    else
    endif
    call YDLocal1Release()
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_ItemSpell_17 takes nothing returns nothing
    set gg_trg_ItemSpell_17 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_17, "ItemSpell-17")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_17, function Trig_ItemSpell_17Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-18
//===========================================================================
function Trig_ItemSpell_18Func001Func001T takes nothing returns nothing
    if ((YDLocalGet(GetExpiredTimer(), integer, "times") < 5)) then
        call YDLocalSet(GetExpiredTimer(), integer, "times", (YDLocalGet(GetExpiredTimer(), integer, "times") + 1))
        set udg_point = GetUnitLoc(YDLocalGet(GetExpiredTimer(), unit, "hero"))
        set udg_point2 = PolarProjectionBJ(udg_point, YDWEOperatorReal3(GetRandomReal(1.00, 12.00), *, 50.00, +, 0), GetRandomDirectionDeg())
        set udg_hero = YDLocalGet(GetExpiredTimer(), unit, "hero")
        set udg_item = YDLocalGet(GetExpiredTimer(), item, "item")
        set udg_itemSpellLevel = YDLocalGet(GetExpiredTimer(), integer, "lv")
        set udg_unitType = 'e00P'
        set udg_dummy = createItemDummy(udg_unitType, udg_point2)
        call UnitApplyTimedLife(udg_dummy, 'BHwe', 0.10)
        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", GetUnitX(udg_dummy), GetUnitY(udg_dummy)))
        call RemoveLocation(udg_point)
        call RemoveLocation(udg_point2)
    else
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    endif
endfunction

function Trig_ItemSpell_18Func001Func010T takes nothing returns nothing
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy")), GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy"))))
    call YDLocal3Release()
    call DestroyTimer(GetExpiredTimer())
endfunction

function Trig_ItemSpell_18Actions takes nothing returns nothing
    local timer ydl_timer
    YDLocalInitialize()
    if ((triType == 'I18K')) then
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, unit, "hero", udg_hero)
        call YDLocalSet(ydl_timer, integer, "times", 0)
        call YDLocalSet(ydl_timer, integer, "lv", udg_itemSpellLevel)
        call YDLocalSet(ydl_timer, item, "item", udg_item)
        call TimerStart(ydl_timer, 0.30, true, function Trig_ItemSpell_18Func001Func001T)
    else
        set udg_point2 = PolarProjectionBJ(udg_point, 50.00, GetRandomDirectionDeg())
        set udg_unitType = 'e00P'
        set udg_dummy = createItemDummy(udg_unitType, udg_point2)
        set udg_real = GetRandomReal(1.50, 4.50)
        set udg_int = AroundUwithU(udg_dummy,udg_hero,50,GetRandomReal(120,360), udg_real)
        call AroundBackSet(udg_int, 150)
        call UnitApplyTimedLife(udg_dummy, 'BHwe', udg_real)
        call RemoveLocation(udg_point2)
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, unit, "dummy", udg_dummy)
        call TimerStart(ydl_timer, udg_real, false, function Trig_ItemSpell_18Func001Func010T)
    endif
    call YDLocal1Release()
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_ItemSpell_18 takes nothing returns nothing
    set gg_trg_ItemSpell_18 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_18, "ItemSpell-18")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_18, function Trig_ItemSpell_18Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-19
//===========================================================================
function Trig_ItemSpell_19Func006Func002Conditions takes nothing returns nothing
    if ((GetKillingUnitBJ() == YDLocalGet(GetTriggeringTrigger(), unit, "dummy"))) then
        set udg_int = YDLocalGet(GetTriggeringTrigger(), integer, "id")
        set udg_real = (YDLocalGet(GetTriggeringTrigger(), real, "dmg") * 1.15)
        call moverLineHited(udg_int, 125, udg_real, "敌方", 99)
        call YDLocalSet(GetTriggeringTrigger(), real, "dmg", udg_real)
    else
    endif
    if ((GetTriggerUnit() == YDLocalGet(GetTriggeringTrigger(), unit, "dummy"))) then
        call YDLocal4Release()
        call DestroyTrigger(GetTriggeringTrigger())
    else
    endif
endfunction

function Trig_ItemSpell_19Actions takes nothing returns nothing
    local trigger ydl_trigger
    YDLocalInitialize()
    set udg_real = YDWEOperatorReal3(100.00, +, I2R(GetHeroLevel(udg_hero)), *, YDWEOperatorReal3(I2R(udg_itemSpellLevel), *, 2.00, +, 8.00))
    set udg_ang = OperatorDegreeAdd(GetUnitFacing(udg_hero), YDWER2Deg(GetRandomReal(160.00, 200.00)))
    set udg_point2 = PolarProjectionBJ(udg_point, 50.00, udg_ang)
    set udg_dummy = CreateUnitAtLoc(udg_player, 'e00Q', udg_point2, udg_ang)
    call bindingDummyItem(udg_dummy, udg_item)
    if ((triType == 'I19K')) then
        call YDLocal1Set(real, "dmg", udg_real)
        set ydl_trigger = CreateTrigger()
        call YDLocalSet(ydl_trigger, unit, "dummy", udg_dummy)
        call YDLocalSet(ydl_trigger, integer, "id", udg_int)
        call YDLocalSet(ydl_trigger, real, "dmg", YDLocal1Get(real, "dmg"))
        call TriggerRegisterAnyUnitEventBJ(ydl_trigger, EVENT_PLAYER_UNIT_DEATH)
        call TriggerAddCondition(ydl_trigger, Condition(function Trig_ItemSpell_19Func006Func002Conditions))
    else
    endif
    call UnitApplyTimedLife(udg_dummy, 'BHwe', 3.00)
    call AroundUwithU(udg_dummy,udg_hero,50,0,1.5)
    set udg_int = moverLine(udg_dummy, 1250, 100, udg_ang, 8)
    call moverLineHited(udg_int, 65, udg_real, "敌方", 99)
    call moverLineDelay(udg_int, 1, 1.5)
    call moverLineAccel(udg_int, 2500)
    call moverLineMode(udg_int, "穿透")
    call moverLineSelfDie(udg_int)
    call moverLineHitEff(udg_int, "Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl")
    call RemoveLocation(udg_point2)
    call YDLocal1Release()
    set ydl_trigger = null
endfunction

//===========================================================================
function InitTrig_ItemSpell_19 takes nothing returns nothing
    set gg_trg_ItemSpell_19 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_19, "ItemSpell-19")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_19, function Trig_ItemSpell_19Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-20
//===========================================================================
function Trig_ItemSpell_20Actions takes nothing returns nothing
    set udg_point2 = PolarProjectionBJ(udg_point, GetRandomReal(150.00, 450.00), GetRandomDirectionDeg())
    if ((triType == 'I20K')) then
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = 2
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            set udg_unitType = 'e00U'
            set udg_dummy = createItemDummy(udg_unitType, udg_point2)
            call UnitApplyTimedLife(udg_dummy, 'BHwe', 15.00)
            set bj_forLoopBIndex = 1
            set bj_forLoopBIndexEnd = 3
            loop
                exitwhen bj_forLoopBIndex > bj_forLoopBIndexEnd
                set udg_unit = CreateUnitAtLoc(udg_player, 'e00V', udg_point2, 0.00)
                call UnitApplyTimedLife(udg_unit, 'BHwe', 15.00)
                call SetUnitFlyHeight(udg_unit, YDWEOperatorReal3(-60.00, +, 60.00, *, I2R(bj_forLoopBIndex)), 0.00)
                call AroundUwithU(udg_unit,udg_dummy, 200, GetRandomReal(60,120), 15)
                set bj_forLoopBIndex = bj_forLoopBIndex + 1
            endloop
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
    else
        set udg_unitType = 'e00U'
        set udg_dummy = createItemDummy(udg_unitType, udg_point2)
        call UnitApplyTimedLife(udg_dummy, 'BHwe', 15.00)
        set bj_forLoopBIndex = 1
        set bj_forLoopBIndexEnd = 3
        loop
            exitwhen bj_forLoopBIndex > bj_forLoopBIndexEnd
            set udg_unit = CreateUnitAtLoc(udg_player, 'e00V', udg_point2, 0.00)
            call UnitApplyTimedLife(udg_unit, 'BHwe', 15.00)
            call SetUnitFlyHeight(udg_unit, YDWEOperatorReal3(-60.00, +, 60.00, *, I2R(bj_forLoopBIndex)), 0.00)
            call AroundUwithU(udg_unit,udg_dummy, 200, GetRandomReal(60,120), 15)
            set bj_forLoopBIndex = bj_forLoopBIndex + 1
        endloop
    endif
    call RemoveLocation(udg_point2)
endfunction

//===========================================================================
function InitTrig_ItemSpell_20 takes nothing returns nothing
    set gg_trg_ItemSpell_20 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_20, "ItemSpell-20")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_20, function Trig_ItemSpell_20Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-21
//===========================================================================
function Trig_ItemSpell_21Func007T takes nothing returns nothing
    set udg_point2 = GetUnitLoc(YDLocalGet(GetExpiredTimer(), unit, "hero"))
    set udg_hero = YDLocalGet(GetExpiredTimer(), unit, "hero")
    set udg_item = YDLocalGet(GetExpiredTimer(), item, "item")
    set udg_itemSpellLevel = YDLocalGet(GetExpiredTimer(), integer, "lv")
    set udg_unitType = 'e000'
    set udg_dummy = createItemDummy(udg_unitType, udg_point2)
    if ((IssueImmediateOrder(udg_dummy, "fanofknives") == false)) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, 30, "|cffaa5555[错误]|r:释放灵魂炸弹失败")
        call DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, 30, YDWEOperatorString3("来源：", U2S(udg_dummy), ""))
    else
    endif
    call RemoveLocation(udg_point2)
endfunction

function Trig_ItemSpell_21Actions takes nothing returns nothing
    local timer ydl_timer
    YDLocalInitialize()
    call YDUserDataSet(item, udg_item, "pause", real, 3.00)
    if ((triType == 'I21K')) then
        set udg_real = 700.00
    else
        set udg_real = 350.00
    endif
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 6
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        set udg_point2 = PolarProjectionBJ(udg_point, udg_real, YDWER2Deg((I2R(bj_forLoopAIndex) * 60.00)))
        set udg_dummy = CreateUnitAtLoc(udg_player, 'e00W', udg_point2, 0.00)
        call UnitApplyTimedLife(udg_dummy, 'BHwe', 3.00)
        set udg_int = AroundUwithU(udg_dummy,udg_hero, udg_real, 75, 3)
        call AroundBackSet(udg_int, -udg_real/3.2)
        call RemoveLocation(udg_point2)
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    set udg_dummy = CreateUnitAtLoc(udg_player, 'e00W', udg_point, 0.00)
    call UnitApplyTimedLife(udg_dummy, 'BHwe', 3.00)
    set udg_int = AroundUwithU(udg_dummy,udg_hero, udg_real, 360, 3)
    set ydl_timer = CreateTimer()
    call YDLocalSet(ydl_timer, unit, "hero", udg_hero)
    call YDLocalSet(ydl_timer, item, "item", udg_item)
    call YDLocalSet(ydl_timer, integer, "lv", udg_itemSpellLevel)
    call TimerStart(ydl_timer, 3.00, false, function Trig_ItemSpell_21Func007T)
    call YDLocal1Release()
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_ItemSpell_21 takes nothing returns nothing
    set gg_trg_ItemSpell_21 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_21, "ItemSpell-21")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_21, function Trig_ItemSpell_21Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-22
//===========================================================================
function Trig_ItemSpell_22Func007Func001T takes nothing returns nothing
    if ((YDWEDistanceBetweenUnits(YDLocalGet(GetExpiredTimer(), unit, "hero"), YDLocalGet(GetExpiredTimer(), unit, "dummy")) <= 500.00)) then
        set udg_hero = YDLocalGet(GetExpiredTimer(), unit, "hero")
        call addHeal(udg_hero, 10)
        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\SpiritLink\\SpiritLinkZapTarget.mdl", GetUnitX(udg_hero), GetUnitY(udg_hero)))
    else
    endif
    if ((IsUnitDeadBJ(YDLocalGet(GetExpiredTimer(), unit, "dummy")) == true)) then
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
    endif
endfunction

function Trig_ItemSpell_22Actions takes nothing returns nothing
    local timer ydl_timer
    YDLocalInitialize()
    call YDUserDataSet(item, udg_item, "pause", real, 3.00)
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 12
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        set udg_point2 = PolarProjectionBJ(udg_point, 500.00, YDWER2Deg((I2R(bj_forLoopAIndex) * 30.00)))
        set udg_dummy = CreateUnitAtLoc(udg_player, 'e00T', udg_point2, YDWER2Deg((I2R(bj_forLoopAIndex) * 30.00)))
        call SetUnitAnimation(udg_dummy, "birth")
        call UnitApplyTimedLife(udg_dummy, 'BHwe', 45.00)
        set udg_effect = AddSpecialEffectLoc("Abilities\\Spells\\Other\\HowlOfTerror\\HowlTarget.mdl", udg_point2)
        call YDWETimerDestroyEffect(45.00, udg_effect)
        call RemoveLocation(udg_point2)
        set udg_point2 = PolarProjectionBJ(udg_point, GetRandomReal(150.00, 450.00), YDWER2Deg((I2R(bj_forLoopAIndex) * 45.00)))
        set udg_effect = AddSpecialEffectLoc("Abilities\\Spells\\Undead\\RegenerationAura\\ObsidianRegenAura.mdl", udg_point2)
        call YDWETimerDestroyEffect(45.00, udg_effect)
        call RemoveLocation(udg_point2)
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    call YDUserDataSet(item, udg_item, "pause", real, 45.00)
    set udg_unitType = 'e00D'
    set udg_dummy = createItemDummy(udg_unitType, udg_point)
    call UnitApplyTimedLife(udg_dummy, 'BHwe', 45.00)
    if ((triType == 'I22K')) then
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, unit, "hero", udg_hero)
        call YDLocalSet(ydl_timer, unit, "dummy", udg_dummy)
        call TimerStart(ydl_timer, 1.00, true, function Trig_ItemSpell_22Func007Func001T)
    else
    endif
    call YDLocal1Release()
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_ItemSpell_22 takes nothing returns nothing
    set gg_trg_ItemSpell_22 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_22, "ItemSpell-22")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_22, function Trig_ItemSpell_22Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-23
//===========================================================================
function Trig_ItemSpell_23Actions takes nothing returns nothing
    set udg_real = lifeCount(udg_hero, 20)
    call YDUserDataSet(item, udg_item, "pause", real, udg_real)
    if ((triType == 'I23K')) then
        set udg_unitType = 'e00X'
    else
        set udg_unitType = 'e00R'
    endif
    set udg_point2 = PolarProjectionBJ(udg_point, 300.00, GetRandomDirectionDeg())
    call DestroyEffect(AddSpecialEffectLoc("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl", udg_point2))
    set udg_dummy = createItemDummy(udg_unitType, udg_point2)
    call UnitApplyTimedLife(udg_dummy, 'BTLF', udg_real)
    call YDUserDataSet(unit, udg_dummy, "triItem", item, udg_item)
    call IssueImmediateOrder(udg_dummy, "starfall")
endfunction

//===========================================================================
function InitTrig_ItemSpell_23 takes nothing returns nothing
    set gg_trg_ItemSpell_23 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_23, "ItemSpell-23")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_23, function Trig_ItemSpell_23Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-24
//===========================================================================
function Trig_ItemSpell_24Func002T takes nothing returns nothing
    if ((YDLocalGet(GetExpiredTimer(), integer, "n") == 0)) then
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
        call YDLocalSet(GetExpiredTimer(), integer, "n", (YDLocalGet(GetExpiredTimer(), integer, "n") - 1))
        set udg_hero = YDLocalGet(GetExpiredTimer(), unit, "hero")
        set udg_item = YDLocalGet(GetExpiredTimer(), item, "item")
        set udg_itemSpellLevel = YDLocalGet(GetExpiredTimer(), integer, "lv")
        set udg_ang = GetRandomDirectionDeg()
        set udg_point2 = GetUnitLoc(udg_hero)
        set udg_unitType = 'e00Y'
        set udg_dummy = createItemDummy(udg_unitType, udg_point2)
        call UnitApplyTimedLife(udg_dummy, 'BHwe', 2.00)
        set udg_int = moverLine(udg_dummy, 9999, 1000, udg_ang, 2)
        set udg_real = YDWEOperatorReal3(50.00, +, I2R(udg_itemSpellLevel), *, 50.00)
        if ((YDLocalGet(GetExpiredTimer(), itemcode, "ity") == 'I24K')) then
            call moverLineHited(udg_int, 175, udg_real, "敌方", 99)
        else
            call moverLineHited(udg_int, 175, udg_real, "敌方", 3)
        endif
        call moverLineAccel(udg_int, -1800)
        call moverLineSelfDie(udg_int)
        call moverLineMode(udg_int, "回旋")
        call moverLineDelay(udg_int, 0, 0.2)
        call moverLineDelayHit(udg_int, 0.2)
        call moverLineRoll(udg_int, 480)
        call moverLineHitEff(udg_int, "Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl")
        call RemoveLocation(udg_point2)
    endif
endfunction

function Trig_ItemSpell_24Actions takes nothing returns nothing
    local timer ydl_timer
    YDLocalInitialize()
    call YDUserDataSet(item, udg_item, "pause", real, 6.00)
    set ydl_timer = CreateTimer()
    call YDLocalSet(ydl_timer, unit, "hero", udg_hero)
    call YDLocalSet(ydl_timer, item, "item", udg_item)
    call YDLocalSet(ydl_timer, integer, "lv", udg_itemSpellLevel)
    call YDLocalSet(ydl_timer, integer, "n", 6)
    call YDLocalSet(ydl_timer, itemcode, "ity", triType)
    call TimerStart(ydl_timer, 1.00, true, function Trig_ItemSpell_24Func002T)
    call YDLocal1Release()
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_ItemSpell_24 takes nothing returns nothing
    set gg_trg_ItemSpell_24 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_24, "ItemSpell-24")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_24, function Trig_ItemSpell_24Actions)
endfunction

//===========================================================================
// Trigger: ItemSpell-25
//===========================================================================
function Trig_ItemSpell_25Func005T takes nothing returns nothing
    set udg_point = GetUnitLoc(YDLocalGet(GetExpiredTimer(), unit, "hero"))
    set udg_point2 = PolarProjectionBJ(udg_point, GetRandomReal(0.00, 300.00), GetRandomDirectionDeg())
    call IssuePointOrderLoc(YDLocalGet(GetExpiredTimer(), unit, "dummy"), "flamestrike", udg_point2)
    call RemoveLocation(udg_point)
    call RemoveLocation(udg_point2)
    call YDLocalSet(GetExpiredTimer(), integer, "n", (YDLocalGet(GetExpiredTimer(), integer, "n") - 1))
    if ((YDLocalGet(GetExpiredTimer(), integer, "n") == 0)) then
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
    endif
endfunction

function Trig_ItemSpell_25Actions takes nothing returns nothing
    local timer ydl_timer
    YDLocalInitialize()
    set udg_unitType = 'e00D'
    set udg_dummy = createItemDummy(udg_unitType, udg_point)
    call UnitApplyTimedLife(udg_dummy, 'BHwe', 8.00)
    call YDUserDataSet(item, udg_item, "pause", real, 8.00)
    set ydl_timer = CreateTimer()
    call YDLocalSet(ydl_timer, unit, "hero", udg_hero)
    call YDLocalSet(ydl_timer, unit, "dummy", udg_dummy)
    call YDLocalSet(ydl_timer, integer, "n", 5)
    call TimerStart(ydl_timer, 1.00, true, function Trig_ItemSpell_25Func005T)
    call YDLocal1Release()
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_ItemSpell_25 takes nothing returns nothing
    set gg_trg_ItemSpell_25 = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemSpell_25, "ItemSpell-25")
#endif
    call TriggerAddAction(gg_trg_ItemSpell_25, function Trig_ItemSpell_25Actions)
endfunction

//===========================================================================
// Trigger: ItemCD
//===========================================================================
function Trig_ItemCDFunc001A takes nothing returns nothing
    set udg_hero = GetEnumUnit()
    call itemCD(udg_hero)
endfunction

function Trig_ItemCDActions takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    call ForGroupBJ(udg_groupHero, function Trig_ItemCDFunc001A)
    set ydl_group = null
    set ydl_unit = null
endfunction

//===========================================================================
function InitTrig_ItemCD takes nothing returns nothing
    set gg_trg_ItemCD = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_ItemCD, "ItemCD")
#endif
    call TriggerAddAction(gg_trg_ItemCD, function Trig_ItemCDActions)
endfunction

//===========================================================================
// Trigger: armyinit-Jass
//===========================================================================
//TESH.scrollpos=0
//TESH.alwaysfold=0
function Trig_JassInitActions takes nothing returns nothing
    local integer n = 0
    loop
        set n = n + 1
        set udg_armyTypeTotal = udg_armyTypeTotal + 1
        set udg_armyType[n] = 'ua00' + n - 1 //注册刷新的敌人，按照id排序
        set udg_bossTypeTotal = udg_bossTypeTotal + 1
        set udg_bossType[n] = 'ub00' + n - 1 //注册刷新的精英怪，按照id排序
        exitwhen n >= 7
    endloop
    set udg_armyType[0] = 'ua00'
    set udg_bossType[0] = 'ub00'
    
    <? for i = 0, 6 do ?>
        set udg_bossFinalType[<?=i?>] = 'uc0<?=i?>'
    <? end ?>
endfunction

//===========================================================================
function InitTrig_armyinit_Jass takes nothing returns nothing
    local trigger t = CreateTrigger()
    call TriggerRegisterTimerEventSingle(t, 0.00)
    call TriggerAddAction(t, function Trig_JassInitActions)
endfunction

//===========================================================================
// Trigger: refresh
//===========================================================================
function Trig_refreshActions takes nothing returns nothing
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 8
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        set udg_player = ConvertedPlayer((bj_forLoopAIndex + 4))
        set udg_int = ((bj_forLoopAIndex + 1) / 2)
        if ((CountUnitsInGroup(udg_groupArmy[bj_forLoopAIndex]) < udg_armyMax)) then
            set udg_hero = udg_Heros[udg_int]
            if (((udg_hero == null) or (IsUnitAliveBJ(udg_hero) == false))) then
                set udg_hero = GroupPickRandomUnit(udg_groupHero)
            else
            endif
            set udg_int2 = GetConvertedPlayerId(GetOwningPlayer(udg_hero))
            set udg_point = getAPassPoint(udg_rectNowRefresh[udg_int2])
            set udg_unit = CreateUnit(udg_player, udg_armyType[GetRandomInt((udg_armyLevel - 1), udg_armyLevel)], GetLocationX(udg_point), GetLocationY(udg_point), 0)
            call YDUserDataSet(unit, udg_unit, "Atarget", unit, udg_hero)
            call SetUnitMoveSpeed(udg_unit, (GetUnitMoveSpeed(udg_unit) + ((I2R(udg_GameMode) - 1.00) * 10.00)))
            if ((udg_GameMode >= 3)) then
                call UnitAddAbility(udg_unit, 'AItx')
            else
            endif
            if ((udg_GameMode >= 4)) then
                call UnitAddAbility(udg_unit, 'AIsr')
            else
            endif
            call TriggerRegisterUnitEvent(gg_trg_refresh_finalBossDeath, udg_unit, EVENT_UNIT_DEATH)
            call UnitApplyTimedLife(udg_unit, 'Bhwd', 180.00)
            call DestroyEffect(AddSpecialEffectLoc("Abilities\\Spells\\NightElf\\Blink\\BlinkTarget.mdl", udg_point))
            call GroupAddUnit(udg_groupArmy[bj_forLoopAIndex], udg_unit)
            call IssuePointOrder(udg_unit, "patrol", 0, 0)
            call RemoveLocation(udg_point)
        else
        endif
        if ((udg_flagRefreshBoss > 0)) then
            set udg_hero = udg_Heros[udg_int]
            if (((udg_hero == null) or (IsUnitAliveBJ(udg_hero) == false))) then
                set udg_hero = GroupPickRandomUnit(udg_groupHero)
            else
            endif
            set udg_int2 = GetConvertedPlayerId(GetOwningPlayer(udg_hero))
            set udg_point = getAPassPoint(udg_rectNowRefresh[udg_int2])
            set udg_unit = CreateUnit(udg_player, udg_bossNowType, GetLocationX(udg_point), GetLocationY(udg_point), 0)
            call YDUserDataSet(unit, udg_unit, "Atarget", unit, udg_hero)
            call SetUnitMoveSpeed(udg_unit, (GetUnitMoveSpeed(udg_unit) + ((I2R(udg_GameMode) - 1.00) * 15.00)))
            if ((udg_GameMode >= 3)) then
                call UnitAddAbility(udg_unit, 'AItx')
            else
            endif
            if ((udg_GameMode >= 4)) then
                call UnitAddAbility(udg_unit, 'AIsr')
            else
            endif
            call DestroyEffect(AddSpecialEffectLoc("Abilities\\Spells\\NightElf\\Blink\\BlinkTarget.mdl", udg_point))
            call UnitAddAbility(udg_unit, 'A00M')
            call DisplayTextToPlayer(GetLocalPlayer(), 0, 0, YDWEOperatorString3("小心！|cffffff55<", GetUnitName(udg_unit), ">|r即将出现！"))
            if ((udg_gameTime_min > 24)) then
                call UnitAddType(udg_unit, UNIT_TYPE_TAUREN)
                call TriggerRegisterUnitEvent(gg_trg_refresh_finalBossDeath, udg_unit, EVENT_UNIT_DEATH)
            else
                call TriggerRegisterUnitEvent(gg_trg_reward_boss, udg_unit, EVENT_UNIT_DEATH)
            endif
            call GroupAddUnit(udg_groupArmy[bj_forLoopAIndex], udg_unit)
            set udg_flagRefreshBoss = (udg_flagRefreshBoss - 1)
            call RemoveLocation(udg_point)
        else
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
endfunction

//===========================================================================
function InitTrig_refresh takes nothing returns nothing
    set gg_trg_refresh = CreateTrigger()
    call DisableTrigger(gg_trg_refresh)
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_refresh, "refresh")
#endif
    call TriggerRegisterTimerEventPeriodic(gg_trg_refresh, 1.00)
    call TriggerAddAction(gg_trg_refresh, function Trig_refreshActions)
endfunction

//===========================================================================
// Trigger: refresh-order
//===========================================================================
function Trig_refresh_orderFunc003Func001A takes nothing returns nothing
    set udg_unit = GetEnumUnit()
    set udg_hero = YDUserDataGet(unit, udg_unit, "Atarget", unit)
    set udg_int2 = GetConvertedPlayerId(GetOwningPlayer(udg_hero))
    if (             (bloodAbilities[udg_int2*100+43])) then
        call UnitAddAbility(udg_unit, 'Ad03')
        call UnitAddAbility(udg_unit, 'Ad04')
    else
    endif
    if ((IsUnitDeadBJ(udg_hero) == true)) then
        call IssuePointOrder(udg_unit, "move", 0.00, 0.00)
    else
        if ((IsUnitType(udg_unit, UNIT_TYPE_SAPPER) == true)) then
            call IssueTargetOrder(udg_unit, "attack", udg_hero)
        else
            call IssuePointOrder(udg_unit, "attack", GetUnitX(udg_hero), GetUnitY(udg_hero))
        endif
    endif
    if ((RectContainsUnit(udg_rectNowRefresh[udg_int2], udg_unit) == false) and (YDWEDistanceBetweenUnits(udg_hero, udg_unit) > 1500.00)) then
        set udg_point = GetRandomLocInRect(udg_rectNowRefresh[udg_int2])
        call SetUnitX(udg_unit, GetLocationX(udg_point))
        call SetUnitY(udg_unit, GetLocationY(udg_point))
        call RemoveLocation(udg_point)
    else
    endif
    if ((RectContainsUnit(udg_rectNowRefresh[udg_int2], udg_unit) == true) and (YDWEDistanceBetweenUnits(udg_hero, udg_unit) > 2500.00)) then
        set udg_point2 = GetUnitLoc(udg_hero)
        set udg_point = PolarProjectionBJ(udg_point2, 2500.00, YDWEAngleBetweenUnits(udg_hero, udg_unit))
        call SetUnitX(udg_unit, GetLocationX(udg_point))
        call SetUnitY(udg_unit, GetLocationY(udg_point))
        call RemoveLocation(udg_point)
        call RemoveLocation(udg_point2)
    else
    endif
endfunction

function Trig_refresh_orderActions takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    set udg_intRefreshCount = (udg_intRefreshCount + 1)
    if ((udg_intRefreshCount > 8)) then
        set udg_intRefreshCount = 1
    else
    endif
    if ((CountUnitsInGroup(udg_groupArmy[udg_intRefreshCount]) > 0)) then
        call ForGroupBJ(udg_groupArmy[udg_intRefreshCount], function Trig_refresh_orderFunc003Func001A)
    else
    endif
    set ydl_group = null
    set ydl_unit = null
endfunction

//===========================================================================
function InitTrig_refresh_order takes nothing returns nothing
    set gg_trg_refresh_order = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_refresh_order, "refresh-order")
#endif
    call TriggerRegisterTimerEventPeriodic(gg_trg_refresh_order, 0.50)
    call TriggerAddAction(gg_trg_refresh_order, function Trig_refresh_orderActions)
endfunction

//===========================================================================
// Trigger: refresh-finalBossDeath
//===========================================================================
function Trig_refresh_finalBossDeathFunc001Func002Func001A takes nothing returns nothing
    call RemoveUnit(GetEnumUnit())
endfunction

function Trig_refresh_finalBossDeathFunc001Func002Func004A takes nothing returns nothing
    call PauseUnit(GetEnumUnit(), true)
    call SetUnitAnimation(GetEnumUnit(), "death")
endfunction

function Trig_refresh_finalBossDeathFunc001Func003T takes nothing returns nothing
    call saveGameOver()
endfunction

function Trig_refresh_finalBossDeathActions takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    local timer ydl_timer
    if ((IsUnitType(GetTriggerUnit(), UNIT_TYPE_TAUREN) == true)) then
        call DisplayTextToPlayer(GetLocalPlayer(), 0, 0, "你成为了|cffAA5555<尊贵吸血鬼>|r!")
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = 8
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            call ForGroupBJ(udg_groupArmy[bj_forLoopAIndex], function Trig_refresh_finalBossDeathFunc001Func002Func001A)
            call DisableTrigger(gg_trg_refresh)
            call DisableTrigger(gg_trg_Time)
            call ForGroupBJ(udg_groupHero, function Trig_refresh_finalBossDeathFunc001Func002Func004A)
            call CinematicModeExBJ(true, GetPlayersAll(), 1.00)
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
        set ydl_timer = CreateTimer()
        call TimerStart(ydl_timer, 3.00, false, function Trig_refresh_finalBossDeathFunc001Func003T)
    else
    endif
    set ydl_group = null
    set ydl_unit = null
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_refresh_finalBossDeath takes nothing returns nothing
    set gg_trg_refresh_finalBossDeath = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_refresh_finalBossDeath, "refresh-finalBossDeath")
#endif
    call TriggerAddAction(gg_trg_refresh_finalBossDeath, function Trig_refresh_finalBossDeathActions)
endfunction

//===========================================================================
// Trigger: reward-bossRect
//===========================================================================
function Trig_reward_bossRectFunc002001002 takes nothing returns boolean
    return ((IsUnitInGroup(GetFilterUnit(), udg_groupHero) == true))
endfunction

function Trig_reward_bossRectFunc002Func002Func001T takes nothing returns nothing
    set udg_dummy = YDLocalGet(GetExpiredTimer(), unit, "u")
    set udg_hero = YDLocalGet(GetExpiredTimer(), unit, "h")
    call YDLocalSet(GetExpiredTimer(), real, "x", YDWEOperatorReal3(GetUnitX(udg_dummy), +, YDLocalGet(GetExpiredTimer(), real, "aspeed"), *, CosBJ(YDLocalGet(GetExpiredTimer(), degree, "aangle"))))
    call YDLocalSet(GetExpiredTimer(), real, "y", YDWEOperatorReal3(GetUnitY(udg_dummy), +, YDLocalGet(GetExpiredTimer(), real, "aspeed"), *, SinBJ(YDLocalGet(GetExpiredTimer(), degree, "aangle"))))
    call YDLocalSet(GetExpiredTimer(), real, "aspeed", (YDLocalGet(GetExpiredTimer(), real, "aspeed") * 1.10))
    if ((YDLocalGet(GetExpiredTimer(), real, "bspeed") > 0.00)) then
        call SetUnitFlyHeight(udg_dummy, (GetUnitFlyHeight(udg_dummy) + 3.00), 0.00)
        call YDLocalSet(GetExpiredTimer(), real, "x", YDWEOperatorReal3(YDLocalGet(GetExpiredTimer(), real, "x"), +, YDLocalGet(GetExpiredTimer(), real, "bspeed"), *, CosBJ(YDLocalGet(GetExpiredTimer(), degree, "bangle"))))
        call YDLocalSet(GetExpiredTimer(), real, "y", YDWEOperatorReal3(YDLocalGet(GetExpiredTimer(), real, "y"), +, YDLocalGet(GetExpiredTimer(), real, "bspeed"), *, SinBJ(YDLocalGet(GetExpiredTimer(), degree, "bangle"))))
        call YDLocalSet(GetExpiredTimer(), real, "bspeed", YDWEOperatorReal3(YDLocalGet(GetExpiredTimer(), real, "bspeed"), *, 0.95, -, 0.10))
        call SetUnitFacing(udg_dummy, YDLocalGet(GetExpiredTimer(), degree, "bangle"))
    else
        call YDLocalSet(GetExpiredTimer(), degree, "aangle", YDWEAngleBetweenUnits(udg_dummy, udg_hero))
        call SetUnitFacing(udg_dummy, YDLocalGet(GetExpiredTimer(), degree, "aangle"))
        if ((GetUnitFlyHeight(udg_dummy) > 50.00)) then
            call SetUnitFlyHeight(udg_dummy, (GetUnitFlyHeight(udg_dummy) - 3.00), 0.00)
        else
        endif
    endif
    call SetUnitX(udg_dummy, YDLocalGet(GetExpiredTimer(), real, "x"))
    call SetUnitY(udg_dummy, YDLocalGet(GetExpiredTimer(), real, "y"))
    if ((GetUnitState(udg_hero, UNIT_STATE_LIFE) > 0.00) and (YDWEDistanceBetweenUnits(udg_dummy, udg_hero) > YDLocalGet(GetExpiredTimer(), real, "aspeed"))) then
        return
    else
    endif
    call KillUnit(udg_dummy)
    call YDLocal3Release()
    call DestroyTimer(GetExpiredTimer())
endfunction

function Trig_reward_bossRectFunc002A takes nothing returns nothing
    local timer ydl_timer
    call YDLocal2Set(real, "startAngle", YDWEDeg2R(YDWEAngleBetweenUnits(GetEnumUnit(), GetTriggerUnit())))
    set bj_forLoopAIndex = -2
    set bj_forLoopAIndexEnd = 2
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, unit, "u", CreateUnit(Player(PLAYER_NEUTRAL_PASSIVE), 'uloc', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0))
        call YDLocalSet(ydl_timer, unit, "h", GetEnumUnit())
        call YDLocalSet(ydl_timer, degree, "aangle", YDWEAngleBetweenUnits(GetTriggerUnit(), GetEnumUnit()))
        call YDLocalSet(ydl_timer, degree, "bangle", YDWER2Deg(YDWEOperatorReal3(YDLocal2Get(real, "startAngle"), +, I2R(bj_forLoopAIndex), *, 40.00)))
        call YDLocalSet(ydl_timer, real, "bspeed", 15.00)
        call YDLocalSet(ydl_timer, real, "aspeed", 0.03)
        call YDLocalSet(ydl_timer, real, "x", YDLocal2Get(real, "x"))
        call YDLocalSet(ydl_timer, real, "y", YDLocal2Get(real, "y"))
        call TimerStart(ydl_timer, 0.02, true, function Trig_reward_bossRectFunc002Func002Func001T)
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    set ydl_timer = null
endfunction

function Trig_reward_bossRectFunc003A takes nothing returns nothing
    call KillUnit(GetEnumUnit())
endfunction

function Trig_reward_bossRectFunc005Func005T takes nothing returns nothing
    set udg_hero = YDLocalGet(GetExpiredTimer(), unit, "hero")
    if ((GetUnitUserData(udg_hero) > 0)) then
        return
    else
    endif
    call SetUnitUserData(udg_hero, YDLocalGet(GetExpiredTimer(), integer, "id"))
    if ((GetHeroSkillPoints(udg_hero) == 0)) then
        call oneBloodSelect(udg_hero)
    else
    endif
    call YDLocal3Release()
    call DestroyTimer(GetExpiredTimer())
endfunction

function Trig_reward_bossRectFunc005A takes nothing returns nothing
    local timer ydl_timer
    set udg_hero = GetEnumUnit()
    call addBloodNumber(udg_hero, 4 + udg_GameMode)
    call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathPact\\DeathPactCaster.mdl", udg_hero, "origin"))
    if ((udg_intBossInsTar[GetConvertedPlayerId(GetOwningPlayer(udg_hero))] == udg_int)) then
        set udg_intBossInsTar[GetConvertedPlayerId(GetOwningPlayer(udg_hero))] = 0
    else
    endif
    set ydl_timer = CreateTimer()
    call YDLocalSet(ydl_timer, unit, "hero", udg_hero)
    call YDLocalSet(ydl_timer, integer, "id", udg_int)
    call TimerStart(ydl_timer, 0.10, true, function Trig_reward_bossRectFunc005Func005T)
    set ydl_timer = null
endfunction

function Trig_reward_bossRectActions takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    local timer ydl_timer
    YDLocalInitialize()
    set udg_int = YDUserDataGet(unit, GetTriggerUnit(), "id", integer)
    call ForGroupBJ(GetUnitsInRectMatching(udg_rectBoss[udg_int], Condition(function Trig_reward_bossRectFunc002001002)), function Trig_reward_bossRectFunc002A)
    call ForGroupBJ(udg_groupRBossIns[udg_int], function Trig_reward_bossRectFunc003A)
    call DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, 30, YDWEOperatorString3("已击杀领域Boss|cffff7777[", GetUnitName(GetTriggerUnit()), "]|r！剥夺其血液能力！"))
    call ForGroupBJ(udg_groupHero, function Trig_reward_bossRectFunc005A)
    call YDLocal1Release()
    set ydl_group = null
    set ydl_unit = null
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_reward_bossRect takes nothing returns nothing
    set gg_trg_reward_bossRect = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_reward_bossRect, "reward-bossRect")
#endif
    call TriggerAddAction(gg_trg_reward_bossRect, function Trig_reward_bossRectActions)
endfunction

//===========================================================================
// Trigger: reward-army
//===========================================================================
function Trig_reward_armyConditions takes nothing returns boolean
    return ((GetPlayerController(GetOwningPlayer(GetTriggerUnit())) == MAP_CONTROL_COMPUTER) and (GetOwningPlayer(GetTriggerUnit()) != Player(bj_PLAYER_NEUTRAL_VICTIM)) and (GetOwningPlayer(GetTriggerUnit()) != Player(PLAYER_NEUTRAL_PASSIVE)))
endfunction

function Trig_reward_armyFunc007Func002T takes nothing returns nothing
    call YDLocalSet(GetExpiredTimer(), real, "speed", ((YDLocalGet(GetExpiredTimer(), real, "distance") / YDLocalGet(GetExpiredTimer(), real, "time")) * 0.02))
    call YDLocalSet(GetExpiredTimer(), real, "zmax", ((YDLocalGet(GetExpiredTimer(), real, "distance") * 10.00) + 1000.00))
    call SetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDWEOperatorReal3(GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy")), +, YDLocalGet(GetExpiredTimer(), real, "speed"), *, CosBJ(YDLocalGet(GetExpiredTimer(), degree, "angle"))))
    call SetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDWEOperatorReal3(GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy")), +, YDLocalGet(GetExpiredTimer(), real, "speed"), *, SinBJ(YDLocalGet(GetExpiredTimer(), degree, "angle"))))
    call YDLocalSet(GetExpiredTimer(), real, "passtime", (YDLocalGet(GetExpiredTimer(), real, "passtime") + 0.02))
    call YDLocalSet(GetExpiredTimer(), real, "high", (YDWEOperatorReal3(YDWEOperatorReal3(1.00, *, YDLocalGet(GetExpiredTimer(), real, "passtime"), -, 0.02), *, YDWEOperatorReal3(-1.00, *, YDLocalGet(GetExpiredTimer(), real, "passtime"), +, 0.62), *, YDLocalGet(GetExpiredTimer(), real, "zmax")) + 0.00))
    call SetUnitFlyHeight(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDLocalGet(GetExpiredTimer(), real, "high"), 999.00)
    if ((YDLocalGet(GetExpiredTimer(), real, "passtime") >= YDLocalGet(GetExpiredTimer(), real, "time"))) then
        call GroupAddUnit(udg_groupDrop, YDLocalGet(GetExpiredTimer(), unit, "dummy"))
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
    endif
endfunction

function Trig_reward_armyFunc010Func006T takes nothing returns nothing
    call YDLocalSet(GetExpiredTimer(), real, "speed", ((YDLocalGet(GetExpiredTimer(), real, "distance") / YDLocalGet(GetExpiredTimer(), real, "time")) * 0.02))
    call SetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDWEOperatorReal3(GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy")), +, YDLocalGet(GetExpiredTimer(), real, "speed"), *, CosBJ(YDLocalGet(GetExpiredTimer(), degree, "angle"))))
    call SetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDWEOperatorReal3(GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy")), +, YDLocalGet(GetExpiredTimer(), real, "speed"), *, SinBJ(YDLocalGet(GetExpiredTimer(), degree, "angle"))))
    call YDLocalSet(GetExpiredTimer(), real, "passtime", (YDLocalGet(GetExpiredTimer(), real, "passtime") + 0.02))
    call YDLocalSet(GetExpiredTimer(), real, "high", (YDWEOperatorReal3(YDWEOperatorReal3(1.00, *, YDLocalGet(GetExpiredTimer(), real, "passtime"), +, 0.02), *, YDWEOperatorReal3(-1.00, *, YDLocalGet(GetExpiredTimer(), real, "passtime"), +, 0.32), +, 0.00) * 4000.00))
    call SetUnitFlyHeight(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDLocalGet(GetExpiredTimer(), real, "high"), 999.00)
    if ((YDLocalGet(GetExpiredTimer(), real, "passtime") >= YDLocalGet(GetExpiredTimer(), real, "time"))) then
        call GroupAddUnit(udg_groupDrop, YDLocalGet(GetExpiredTimer(), unit, "dummy"))
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
    endif
endfunction

function Trig_reward_armyActions takes nothing returns nothing
    local timer ydl_timer
    YDLocalInitialize()
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = 8
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        if ((IsUnitInGroup(GetTriggerUnit(), udg_groupArmy[bj_forLoopAIndex]) == true)) then
            call GroupRemoveUnit(udg_groupArmy[bj_forLoopAIndex], GetTriggerUnit())
            call DoNothing() YDNL exitwhen true//()
        else
        endif
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
    if ((GetPlayerController(GetOwningPlayer(GetKillingUnitBJ())) != MAP_CONTROL_USER)) then
        call YDLocal1Release()
        set ydl_timer = null
        return
    else
    endif
    set udg_dummy = null
    set udg_point = GetUnitLoc(GetTriggerUnit())
    set udg_point2 = OffsetLocation(udg_point, GetRandomReal(-100.00, 100.00), GetRandomReal(-100.00, 100.00))
    if ((GetRandomInt(1, 1000) > 500)) then
        set udg_dummy = CreateUnitAtLoc(Player(PLAYER_NEUTRAL_PASSIVE), 'e001', udg_point2, 0)
        set udg_real = YDWEOperatorReal3(70.00, +, (I2R(udg_gameTime_min) * 30.00), +, Pow(1.02, GetRandomReal(1.00, YDWEOperatorReal3(100.00, +, I2R(udg_gameTime_min), *, 12.00))))
        if ((udg_maxPlayer > 1)) then
            set udg_real = (udg_real * YDWEOperatorReal3(1.00, +, I2R(udg_maxPlayer), *, 0.20))
        else
        endif
        set udg_real = (udg_real * 2.25)
        call SetUnitLifeBJ(udg_dummy, udg_real)
        call UnitApplyTimedLife(udg_dummy, 'BHwe', 300.00)
    else
        if ((GetRandomInt(1, 1000) < 3)) then
            set udg_dummy = CreateUnitAtLoc(Player(PLAYER_NEUTRAL_PASSIVE), 'e00I', udg_point2, 0)
            call UnitApplyTimedLife(udg_dummy, 'BHwe', 300.00)
        else
        endif
    endif
    if ((udg_dummy != null)) then
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, unit, "dummy", udg_dummy)
        call YDLocalSet(ydl_timer, degree, "angle", OperatorDegreeAdd(YDWEAngleBetweenUnits(GetKillingUnitBJ(), GetTriggerUnit()), YDWER2Deg(GetRandomReal(-30.00, 30.00))))
        call YDLocalSet(ydl_timer, real, "distance", GetRandomReal(120.00, 240.00))
        call YDLocalSet(ydl_timer, real, "time", 0.60)
        call YDLocalSet(ydl_timer, real, "passtime", 0.00)
        call YDLocalSet(ydl_timer, real, "high", 0.00)
        call YDLocalSet(ydl_timer, real, "speed", YDLocal1Get(real, "speed"))
        call YDLocalSet(ydl_timer, real, "zmax", YDLocal1Get(real, "zmax"))
        call TimerStart(ydl_timer, 0.02, true, function Trig_reward_armyFunc007Func002T)
    else
    endif
    call RemoveLocation(udg_point2)
    set udg_point2 = OffsetLocation(udg_point, GetRandomReal(-100.00, 100.00), GetRandomReal(-100.00, 100.00))
    if ((GetRandomInt(1, 1000) <= 250)) then
        set udg_dummy = CreateUnitAtLoc(Player(PLAYER_NEUTRAL_PASSIVE), 'e00H', udg_point2, 0)
        call SetUnitLifeBJ(udg_dummy, YDWEOperatorReal3(GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE), *, 0.00, +, GetRandomReal(1.00, 25.00)))
        call UnitApplyTimedLife(udg_dummy, 'BHwe', 360.00)
        call YDLocal1Set(unit, "dummy", udg_dummy)
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, degree, "angle", GetRandomDirectionDeg())
        call YDLocalSet(ydl_timer, real, "distance", 180.00)
        call YDLocalSet(ydl_timer, real, "time", 0.30)
        call YDLocalSet(ydl_timer, real, "passtime", 0.00)
        call YDLocalSet(ydl_timer, real, "high", 0.00)
        call YDLocalSet(ydl_timer, unit, "dummy", YDLocal1Get(unit, "dummy"))
        call YDLocalSet(ydl_timer, real, "speed", YDLocal1Get(real, "speed"))
        call TimerStart(ydl_timer, 0.02, true, function Trig_reward_armyFunc010Func006T)
    else
        if ((GetRandomInt(1, 1000) < 3)) then
            set udg_item = CreateItem('It02', GetLocationX(udg_point2), GetLocationY(udg_point2))
            call YDWETimerRemoveItem(180.00, udg_item)
        else
            if ((GetRandomInt(1, 1000) < (25 - (udg_GameMode * 5)))) then
                set udg_item = CreateItem('It01', GetLocationX(udg_point2), GetLocationY(udg_point2))
                call YDWETimerRemoveItem(180.00, udg_item)
            else
            endif
        endif
    endif
    call RemoveLocation(udg_point2)
    call RemoveLocation(udg_point)
    call YDLocal1Release()
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_reward_army takes nothing returns nothing
    set gg_trg_reward_army = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_reward_army, "reward-army")
#endif
    call TriggerRegisterAnyUnitEventBJ(gg_trg_reward_army, EVENT_PLAYER_UNIT_DEATH)
    call TriggerAddCondition(gg_trg_reward_army, Condition(function Trig_reward_armyConditions))
    call TriggerAddAction(gg_trg_reward_army, function Trig_reward_armyActions)
endfunction

//===========================================================================
// Trigger: reward-boss
//===========================================================================
function Trig_reward_bossConditions takes nothing returns boolean
    return ((GetPlayerController(GetOwningPlayer(GetKillingUnitBJ())) == MAP_CONTROL_USER) and (GetPlayerController(GetOwningPlayer(GetTriggerUnit())) == MAP_CONTROL_COMPUTER) and (GetOwningPlayer(GetTriggerUnit()) != Player(bj_PLAYER_NEUTRAL_VICTIM)) and (GetOwningPlayer(GetTriggerUnit()) != Player(PLAYER_NEUTRAL_PASSIVE)))
endfunction

function Trig_reward_bossFunc006T takes nothing returns nothing
    call YDLocalSet(GetExpiredTimer(), real, "speed", ((YDLocalGet(GetExpiredTimer(), real, "distance") / YDLocalGet(GetExpiredTimer(), real, "time")) * 0.02))
    call SetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDWEOperatorReal3(GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy")), +, YDLocalGet(GetExpiredTimer(), real, "speed"), *, CosBJ(YDLocalGet(GetExpiredTimer(), degree, "angle"))))
    call SetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDWEOperatorReal3(GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy")), +, YDLocalGet(GetExpiredTimer(), real, "speed"), *, SinBJ(YDLocalGet(GetExpiredTimer(), degree, "angle"))))
    call YDLocalSet(GetExpiredTimer(), real, "passtime", (YDLocalGet(GetExpiredTimer(), real, "passtime") + 0.02))
    call YDLocalSet(GetExpiredTimer(), real, "high", (YDWEOperatorReal3(YDWEOperatorReal3(1.00, *, YDLocalGet(GetExpiredTimer(), real, "passtime"), +, 0.02), *, YDWEOperatorReal3(-1.00, *, YDLocalGet(GetExpiredTimer(), real, "passtime"), +, 0.32), +, 0.00) * 4000.00))
    call SetUnitFlyHeight(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDLocalGet(GetExpiredTimer(), real, "high"), 999.00)
    if ((YDLocalGet(GetExpiredTimer(), real, "passtime") >= YDLocalGet(GetExpiredTimer(), real, "time"))) then
        call GroupAddUnit(udg_groupDrop, YDLocalGet(GetExpiredTimer(), unit, "dummy"))
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
    endif
endfunction

function Trig_reward_bossActions takes nothing returns nothing
    local timer ydl_timer
    YDLocalInitialize()
    call CreateItem('Is00', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()))
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
    set udg_dummy = CreateUnitAtLoc(Player(PLAYER_NEUTRAL_PASSIVE), 'e00I', udg_point2, 0)
    call UnitApplyTimedLife(udg_dummy, 'BHwe', 360.00)
    call YDLocal1Set(unit, "dummy", udg_dummy)
    set ydl_timer = CreateTimer()
    call YDLocalSet(ydl_timer, degree, "angle", GetRandomDirectionDeg())
    call YDLocalSet(ydl_timer, real, "distance", 180.00)
    call YDLocalSet(ydl_timer, real, "time", 0.30)
    call YDLocalSet(ydl_timer, real, "passtime", 0.00)
    call YDLocalSet(ydl_timer, real, "high", 0.00)
    call YDLocalSet(ydl_timer, unit, "dummy", YDLocal1Get(unit, "dummy"))
    call YDLocalSet(ydl_timer, real, "speed", YDLocal1Get(real, "speed"))
    call TimerStart(ydl_timer, 0.02, true, function Trig_reward_bossFunc006T)
    call YDLocal1Release()
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_reward_boss takes nothing returns nothing
    set gg_trg_reward_boss = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_reward_boss, "reward-boss")
#endif
    call TriggerAddCondition(gg_trg_reward_boss, Condition(function Trig_reward_bossConditions))
    call TriggerAddAction(gg_trg_reward_boss, function Trig_reward_bossActions)
endfunction

//===========================================================================
// Trigger: reward-getSelect
//===========================================================================
function Trig_reward_getSelectConditions takes nothing returns boolean
    return ((IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) == true))
endfunction

function Trig_reward_getSelectActions takes nothing returns nothing
    set udg_player = GetOwningPlayer(GetTriggerUnit())
    set udg_int = GetConvertedPlayerId(udg_player)
    set udg_hero = GetTriggerUnit()
    if ((GetUnitUserData(udg_hero) == 0) and (GetHeroSkillPoints(udg_hero) == 1)) then
        call oneAbilitySelect(udg_hero, false)
    else
    endif
endfunction

//===========================================================================
function InitTrig_reward_getSelect takes nothing returns nothing
    set gg_trg_reward_getSelect = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_reward_getSelect, "reward-getSelect")
#endif
    call TriggerRegisterAnyUnitEventBJ(gg_trg_reward_getSelect, EVENT_PLAYER_HERO_LEVEL)
    call TriggerAddCondition(gg_trg_reward_getSelect, Condition(function Trig_reward_getSelectConditions))
    call TriggerAddAction(gg_trg_reward_getSelect, function Trig_reward_getSelectActions)
endfunction

//===========================================================================
// Trigger: reward-useSelect
//===========================================================================
function Trig_reward_useSelectConditions takes nothing returns boolean
    return ((IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) == true))
endfunction

function Trig_reward_useSelectActions takes nothing returns nothing
    set udg_player = GetOwningPlayer(GetTriggerUnit())
    set udg_int = GetConvertedPlayerId(udg_player)
    set udg_hero = GetTriggerUnit()
    set udg_dummy = GetSoldUnit()
    if (             (GetUnitTypeId(udg_dummy) >= 'uk00' and GetUnitTypeId(udg_dummy) <= ('uk70'))) then
        call addBlood(udg_hero, GetUnitTypeId(udg_dummy))
        call selectPickClear(udg_hero)
        call SetUnitUserData(udg_hero, 0)
    else
        call UnitModifySkillPoints(udg_hero, -1)
        call selectPickClear(udg_hero)
        if (             (GetUnitTypeId(udg_dummy) >= ABIUNIT_FRISTID and GetUnitTypeId(udg_dummy) <= ABIUNIT_ENDID)) then
            set udg_int = GetUnitTypeId(udg_dummy) - ABIUNIT_FRISTID + ABI_FRISTID
            call addBaseAbi(udg_hero, udg_int)
            set udg_int2 = GetUnitAbilityLevel(udg_hero, udg_int)
            if ((udg_int2 == 1)) then
                call DisplayTimedTextFromPlayer(udg_player, 0, 0, 10, "[|cffffcc00" + GetAbilityName(udg_int) + "|r]已获得")
            else
                call DisplayTimedTextFromPlayer(udg_player, 0, 0, 10, "[|cffffcc00" + GetAbilityName(udg_int) + "(Lv" + I2S(udg_int2) + ")|r]已升级")
            endif
            call Debug(YDWEId2S(udg_int)+"abi|level"+I2S(udg_int2))
            call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIsm\\AIsmTarget.mdl", udg_hero, "origin"))
        else
            set udg_flag = checkFullPackage(udg_hero)
            if ((udg_flag == false)) then
                call UnitAddItemByIdSwapped(GetUnitTypeId(udg_dummy) - ITEMUNIT_FRISTID + ITEM_FRISTID, udg_hero)
                if (             (bj_lastCreatedItem != null)) then
                else
                    call DisplayTimedTextFromPlayer(udg_player, 0, 0, 10, "[|cffffcc00" + GetItemName(bj_lastCreatedItem) + ")|r]已获得")
                endif
            else
                set udg_int = GetUnitTypeId(udg_dummy) - ITEMUNIT_FRISTID + ITEM_FRISTID
                set udg_int = getItemId(udg_int)
                set udg_item = CreateItem(baseItemList[udg_int], 0, 0)
                call SetItemPlayer(udg_item, GetOwningPlayer(udg_hero), true)
                call itemLevelUp(udg_hero, udg_item)
            endif
        endif
    endif
    if ((GetUnitUserData(udg_hero) > 0)) then
        // 这里有个坑，如果玩家不选择血液容器的情况下去打掉另一个区域boss则自定义值会被覆盖
        call oneBloodSelect(udg_hero)
    else
        if ((GetHeroSkillPoints(udg_hero) >= 1)) then
            call oneAbilitySelect(udg_hero, false)
        else
        endif
    endif
    call RemoveUnit(udg_dummy)
endfunction

//===========================================================================
function InitTrig_reward_useSelect takes nothing returns nothing
    set gg_trg_reward_useSelect = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_reward_useSelect, "reward-useSelect")
#endif
    call TriggerRegisterAnyUnitEventBJ(gg_trg_reward_useSelect, EVENT_PLAYER_UNIT_SELL)
    call TriggerAddCondition(gg_trg_reward_useSelect, Condition(function Trig_reward_useSelectConditions))
    call TriggerAddAction(gg_trg_reward_useSelect, function Trig_reward_useSelectActions)
endfunction

//===========================================================================
// Trigger: reward-refresh
//===========================================================================
function Trig_reward_refreshConditions takes nothing returns boolean
    return ((GetSpellAbilityId() == 'bkre'))
endfunction

function Trig_reward_refreshActions takes nothing returns nothing
    set udg_hero = GetTriggerUnit()
    call selectPickClear(udg_hero)
    call oneAbilitySelect(udg_hero, false)
endfunction

//===========================================================================
function InitTrig_reward_refresh takes nothing returns nothing
    set gg_trg_reward_refresh = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_reward_refresh, "reward-refresh")
#endif
    call TriggerAddCondition(gg_trg_reward_refresh, Condition(function Trig_reward_refreshConditions))
    call TriggerAddAction(gg_trg_reward_refresh, function Trig_reward_refreshActions)
endfunction

//===========================================================================
// Trigger: reward-absoTime
//===========================================================================
function Trig_reward_absoTimeConditions takes nothing returns boolean
    return ((CountUnitsInGroup(udg_groupDrop) > 0))
endfunction

function Trig_reward_absoTimeFunc003Func001Func004Func006T takes nothing returns nothing
    set udg_dummy = YDLocalGet(GetExpiredTimer(), unit, "u")
    set udg_hero = YDLocalGet(GetExpiredTimer(), unit, "h")
    call SetUnitX(udg_dummy, YDWEOperatorReal3(GetUnitX(udg_dummy), +, YDLocalGet(GetExpiredTimer(), real, "sp"), *, CosBJ(YDWEAngleBetweenUnits(udg_dummy, udg_hero))))
    call SetUnitY(udg_dummy, YDWEOperatorReal3(GetUnitY(udg_dummy), +, YDLocalGet(GetExpiredTimer(), real, "sp"), *, SinBJ(YDWEAngleBetweenUnits(udg_dummy, udg_hero))))
    call YDLocalSet(GetExpiredTimer(), real, "sp", (YDLocalGet(GetExpiredTimer(), real, "sp") + 0.02))
    if ((GetUnitState(udg_hero, UNIT_STATE_LIFE) > 0.00) and (YDWEDistanceBetweenUnits(udg_dummy, udg_hero) > 20.00)) then
        return
    else
    endif
    set udg_real = GetUnitState(udg_dummy, UNIT_STATE_LIFE)
    call KillUnit(udg_dummy)
    set udg_int = GetConvertedPlayerId(GetOwningPlayer(udg_hero))
    if ((GetUnitTypeId(udg_dummy) == 'e001')) then
        call addExp(udg_hero, udg_real)
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", udg_hero, "origin"))
    else
        if ((GetUnitTypeId(udg_dummy) == 'e00H')) then
            call AdjustPlayerStateBJ(R2I(udg_real), GetOwningPlayer(udg_hero), PLAYER_STATE_RESOURCE_GOLD)
            call DestroyEffect(AddSpecialEffectTarget("UI\\Feedback\\GoldCredit\\GoldCredit.mdl", udg_hero, "origin"))
            set udg_str = YDWEOperatorString3("|cffffff00G+", I2S(R2I(udg_real)), "|r")
            call CreateTextTagUnitBJ(udg_str, udg_hero, 0, 11.00, 100, 100, 100, 0)
            call SetTextTagPermanent(bj_lastCreatedTextTag, false)
            call SetTextTagFadepoint(bj_lastCreatedTextTag, 3.00)
            call SetTextTagLifespan(bj_lastCreatedTextTag, 5.00)
            call SetTextTagVelocity(bj_lastCreatedTextTag, 0.00, GetRandomReal(0.01, 0.04))
            call SetTextTagVisibility(bj_lastCreatedTextTag, false)
            call ShowTextTagForceBJ(true, bj_lastCreatedTextTag, udg_pgroupHeros[udg_int])
        else
            if ((GetUnitTypeId(udg_dummy) == 'e002')) then
                call addHeal(udg_hero, 150)
                call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", udg_hero, "origin"))
            else
                if ((GetUnitTypeId(udg_dummy) == 'e00I')) then
                    call SetHeroLevel(udg_hero, (GetHeroLevel(udg_hero) + 1), true)
                    call addBloodNumber(udg_hero, 5)
                    set udg_str = "|cffee5555尊贵之血！"
                    call CreateTextTagUnitBJ(udg_str, udg_hero, 0, 11.00, 100, 100, 100, 0)
                    call SetTextTagPermanent(bj_lastCreatedTextTag, false)
                    call SetTextTagFadepoint(bj_lastCreatedTextTag, 3.00)
                    call SetTextTagLifespan(bj_lastCreatedTextTag, 5.00)
                    call SetTextTagVelocity(bj_lastCreatedTextTag, 0.01, -0.01)
                    call SetTextTagVisibility(bj_lastCreatedTextTag, false)
                    call ShowTextTagForceBJ(true, bj_lastCreatedTextTag, udg_pgroupHeros[udg_int])
                else
                endif
            endif
        endif
    endif
    call YDLocal3Release()
    call DestroyTimer(GetExpiredTimer())
endfunction

function Trig_reward_absoTimeFunc003A takes nothing returns nothing
    local timer ydl_timer
    if ((GetUnitState(GetEnumUnit(), UNIT_STATE_LIFE) > 0.00) and (GetOwningPlayer(GetEnumUnit()) == Player(PLAYER_NEUTRAL_PASSIVE))) then
        if ((udg_Heros[udg_intDropPairs] != null)) then
            set udg_real = YDWEDistanceBetweenUnits(udg_Heros[udg_intDropPairs], GetEnumUnit())
            set udg_real2 = YDWEOperatorReal3(getState(udg_Heros[udg_intDropPairs], "拾取范围"), +, 50.00, *, I2R(GetUnitAbilityLevel(udg_Heros[udg_intDropPairs], 'AB0A')))
            if ((udg_real > udg_real2)) then
                set ydl_timer = null
                return
            else
            endif
            call GroupRemoveUnit(udg_groupDrop, GetEnumUnit())
            call UnitPauseTimedLife(GetEnumUnit(), true)
            set ydl_timer = CreateTimer()
            call YDLocalSet(ydl_timer, unit, "u", GetEnumUnit())
            call YDLocalSet(ydl_timer, unit, "h", udg_Heros[udg_intDropPairs])
            call YDLocalSet(ydl_timer, real, "sp", 15.00)
            call TimerStart(ydl_timer, 0.02, true, function Trig_reward_absoTimeFunc003Func001Func004Func006T)
        else
        endif
    else
        call GroupRemoveUnit(udg_groupDrop, GetEnumUnit())
    endif
    set ydl_timer = null
endfunction

function Trig_reward_absoTimeActions takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    local timer ydl_timer
    YDLocalInitialize()
    set udg_intDropPairs = (udg_intDropPairs + 1)
    if ((udg_intDropPairs == 5)) then
        set udg_intDropPairs = 1
    else
    endif
    call ForGroupBJ(udg_groupDrop, function Trig_reward_absoTimeFunc003A)
    call YDLocal1Release()
    set ydl_group = null
    set ydl_unit = null
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_reward_absoTime takes nothing returns nothing
    set gg_trg_reward_absoTime = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_reward_absoTime, "reward-absoTime")
#endif
    call TriggerRegisterTimerEventPeriodic(gg_trg_reward_absoTime, 0.20)
    call TriggerAddCondition(gg_trg_reward_absoTime, Condition(function Trig_reward_absoTimeConditions))
    call TriggerAddAction(gg_trg_reward_absoTime, function Trig_reward_absoTimeActions)
endfunction

//===========================================================================
// Trigger: reward-box
//===========================================================================
function Trig_reward_boxConditions takes nothing returns boolean
    return ((GetItemType(GetManipulatedItem()) == ITEM_TYPE_POWERUP))
endfunction

function Trig_reward_boxFunc005Func006Func004Func002T takes nothing returns nothing
    call YDLocalSet(GetExpiredTimer(), real, "speed", ((YDLocalGet(GetExpiredTimer(), real, "distance") / YDLocalGet(GetExpiredTimer(), real, "time")) * 0.02))
    call SetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDWEOperatorReal3(GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy")), +, YDLocalGet(GetExpiredTimer(), real, "speed"), *, CosBJ(YDLocalGet(GetExpiredTimer(), degree, "angle"))))
    call SetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDWEOperatorReal3(GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy")), +, YDLocalGet(GetExpiredTimer(), real, "speed"), *, SinBJ(YDLocalGet(GetExpiredTimer(), degree, "angle"))))
    call YDLocalSet(GetExpiredTimer(), real, "passtime", (YDLocalGet(GetExpiredTimer(), real, "passtime") + 0.02))
    call YDLocalSet(GetExpiredTimer(), real, "high", (YDWEOperatorReal3(YDWEOperatorReal3(1.00, *, YDLocalGet(GetExpiredTimer(), real, "passtime"), +, 0.02), *, YDWEOperatorReal3(-1.00, *, YDLocalGet(GetExpiredTimer(), real, "passtime"), +, 0.82), +, 0.00) * 1500.00))
    call SetUnitFlyHeight(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDLocalGet(GetExpiredTimer(), real, "high"), 999.00)
    if ((YDLocalGet(GetExpiredTimer(), real, "passtime") >= YDLocalGet(GetExpiredTimer(), real, "time"))) then
        set udg_int = YDLocalGet(GetExpiredTimer(), integer, "reward")
        set udg_point = GetUnitLoc(YDLocalGet(GetExpiredTimer(), unit, "dummy"))
        call DestroyEffect(AddSpecialEffectLoc("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl", udg_point))
        call CreateItem(udg_int, GetLocationX(udg_point), GetLocationY(udg_point))
        call RemoveLocation(udg_point)
        call KillUnit(YDLocalGet(GetExpiredTimer(), unit, "dummy"))
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
    endif
endfunction

function Trig_reward_boxActions takes nothing returns nothing
    local timer ydl_timer
    YDLocalInitialize()
    call YDWETimerRemoveItem(0.01, GetManipulatedItem())
    set udg_itemType = GetItemTypeId(GetManipulatedItem())
    set udg_hero = GetTriggerUnit()
    if ((udg_itemType == 'Is00')) then
        set udg_str = getBoxReward(GetTriggerUnit())
        set udg_point = GetUnitLoc(GetTriggerUnit())
        set udg_real = GetRandomReal(0, 360.00)
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = 3
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            set udg_str2 = SubString(udg_str, (bj_forLoopAIndex - 1), bj_forLoopAIndex)
            call Debug("boxOpen|str="+udg_str+"|tar="+udg_str2)
            if ((udg_str2 == "1")) then
                set udg_unit = CreateUnitAtLoc(Player(PLAYER_NEUTRAL_PASSIVE), 'e00G', udg_point, GetRandomDirectionDeg())
            else
                if ((udg_str2 == "2")) then
                    set udg_unit = CreateUnitAtLoc(Player(PLAYER_NEUTRAL_PASSIVE), 'e00F', udg_point, GetRandomDirectionDeg())
                else
                    if ((udg_str2 == "3")) then
                        set udg_unit = CreateUnitAtLoc(Player(PLAYER_NEUTRAL_PASSIVE), 'e00E', udg_point, GetRandomDirectionDeg())
                    else
                        set udg_unit = null
                    endif
                endif
            endif
            if ((udg_unit != null)) then
                call DestroyEffect(AddSpecialEffectLoc("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl", udg_point))
                set ydl_timer = CreateTimer()
                call YDLocalSet(ydl_timer, unit, "dummy", udg_unit)
                call YDLocalSet(ydl_timer, degree, "angle", OperatorDegreeAdd(YDWER2Deg(udg_real), OperatorDegreeMultiply(120.00, I2R(bj_forLoopAIndex))))
                call YDLocalSet(ydl_timer, real, "distance", 240.00)
                call YDLocalSet(ydl_timer, real, "time", 0.80)
                call YDLocalSet(ydl_timer, real, "passtime", 0.00)
                call YDLocalSet(ydl_timer, real, "high", 0.00)
                call YDLocalSet(ydl_timer, integer, "reward", achieveBoxReward(GetTriggerUnit(), udg_str2))
                call YDLocalSet(ydl_timer, real, "speed", YDLocal1Get(real, "speed"))
                call TimerStart(ydl_timer, 0.02, true, function Trig_reward_boxFunc005Func006Func004Func002T)
            else
            endif
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
        call RemoveLocation(udg_point)
    else
        if (             (udg_itemType>=ABIITEM_FRISTID and udg_itemType<ABIITEM_ENDID)) then
            set udg_int = udg_itemType - ABIITEM_FRISTID + ABI_FRISTID
            call addBaseAbi(udg_hero, udg_int)
            call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIsm\\AIsmTarget.mdl", udg_hero, "origin"))
        else
            if ((udg_itemType == 'It01')) then
                call addHeal(udg_hero, 240)
            else
            endif
        endif
    endif
    if ((GetUnitAbilityLevel(udg_hero, 'AB0O') > 0)) then
        set udg_real = (YDWEOperatorReal3(0.00, +, 50.00, *, I2R(GetUnitAbilityLevel(udg_hero, 'AB0O'))) + (30.00 * I2R(GetHeroLevel(udg_hero))))
        call addExp(udg_hero, udg_real)
        call addHeal(udg_hero, 50)
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", udg_hero, "origin"))
    else
    endif
    call YDLocal1Release()
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_reward_box takes nothing returns nothing
    set gg_trg_reward_box = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_reward_box, "reward-box")
#endif
    call TriggerRegisterAnyUnitEventBJ(gg_trg_reward_box, EVENT_PLAYER_UNIT_DROP_ITEM)
    call TriggerAddCondition(gg_trg_reward_box, Condition(function Trig_reward_boxConditions))
    call TriggerAddAction(gg_trg_reward_box, function Trig_reward_boxActions)
endfunction

//===========================================================================
// Trigger: blood-dmg
//===========================================================================
function Trig_blood_dmgConditions takes nothing returns boolean
    return ((GetPlayerController(GetOwningPlayer(GetEventDamageSource())) == MAP_CONTROL_USER) and (GetOwningPlayer(GetTriggerUnit()) != GetOwningPlayer(GetEventDamageSource())) and (GetOwningPlayer(GetTriggerUnit()) != Player(bj_PLAYER_NEUTRAL_VICTIM)) and (GetEventDamage() > 0.00))
endfunction

function Trig_blood_dmgFunc006Func004T takes nothing returns nothing
    call YDLocalSet(GetExpiredTimer(), real, "dis", (YDLocalGet(GetExpiredTimer(), real, "dis") - YDLocalGet(GetExpiredTimer(), real, "sp")))
    call YDLocalSet(GetExpiredTimer(), real, "x", GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "unit")))
    call YDLocalSet(GetExpiredTimer(), real, "y", GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "unit")))
    call YDLocalSet(GetExpiredTimer(), real, "x", YDWEOperatorReal3(YDLocalGet(GetExpiredTimer(), real, "x"), +, YDLocalGet(GetExpiredTimer(), real, "sp"), *, CosBJ(YDLocalGet(GetExpiredTimer(), degree, "ang"))))
    call YDLocalSet(GetExpiredTimer(), real, "y", YDWEOperatorReal3(YDLocalGet(GetExpiredTimer(), real, "y"), +, YDLocalGet(GetExpiredTimer(), real, "sp"), *, SinBJ(YDLocalGet(GetExpiredTimer(), degree, "ang"))))
    call SetUnitX(YDLocalGet(GetExpiredTimer(), unit, "unit"), YDLocalGet(GetExpiredTimer(), real, "x"))
    call SetUnitY(YDLocalGet(GetExpiredTimer(), unit, "unit"), YDLocalGet(GetExpiredTimer(), real, "y"))
    if ((YDLocalGet(GetExpiredTimer(), real, "cd") <= 0.00)) then
        call YDLocalSet(GetExpiredTimer(), real, "cd", 0.20)
        call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl", YDLocalGet(GetExpiredTimer(), real, "x"), YDLocalGet(GetExpiredTimer(), real, "y")))
    else
        call YDLocalSet(GetExpiredTimer(), real, "cd", (YDLocalGet(GetExpiredTimer(), real, "cd") - 0.02))
    endif
    if (((YDLocalGet(GetExpiredTimer(), real, "dis") < YDLocalGet(GetExpiredTimer(), real, "sp")) or (IsUnitAliveBJ(YDLocalGet(GetExpiredTimer(), unit, "unit")) == false))) then
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
    endif
endfunction

function Trig_blood_dmgFunc006Func005T takes nothing returns nothing
    call YDUserDataSet(unit, YDLocalGet(GetExpiredTimer(), unit, "unit"), "bk41-hitd", boolean, false)
endfunction

function Trig_blood_dmgActions takes nothing returns nothing
    local timer ydl_timer
    YDLocalInitialize()
    set udg_int = (GetConvertedPlayerId(GetOwningPlayer(GetEventDamageSource())) * 1)
    set udg_hero = udg_Heros[udg_int]
    set udg_unit = GetTriggerUnit()
    set udg_item = YDUserDataGet(unit, GetEventDamageSource(), "triItem", item)
    if ((getItemClass(GetItemTypeId(udg_item)) == "场地类") and (GetUnitAbilityLevel(udg_hero, 'AB0M') > 0)) then
        call UnitAddAbility(udg_unit, 'Ad05')
        call PauseUnit(udg_unit, true)
        call SetUnitAbilityLevel(udg_unit, 'Ad05', GetUnitAbilityLevel(udg_hero, 'AB0M'))
        call PauseUnit(udg_unit, false)
    else
    endif
    if (             (bloodAbilities[udg_int*100+41]) and (YDWEDistanceBetweenUnits(udg_hero, udg_unit) < 800.00) and (YDUserDataGet(unit, udg_unit, "bk41-hitd", boolean) == false)) then
        call IssueImmediateOrder(udg_unit, "stop")
        call YDUserDataSet(unit, udg_unit, "bk41-hitd", boolean, true)
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, unit, "unit", udg_unit)
        call YDLocalSet(ydl_timer, real, "dis", ((800.00 - YDWEDistanceBetweenUnits(udg_hero, udg_unit)) * (200.00 / 800.00)))
        call YDLocalSet(ydl_timer, real, "sp", 6.00)
        call YDLocalSet(ydl_timer, degree, "ang", YDWEAngleBetweenUnits(udg_hero, udg_unit))
        call YDLocalSet(ydl_timer, real, "cd", 0.20)
        call YDLocalSet(ydl_timer, real, "x", YDLocal1Get(real, "x"))
        call YDLocalSet(ydl_timer, real, "y", YDLocal1Get(real, "y"))
        call TimerStart(ydl_timer, 0.02, true, function Trig_blood_dmgFunc006Func004T)
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, unit, "unit", udg_unit)
        call TimerStart(ydl_timer, 2.00, false, function Trig_blood_dmgFunc006Func005T)
    else
        if (             (bloodAbilities[udg_int*100+63]) and (YDUserDataGet(unit, udg_unit, "bk63-hitsource", unit) != GetEventDamageSource()) and (GetUnitAbilityLevel(GetEventDamageSource(), 'Ad06') > 0)) then
            call YDUserDataSet(unit, udg_unit, "bk63-hitsource", unit, GetEventDamageSource())
            set udg_real = YDWEOperatorReal3(I2R(GetHeroLevel(udg_hero)), *, 20.00, +, 150.00)
            call UnitDamageTarget(GetEventDamageSource(), udg_unit, udg_real, false, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
        else
        endif
    endif
    call YDLocal1Release()
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_blood_dmg takes nothing returns nothing
    set gg_trg_blood_dmg = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_blood_dmg, "blood-dmg")
#endif
    call YDWESyStemAnyUnitDamagedRegistTrigger(gg_trg_blood_dmg)
    call TriggerAddCondition(gg_trg_blood_dmg, Condition(function Trig_blood_dmgConditions))
    call TriggerAddAction(gg_trg_blood_dmg, function Trig_blood_dmgActions)
endfunction

//===========================================================================
// Trigger: blood-bedmg
//===========================================================================
function Trig_blood_bedmgConditions takes nothing returns boolean
    return ((GetEventDamage() > 0.00))
endfunction

function Trig_blood_bedmgFunc005Func001T takes nothing returns nothing
    call SetUnitInvulnerable(YDLocalGet(GetExpiredTimer(), unit, "hero"), true)
endfunction

function Trig_blood_bedmgFunc005Func002T takes nothing returns nothing
    call SetUnitInvulnerable(YDLocalGet(GetExpiredTimer(), unit, "hero"), false)
    call DestroyEffect(YDLocalGet(GetExpiredTimer(), effect, "eff"))
endfunction

function Trig_blood_bedmgActions takes nothing returns nothing
    local timer ydl_timer
    YDLocalInitialize()
    set udg_hero = GetTriggerUnit()
    set udg_unit = GetEventDamageSource()
    set udg_int = (GetConvertedPlayerId(GetOwningPlayer(udg_hero)) * 1)
    if (             (bloodAbilities[udg_int*100+31])) then
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, unit, "hero", udg_hero)
        call TimerStart(ydl_timer, 0.00, false, function Trig_blood_bedmgFunc005Func001T)
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, unit, "hero", udg_hero)
        call YDLocalSet(ydl_timer, effect, "eff", AddSpecialEffectTarget("Abilities\\Spells\\Human\\DivineShield\\DivineShieldTarget.mdl", udg_hero, "origin"))
        call TimerStart(ydl_timer, 2.50, false, function Trig_blood_bedmgFunc005Func002T)
    else
    endif
    if (             (bloodAbilities[udg_int*100+63])) then
        set udg_point = GetUnitLoc(udg_unit)
        set udg_dummy = CreateUnitAtLoc(GetOwningPlayer(udg_hero), 'e00D', udg_point, 0)
        call YDUserDataSet(unit, udg_dummy, "cast", string, "灵魂契约")
        call YDUserDataSet(unit, udg_dummy, "icon", string, "ReplaceableTextures\\CommandButtons\\BTNEnchantedCrows.blp")
        call YDUserDataSet(unit, udg_dummy, "color", string, "|cff6699ff")
        call UnitAddAbility(udg_dummy, 'Ad06')
        call UnitApplyTimedLife(udg_dummy, 'BHwe', 1.00)
        call IssueImmediateOrder(udg_dummy, "fanofknives")
        call RemoveLocation(udg_point)
    else
    endif
    call YDLocal1Release()
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_blood_bedmg takes nothing returns nothing
    set gg_trg_blood_bedmg = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_blood_bedmg, "blood-bedmg")
#endif
    call TriggerAddCondition(gg_trg_blood_bedmg, Condition(function Trig_blood_bedmgConditions))
    call TriggerAddAction(gg_trg_blood_bedmg, function Trig_blood_bedmgActions)
endfunction

//===========================================================================
// Trigger: blood-timer
//===========================================================================
function Trig_blood_timerFunc001Func004Func001Func003Func002Func004Func012Func001Func001Func001Func010003001 takes nothing returns boolean
    return ((GetFilterPlayer() != GetOwningPlayer(udg_hero)))
endfunction

function Trig_blood_timerFunc001Func004Func001Func003Func002Func004Func012Func001Func011003001 takes nothing returns boolean
    return ((GetFilterPlayer() != GetOwningPlayer(udg_hero)))
endfunction

function Trig_blood_timerFunc001Func004Func001Func003Func002Func004T takes nothing returns nothing
    set udg_dummy = YDLocalGet(GetExpiredTimer(), unit, "u")
    set udg_hero = YDLocalGet(GetExpiredTimer(), unit, "h")
    call SetUnitX(udg_dummy, YDWEOperatorReal3(GetUnitX(udg_dummy), +, YDLocalGet(GetExpiredTimer(), real, "sp"), *, CosBJ(YDWEAngleBetweenUnits(udg_dummy, udg_hero))))
    call SetUnitY(udg_dummy, YDWEOperatorReal3(GetUnitY(udg_dummy), +, YDLocalGet(GetExpiredTimer(), real, "sp"), *, SinBJ(YDWEAngleBetweenUnits(udg_dummy, udg_hero))))
    call YDLocalSet(GetExpiredTimer(), real, "sp", (YDLocalGet(GetExpiredTimer(), real, "sp") + 0.02))
    if ((GetUnitState(udg_hero, UNIT_STATE_LIFE) > 0.00) and (YDWEDistanceBetweenUnits(udg_dummy, udg_hero) > 20.00)) then
        return
    else
    endif
    set udg_real = GetUnitState(udg_dummy, UNIT_STATE_LIFE)
    call KillUnit(udg_dummy)
    if ((GetUnitTypeId(udg_dummy) == 'e001')) then
        call addExp(udg_hero, udg_real)
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", udg_hero, "origin"))
    else
        if ((GetUnitTypeId(udg_dummy) == 'e00H')) then
            call AdjustPlayerStateBJ(R2I(udg_real), GetOwningPlayer(udg_hero), PLAYER_STATE_RESOURCE_GOLD)
            call DestroyEffect(AddSpecialEffectTarget("UI\\Feedback\\GoldCredit\\GoldCredit.mdl", udg_hero, "origin"))
            set udg_str = YDWEOperatorString3("|cffffff00G+", I2S(R2I(udg_real)), "|r")
            call CreateTextTagUnitBJ(udg_str, udg_hero, 0, 11.00, 100, 100, 100, 0)
            call SetTextTagPermanent(bj_lastCreatedTextTag, false)
            call SetTextTagFadepoint(bj_lastCreatedTextTag, 3.00)
            call SetTextTagLifespan(bj_lastCreatedTextTag, 5.00)
            call SetTextTagVelocity(bj_lastCreatedTextTag, 0.00, GetRandomReal(0.01, 0.04))
            call ShowTextTagForceBJ(false, bj_lastCreatedTextTag, GetPlayersMatching(Condition(function Trig_blood_timerFunc001Func004Func001Func003Func002Func004Func012Func001Func011003001)))
        else
            if ((GetUnitTypeId(udg_dummy) == 'e002')) then
                call addHeal(udg_hero, 100)
                call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", udg_hero, "origin"))
            else
                if ((GetUnitTypeId(udg_dummy) == 'e00I')) then
                    call SetHeroLevel(udg_hero, (GetHeroLevel(udg_hero) + 1), true)
                    call AdjustPlayerStateBJ(1, GetOwningPlayer(udg_hero), PLAYER_STATE_RESOURCE_LUMBER)
                    set udg_str = "|cffee5555尊贵之血！"
                    call CreateTextTagUnitBJ(udg_str, udg_hero, 0, 11.00, 100, 100, 100, 0)
                    call SetTextTagPermanent(bj_lastCreatedTextTag, false)
                    call SetTextTagFadepoint(bj_lastCreatedTextTag, 3.00)
                    call SetTextTagLifespan(bj_lastCreatedTextTag, 5.00)
                    call SetTextTagVelocity(bj_lastCreatedTextTag, 0.01, -0.01)
                    call ShowTextTagForceBJ(false, bj_lastCreatedTextTag, GetPlayersMatching(Condition(function Trig_blood_timerFunc001Func004Func001Func003Func002Func004Func012Func001Func001Func001Func010003001)))
                else
                endif
            endif
        endif
    endif
    call YDLocal3Release()
    call DestroyTimer(GetExpiredTimer())
endfunction

function Trig_blood_timerFunc001Func004Func001Func003A takes nothing returns nothing
    local timer ydl_timer
    if ((udg_int > 15)) then
        set ydl_timer = null
        return
    else
    endif
    if ((YDWEDistanceBetweenUnits(udg_hero, GetEnumUnit()) < 8000.00)) then
        call GroupRemoveUnit(udg_groupDrop, GetEnumUnit())
        set udg_int = (udg_int + 1)
        call UnitPauseTimedLife(GetEnumUnit(), true)
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, unit, "u", GetEnumUnit())
        call YDLocalSet(ydl_timer, unit, "h", udg_hero)
        call YDLocalSet(ydl_timer, real, "sp", 18.00)
        call TimerStart(ydl_timer, 0.02, true, function Trig_blood_timerFunc001Func004Func001Func003Func002Func004T)
    else
    endif
    set ydl_timer = null
endfunction

function Trig_blood_timerFunc001A takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    local timer ydl_timer
    set udg_hero = GetEnumUnit()
    set udg_int = (GetConvertedPlayerId(GetOwningPlayer(udg_hero)) * 1)
    if (             (bloodAbilities[udg_int*100+12])) then
        if (((GetUnitState(udg_hero, UNIT_STATE_LIFE) / GetUnitState(udg_hero, UNIT_STATE_MAX_LIFE)) <= 0.30) and              (YDUserDataGet(unit, udg_hero, "bk13-eff", effect) == null)) then
            call Debug("TriBloodSkill-AR13")
            call YDUserDataSet(unit, udg_hero, "bk13-eff", effect, AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomTarget.mdl", udg_hero, "origin"))
        else
            call DestroyEffect(YDUserDataGet(unit, udg_hero, "bk13-eff", effect))
            call YDUserDataClear(unit, udg_hero, "bk13-eff", effect)
        endif
    else
    endif
    if (             (bloodAbilities[udg_int*100+22])) then
        if ((YDUserDataGet(unit, udg_hero, "bk22-time", real) >= 40.00)) then
            set udg_int = 0
            call ForGroupBJ(udg_groupDrop, function Trig_blood_timerFunc001Func004Func001Func003A)
            if ((udg_int > 10)) then
                call YDUserDataSet(unit, udg_hero, "bk22-time", real, (YDUserDataGet(unit, udg_hero, "bk22-time", real) - 1.00))
            else
                call YDUserDataSet(unit, udg_hero, "bk22-time", real, (YDUserDataGet(unit, udg_hero, "bk22-time", real) - 30.00))
            endif
            call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Andt\\Andt.mdl", udg_hero, "origin"))
            call Debug("TriBloodSkill-AR22")
        else
            call YDUserDataSet(unit, udg_hero, "bk22-time", real, (YDUserDataGet(unit, udg_hero, "bk22-time", real) + 0.50))
        endif
    else
    endif
    if (             (bloodAbilities[udg_int*100+62])) then
        if ((YDUserDataGet(unit, udg_hero, "bk62-pass", real) > 500.00)) then
            call YDUserDataSet(unit, udg_hero, "bk62-pass", real, 0.00)
            call YDLocal2Set(integer, "n", 0)
            set bj_forLoopAIndex = 0
            set bj_forLoopAIndexEnd = 5
            loop
                exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
                call YDLocal2ArraySet(item, "itms", (YDLocal2Get(integer, "n") + 1),UnitItemInSlot(udg_hero, bj_forLoopAIndex))
                if ((YDLocal2ArrayGet(item, "itms", (YDLocal2Get(integer, "n") + 1)) != null)) then
                    call YDLocal2Set(integer, "n", (YDLocal2Get(integer, "n") + 1))
                else
                endif
                set bj_forLoopAIndex = bj_forLoopAIndex + 1
            endloop
            if ((YDLocal2Get(integer, "n") > 0)) then
                set udg_item = YDLocal2ArrayGet(item, "itms", GetRandomInt(1, YDLocal2Get(integer, "n")))
                call setItemCD(udg_item, 0.6)
                call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl", udg_hero, "origin"))
                call Debug("TriBloodSkill-AR62"+T2S(udg_item))
            else
            endif
        else
        endif
        set udg_point = YDUserDataGet(unit, udg_hero, "bk62-last", location)
        set udg_point2 = YDUserDataGet(unit, udg_hero, "bk62-next", location)
        call YDUserDataSet(unit, udg_hero, "bk62-pass", real, (YDUserDataGet(unit, udg_hero, "bk62-pass", real) + DistanceBetweenPoints(udg_point, udg_point2)))
        call MoveLocation(udg_point, GetLocationX(udg_point2), GetLocationY(udg_point2))
        call MoveLocation(udg_point2, GetUnitX(udg_hero), GetUnitY(udg_hero))
    else
    endif
    set ydl_group = null
    set ydl_unit = null
    set ydl_timer = null
endfunction

function Trig_blood_timerActions takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    local timer ydl_timer
    YDLocalInitialize()
    call ForGroupBJ(udg_groupHero, function Trig_blood_timerFunc001A)
    call YDLocal1Release()
    set ydl_group = null
    set ydl_unit = null
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_blood_timer takes nothing returns nothing
    set gg_trg_blood_timer = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_blood_timer, "blood-timer")
#endif
    call TriggerRegisterTimerEventPeriodic(gg_trg_blood_timer, 0.50)
    call TriggerAddAction(gg_trg_blood_timer, function Trig_blood_timerActions)
endfunction

//===========================================================================
// Trigger: blood-kill
//===========================================================================
function Trig_blood_killConditions takes nothing returns boolean
    return ((GetPlayerController(GetOwningPlayer(GetKillingUnitBJ())) == MAP_CONTROL_USER) and (GetPlayerController(GetOwningPlayer(GetTriggerUnit())) == MAP_CONTROL_COMPUTER) and (GetOwningPlayer(GetTriggerUnit()) != Player(bj_PLAYER_NEUTRAL_VICTIM)) and (GetOwningPlayer(GetTriggerUnit()) != Player(PLAYER_NEUTRAL_PASSIVE)))
endfunction

function Trig_blood_killFunc007Func007T takes nothing returns nothing
    call YDLocalSet(GetExpiredTimer(), real, "speed", ((YDLocalGet(GetExpiredTimer(), real, "distance") / YDLocalGet(GetExpiredTimer(), real, "time")) * 0.02))
    call SetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDWEOperatorReal3(GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "dummy")), +, YDLocalGet(GetExpiredTimer(), real, "speed"), *, CosBJ(YDLocalGet(GetExpiredTimer(), degree, "angle"))))
    call SetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDWEOperatorReal3(GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "dummy")), +, YDLocalGet(GetExpiredTimer(), real, "speed"), *, SinBJ(YDLocalGet(GetExpiredTimer(), degree, "angle"))))
    call YDLocalSet(GetExpiredTimer(), real, "passtime", (YDLocalGet(GetExpiredTimer(), real, "passtime") + 0.02))
    call YDLocalSet(GetExpiredTimer(), real, "high", (YDWEOperatorReal3(YDWEOperatorReal3(1.00, *, YDLocalGet(GetExpiredTimer(), real, "passtime"), +, 0.02), *, YDWEOperatorReal3(-1.00, *, YDLocalGet(GetExpiredTimer(), real, "passtime"), +, 0.32), +, 0.00) * 4000.00))
    call SetUnitFlyHeight(YDLocalGet(GetExpiredTimer(), unit, "dummy"), YDLocalGet(GetExpiredTimer(), real, "high"), 999.00)
    if ((YDLocalGet(GetExpiredTimer(), real, "passtime") >= YDLocalGet(GetExpiredTimer(), real, "time"))) then
        call GroupAddUnit(udg_groupDrop, YDLocalGet(GetExpiredTimer(), unit, "dummy"))
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
    endif
endfunction

function Trig_blood_killFunc008Func003T takes nothing returns nothing
    call YDUserDataSet(unit, YDLocalGet(GetExpiredTimer(), unit, "hero"), "bk42-cd", boolean, false)
    call DestroyEffect(YDLocalGet(GetExpiredTimer(), effect, "eff"))
endfunction

function Trig_blood_killActions takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    local timer ydl_timer
    YDLocalInitialize()
    set udg_dummy = GetKillingUnitBJ()
    set udg_unit = GetTriggerUnit()
    set udg_player = GetOwningPlayer(udg_dummy)
    set udg_int = GetConvertedPlayerId(udg_player)
    set udg_hero = udg_Heros[udg_int]
    if (             (bloodAbilities[udg_int*100+11]) and              (calculateLuck(udg_hero, 20))) then
        call DisableTrigger(GetTriggeringTrigger())
        call YDUserDataSet(unit, udg_hero, "cast", string, "血爆")
        call YDUserDataSet(unit, udg_hero, "icon", string, "ReplaceableTextures\\CommandButtons\\BTNSoulBurn.blp")
        call YDUserDataSet(unit, udg_hero, "color", string, "|cffee6666")
        call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanLargeDeathExplode\\HumanLargeDeathExplode.mdl", GetUnitX(udg_unit), GetUnitY(udg_unit)))
        set udg_real = YDWEOperatorReal3(I2R(GetHeroLevel(udg_hero)), *, 8.00, +, 150.00)
        set ydl_group = CreateGroup()
        call GroupEnumUnitsInRange(ydl_group, GetUnitX(udg_unit), GetUnitY(udg_unit), 400.00, null)
        loop
            set ydl_unit = FirstOfGroup(ydl_group)
            exitwhen ydl_unit == null
            call GroupRemoveUnit(ydl_group, ydl_unit)
            if ((IsUnitEnemy(ydl_unit, udg_player) == true) and (IsUnitAliveBJ(ydl_unit) == true)) then
                call UnitDamageTarget(udg_hero, ydl_unit, udg_real, false, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
            else
            endif
        endloop
        call DestroyGroup(ydl_group)
        call EnableTrigger(GetTriggeringTrigger())
        call Debug("TriBloodSkill-AR11")
    else
    endif
    if (             (bloodAbilities[udg_int*100+21]) and              (calculateLuck(udg_hero, 15))) then
        set udg_point = GetUnitLoc(udg_unit)
        set udg_dummy = CreateUnitAtLoc(Player(PLAYER_NEUTRAL_PASSIVE), 'e001', udg_point, 0)
        set udg_real = YDWEOperatorReal3(50.00, +, (I2R(udg_gameTime_min) * 30.00), +, Pow(1.02, GetRandomReal(1.00, YDWEOperatorReal3(120.00, +, I2R(udg_gameTime_min), *, 12.00))))
        if ((udg_maxPlayer > 1)) then
            set udg_real = (udg_real * YDWEOperatorReal3(1.00, +, I2R(udg_maxPlayer), *, 0.05))
        else
        endif
        call SetUnitLifeBJ(udg_dummy, udg_real)
        call UnitApplyTimedLife(udg_dummy, 'BHwe', 360.00)
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, unit, "dummy", udg_dummy)
        call YDLocalSet(ydl_timer, degree, "angle", GetRandomDirectionDeg())
        call YDLocalSet(ydl_timer, real, "distance", 180.00)
        call YDLocalSet(ydl_timer, real, "time", 0.30)
        call YDLocalSet(ydl_timer, real, "passtime", 0.00)
        call YDLocalSet(ydl_timer, real, "high", 0.00)
        call YDLocalSet(ydl_timer, real, "speed", YDLocal1Get(real, "speed"))
        call TimerStart(ydl_timer, 0.02, true, function Trig_blood_killFunc007Func007T)
        call RemoveLocation(udg_point)
        call Debug("TriBloodSkill-AR21")
    else
    endif
    if (             (bloodAbilities[udg_int*100+42]) and (YDUserDataGet(unit, udg_hero, "bk42-cd", boolean) == false)) then
        set udg_point = GetUnitLoc(udg_unit)
        call YDUserDataSet(unit, udg_hero, "bk42-cd", boolean, true)
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, unit, "hero", udg_hero)
        call YDLocalSet(ydl_timer, effect, "eff", AddSpecialEffectLoc("Abilities\\Spells\\Undead\\DarkRitual\\DarkRitualTarget.mdl", udg_point))
        call TimerStart(ydl_timer, 3.00, false, function Trig_blood_killFunc008Func003T)
        set udg_dummy = CreateUnit(udg_player, 'e00D', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), 0)
        call UnitAddAbility(udg_dummy, 'Ad07')
        call UnitApplyTimedLife(udg_dummy, 'BHwe', 3.00)
        call Debug("TriBloodSkill-AR42")
    else
    endif
    if (             (bloodAbilities[udg_int*100+51]) and              (calculateLuck(udg_hero, 25))) then
        set udg_item = YDUserDataGet(unit, udg_dummy, "triItem", item)
        if ((udg_item != null)) then
            call setItemCD(udg_item, 0.3)
            call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl", udg_hero, "origin"))
        else
        endif
    else
    endif
    call YDLocal1Release()
    set ydl_group = null
    set ydl_unit = null
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_blood_kill takes nothing returns nothing
    set gg_trg_blood_kill = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_blood_kill, "blood-kill")
#endif
    call TriggerRegisterAnyUnitEventBJ(gg_trg_blood_kill, EVENT_PLAYER_UNIT_DEATH)
    call TriggerAddCondition(gg_trg_blood_kill, Condition(function Trig_blood_killConditions))
    call TriggerAddAction(gg_trg_blood_kill, function Trig_blood_killActions)
endfunction

//===========================================================================
// Trigger: egginit
//===========================================================================
function Trig_egginitFunc019A takes nothing returns nothing
    if ((GetUnitTypeId(GetEnumUnit()) == 'n000') and (RectContainsUnit(gg_rct_BarMap_2, GetEnumUnit()) == false)) then
        call GroupAddUnit(udg_groupEgg, GetEnumUnit())
        call ShowUnit(GetEnumUnit(), false)
    else
    endif
endfunction

function Trig_egginitFunc020T takes nothing returns nothing
    set udg_unit = GroupPickRandomUnit(udg_groupEgg)
    set udg_point = GetUnitLoc(udg_unit)
    call DisplayTextToPlayer(GetLocalPlayer(), 0, 0, "|cffffff00地图指定位置出现一个抽奖箱子！！|r")
    call PingMinimap(GetLocationX(udg_point), GetLocationY(udg_point), 5.00)
    call ShowUnit(udg_unit, true)
    call GroupRemoveUnit(udg_groupEgg, udg_unit)
    call RemoveLocation(udg_point)
    if ((CountUnitsInGroup(udg_groupEgg) == 0)) then
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
    endif
endfunction

function Trig_egginitActions takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    local timer ydl_timer
    set udg_eggs[1] = 'e003'
    set udg_eggs_reward[1] = 'Is00'
    set udg_eggs[2] = 'e004'
    set udg_eggs_reward[2] = 'It01'
    set udg_eggs[3] = 'e005'
    set udg_eggs_reward[3] = 'k3m3'
    set udg_eggs[4] = 'e006'
    set udg_eggs_reward[4] = 'mort'
    set udg_eggs[5] = 'e008'
    set udg_eggs_reward[5] = 'It00'
    set udg_eggs[6] = 'e009'
    set udg_eggs_reward[6] = 'ches'
    set udg_eggs[7] = 'e00A'
    set udg_eggs_reward[7] = 'ches'
    set udg_eggs[8] = 'e00B'
    set udg_eggs_reward[8] = 'It02'
    set udg_eggs[9] = 'e00C'
    set udg_eggs_reward[9] = 'ches'
    call ForGroupBJ(GetUnitsInRectAll(gg_rct_allMap), function Trig_egginitFunc019A)
    set ydl_timer = CreateTimer()
    call TimerStart(ydl_timer, 120.00, true, function Trig_egginitFunc020T)
    set ydl_group = null
    set ydl_unit = null
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_egginit takes nothing returns nothing
    set gg_trg_egginit = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_egginit, "egginit")
#endif
    call TriggerRegisterTimerEventSingle(gg_trg_egginit, 0.00)
    call TriggerAddAction(gg_trg_egginit, function Trig_egginitActions)
endfunction

//===========================================================================
// Trigger: active
//===========================================================================
function Trig_activeConditions takes nothing returns boolean
    return ((GetSpellAbilityId() == 'Aa09'))
endfunction

function Trig_activeFunc003T takes nothing returns nothing
    call UnitAddAbility(YDLocalGet(GetExpiredTimer(), unit, "unit"), 'Aa09')
    call DestroyEffect(YDLocalGet(GetExpiredTimer(), effect, "eff"))
endfunction

function Trig_activeFunc004T takes nothing returns nothing
    call YDLocalSet(GetExpiredTimer(), integer, "count", (YDLocalGet(GetExpiredTimer(), integer, "count") + 1))
    if ((ModuloInteger(YDLocalGet(GetExpiredTimer(), integer, "count"), 35) == 0)) then
        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Polymorph\\PolyMorphFallingSheepArt.mdl", (GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "unit")) + GetRandomReal(-200.00, 200.00)), (GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "unit")) + GetRandomReal(-200.00, 200.00))))
        call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl", YDLocalGet(GetExpiredTimer(), unit, "unit"), "overhead"))
    else
    endif
    if ((((YDLocalGet(GetExpiredTimer(), integer, "count") < 100) and (ModuloInteger(YDLocalGet(GetExpiredTimer(), integer, "count"), 6) == 0)) or ((YDLocalGet(GetExpiredTimer(), integer, "count") < 200) and (ModuloInteger(YDLocalGet(GetExpiredTimer(), integer, "count"), 8) == 0)) or ((YDLocalGet(GetExpiredTimer(), integer, "count") < 300) and (ModuloInteger(YDLocalGet(GetExpiredTimer(), integer, "count"), 10) == 0)) or ((YDLocalGet(GetExpiredTimer(), integer, "count") < 400) and (ModuloInteger(YDLocalGet(GetExpiredTimer(), integer, "count"), 12) == 0)) or ((YDLocalGet(GetExpiredTimer(), integer, "count") < 500) and (ModuloInteger(YDLocalGet(GetExpiredTimer(), integer, "count"), 14) == 0)) or ((YDLocalGet(GetExpiredTimer(), integer, "count") < 600) and (ModuloInteger(YDLocalGet(GetExpiredTimer(), integer, "count"), 16) == 0)) or ((YDLocalGet(GetExpiredTimer(), integer, "count") < 700) and (ModuloInteger(YDLocalGet(GetExpiredTimer(), integer, "count"), 18) == 0)) or ((YDLocalGet(GetExpiredTimer(), integer, "count") < 800) and (ModuloInteger(YDLocalGet(GetExpiredTimer(), integer, "count"), 20) == 0)) or ((YDLocalGet(GetExpiredTimer(), integer, "count") < 900) and (ModuloInteger(YDLocalGet(GetExpiredTimer(), integer, "count"), 24) == 0)) or ((YDLocalGet(GetExpiredTimer(), integer, "count") < 1000) and (ModuloInteger(YDLocalGet(GetExpiredTimer(), integer, "count"), 36) == 0)))) then
        if ((YDLocalGet(GetExpiredTimer(), integer, "typeid") < 8)) then
            call YDLocalSet(GetExpiredTimer(), integer, "typeid", (YDLocalGet(GetExpiredTimer(), integer, "typeid") + 1))
        else
            call YDLocalSet(GetExpiredTimer(), integer, "typeid", 1)
        endif
        call YDLocalSet(GetExpiredTimer(), unit, "dummy", CreateUnit(YDLocalGet(GetExpiredTimer(), player, "player"), udg_eggs[YDLocalGet(GetExpiredTimer(), integer, "typeid")], 0, 0, 0))
        call UnitApplyTimedLife(YDLocalGet(GetExpiredTimer(), unit, "dummy"), 'BHwe', YDWEOperatorReal3(0.10, +, YDLocalGet(GetExpiredTimer(), real, "count"), /, 50000.00))
    else
    endif
    if ((YDLocalGet(GetExpiredTimer(), integer, "count") >= 1000) and (ModuloInteger(YDLocalGet(GetExpiredTimer(), integer, "count"), 36) == 0)) then
        if ((YDLocalGet(GetExpiredTimer(), integer, "typeid") != YDLocalGet(GetExpiredTimer(), integer, "result"))) then
            if ((YDLocalGet(GetExpiredTimer(), integer, "typeid") < 8)) then
                call YDLocalSet(GetExpiredTimer(), integer, "typeid", (YDLocalGet(GetExpiredTimer(), integer, "typeid") + 1))
            else
                call YDLocalSet(GetExpiredTimer(), integer, "typeid", 1)
            endif
            call YDLocalSet(GetExpiredTimer(), unit, "dummy", CreateUnit(YDLocalGet(GetExpiredTimer(), player, "player"), udg_eggs[YDLocalGet(GetExpiredTimer(), integer, "typeid")], 0, 0, 0))
            if ((YDLocalGet(GetExpiredTimer(), integer, "typeid") == YDLocalGet(GetExpiredTimer(), integer, "result"))) then
                call UnitApplyTimedLife(YDLocalGet(GetExpiredTimer(), unit, "dummy"), 'BHwe', 6.00)
            else
                call UnitApplyTimedLife(YDLocalGet(GetExpiredTimer(), unit, "dummy"), 'BHwe', 0.40)
            endif
        else
        endif
    else
    endif
    if ((YDLocalGet(GetExpiredTimer(), integer, "count") == 1400)) then
        if ((udg_eggs_reward[YDLocalGet(GetExpiredTimer(), integer, "result")] != 'ches')) then
            if ((udg_eggs_reward[YDLocalGet(GetExpiredTimer(), integer, "result")] == 'k3m3')) then
                set udg_item = CreateItem(baseItemList[GetRandomInt(1,baseItemNum)], GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "unit")), GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "unit")))
            else
                if ((udg_eggs_reward[YDLocalGet(GetExpiredTimer(), integer, "result")] == 'mort')) then
                    set udg_item = CreateItem(GetRandomInt('IA00','IA09'), GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "unit")), GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "unit")))
                else
                    set udg_item = CreateItem(udg_eggs_reward[YDLocalGet(GetExpiredTimer(), integer, "result")], GetUnitX(YDLocalGet(GetExpiredTimer(), unit, "unit")), GetUnitY(YDLocalGet(GetExpiredTimer(), unit, "unit")))
                endif
            endif
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl", GetItemX(udg_item), GetItemY(udg_item)))
            set udg_str = YDWEOperatorString3("抽中了|cffffcc00", GetItemName(udg_item), "|r!过会儿再来抽吧！")
        else
            set udg_str = "啥都没抽中！过会儿再来抽吧！"
        endif
        call CreateTextTagUnitBJ(udg_str, YDLocalGet(GetExpiredTimer(), unit, "unit"), 0, 11.00, 100, 100, 100, 0)
        call SetTextTagPermanent(bj_lastCreatedTextTag, false)
        call SetTextTagFadepoint(bj_lastCreatedTextTag, 5.00)
        call SetTextTagLifespan(bj_lastCreatedTextTag, 8.00)
        call SetTextTagVelocity(bj_lastCreatedTextTag, 0.00, 0.02)
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
    endif
endfunction

function Trig_activeActions takes nothing returns nothing
    local timer ydl_timer
    YDLocalInitialize()
    call UnitRemoveAbility(GetTriggerUnit(), GetSpellAbilityId())
    set ydl_timer = CreateTimer()
    call YDLocalSet(ydl_timer, unit, "unit", GetTriggerUnit())
    call YDLocalSet(ydl_timer, effect, "eff", AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl", GetTriggerUnit(), "overhead"))
    call TimerStart(ydl_timer, 120.00, false, function Trig_activeFunc003T)
    set ydl_timer = CreateTimer()
    call YDLocalSet(ydl_timer, integer, "result", GetRandomInt(1, 8))
    call YDLocalSet(ydl_timer, integer, "count", 0)
    call YDLocalSet(ydl_timer, integer, "typeid", 0)
    call YDLocalSet(ydl_timer, player, "player", GetOwningPlayer(GetTriggerUnit()))
    call YDLocalSet(ydl_timer, unit, "unit", GetTriggerUnit())
    call YDLocalSet(ydl_timer, unit, "dummy", YDLocal1Get(unit, "dummy"))
    call TimerStart(ydl_timer, 0.01, true, function Trig_activeFunc004T)
    call YDLocal1Release()
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_active takes nothing returns nothing
    set gg_trg_active = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_active, "active")
#endif
    call TriggerRegisterAnyUnitEventBJ(gg_trg_active, EVENT_PLAYER_UNIT_SPELL_EFFECT)
    call TriggerAddCondition(gg_trg_active, Condition(function Trig_activeConditions))
    call TriggerAddAction(gg_trg_active, function Trig_activeActions)
endfunction

//===========================================================================
// Trigger: sort
//===========================================================================
function Trig_sortActions takes nothing returns nothing
endfunction

//===========================================================================
function InitTrig_sort takes nothing returns nothing
    set gg_trg_sort = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_sort, "sort")
#endif
    call TriggerAddAction(gg_trg_sort, function Trig_sortActions)
endfunction

//===========================================================================
// Trigger: saveData-kill
//===========================================================================
function Trig_saveData_killConditions takes nothing returns boolean
    return ((GetKillingUnitBJ() != null) and (GetOwningPlayer(GetTriggerUnit()) != GetOwningPlayer(GetKillingUnitBJ())) and (GetPlayerController(GetOwningPlayer(GetKillingUnitBJ())) == MAP_CONTROL_USER))
endfunction

function Trig_saveData_killActions takes nothing returns nothing
    set udg_int = GetConvertedPlayerId(GetOwningPlayer(GetKillingUnitBJ()))
    set udg_Heros_killCount[udg_int] = (udg_Heros_killCount[udg_int] + 1)
    if ((GetUnitAbilityLevel(udg_Heros[udg_int], 'AB0J') > 0)) then
        set udg_real = YDWEOperatorReal3(I2R(GetUnitAbilityLevel(udg_Heros[udg_int], 'AB0J')), *, 1.00, +, 0)
        call addHeal(udg_Heros[udg_int], udg_real)
    else
    endif
endfunction

//===========================================================================
function InitTrig_saveData_kill takes nothing returns nothing
    set gg_trg_saveData_kill = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_saveData_kill, "saveData-kill")
#endif
    call TriggerRegisterAnyUnitEventBJ(gg_trg_saveData_kill, EVENT_PLAYER_UNIT_DEATH)
    call TriggerAddCondition(gg_trg_saveData_kill, Condition(function Trig_saveData_killConditions))
    call TriggerAddAction(gg_trg_saveData_kill, function Trig_saveData_killActions)
endfunction

//===========================================================================
// Trigger: saveData-dmg
//===========================================================================
function Trig_saveData_dmgConditions takes nothing returns boolean
    return ((GetOwningPlayer(GetTriggerUnit()) != Player(bj_PLAYER_NEUTRAL_VICTIM)))
endfunction

function Trig_saveData_dmgFunc002Func022Func009T takes nothing returns nothing
    call YDLocalSet(GetExpiredTimer(), real, "c", (YDLocalGet(GetExpiredTimer(), real, "c") + 2.00))
    if ((YDLocalGet(GetExpiredTimer(), real, "c") > 80.00)) then
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
        if ((YDLocalGet(GetExpiredTimer(), real, "c") > 32.00)) then
            set udg_real = YDWEOperatorReal3(32.00, +, (YDLocalGet(GetExpiredTimer(), real, "c") - 32.00), *, 0.50)
        else
            set udg_real = YDLocalGet(GetExpiredTimer(), real, "c")
        endif
        set udg_real = ((0.02 * udg_real) * (75 - udg_real) + 3) * 0.4
        call SetTextTagTextBJ(YDLocalGet(GetExpiredTimer(), texttag, "float"), YDLocalGet(GetExpiredTimer(), StringExt, "s"), udg_real)
    endif
endfunction

function Trig_saveData_dmgActions takes nothing returns nothing
    local timer ydl_timer
    YDLocalInitialize()
    if ((GetOwningPlayer(GetTriggerUnit()) != GetOwningPlayer(GetEventDamageSource())) and (GetPlayerController(GetOwningPlayer(GetEventDamageSource())) == MAP_CONTROL_USER) and (GetEventDamage() > 2.00)) then
        set udg_int = GetConvertedPlayerId(GetOwningPlayer(GetEventDamageSource()))
        set udg_real = GetEventDamage()
        set udg_hero = udg_Heros[udg_int]
        set udg_item = YDUserDataGet(unit, GetEventDamageSource(), "triItem", item)
        set udg_itemType = YDUserDataGet(unit, GetEventDamageSource(), "triItemId", itemcode)
        call YDLocal1Set(string, "castName", getItemName(udg_itemType))
        call YDLocal1Set(string, "castIcon", getItemIcon(udg_itemType))
        if ((YDLocal1Get(string, "castName") == "")) then
            call YDLocal1Set(string, "castName", YDUserDataGet(unit, GetEventDamageSource(), "cast", string))
            call YDLocal1Set(string, "castIcon", YDUserDataGet(unit, GetEventDamageSource(), "icon", string))
            if ((YDLocal1Get(string, "castName") == "")) then
                set udg_item = YDUserDataGet(unit, GetEventDamageSource(), "triItem", item)
                call DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, 30, "|cffaa5555[错误]|r:一次错误的伤害")
                call DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, 30, YDWEOperatorString3("来源：", U2S(GetEventDamageSource()), ""))
                call DisplayTimedTextToPlayer(GetLocalPlayer(), 0, 0, 30, YDWEOperatorString3("物品：", YDWEId2S(udg_itemType), ""))
                call YDLocal1Release()
                set ydl_timer = null
                return
            else
            endif
        else
        endif
        set udg_flagCrit = false
        set udg_real2 = damageCount(udg_hero, GetTriggerUnit(), udg_real, udg_itemType)
        if ((udg_real2 != 0.00)) then
            if ((GetUnitState(GetTriggerUnit(), UNIT_STATE_LIFE) < udg_real2)) then
                call SetUnitLifeBJ(GetTriggerUnit(), 1.00)
            else
                call SetUnitLifeBJ(GetTriggerUnit(), (GetUnitState(GetTriggerUnit(), UNIT_STATE_LIFE) - udg_real2))
            endif
            set udg_real = (udg_real + udg_real2)
        else
        endif
        set udg_Heros_dmgCount[udg_int] = (udg_Heros_dmgCount[udg_int] + udg_real)
        set udg_int2 = YDWEOperatorInt3(udg_int, *, 100, +, 0)
        if ((udg_damageSave_N[udg_int] == 0)) then
            set udg_damageSave_N[udg_int] = (udg_damageSave_N[udg_int] + 1)
            set udg_int2 = (udg_int2 + 1)
        else
            set bj_forLoopAIndex = 1
            set bj_forLoopAIndexEnd = udg_damageSave_N[udg_int]
            loop
                exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
                set udg_int2 = (udg_int2 + 1)
                if ((YDLocal1Get(string, "castName") == udg_damageSave_cast[udg_int2])) then
                    call DoNothing() YDNL exitwhen true//()
                else
                    if ((udg_damageSave_N[udg_int] == bj_forLoopAIndex)) then
                        set udg_damageSave_N[udg_int] = (udg_damageSave_N[udg_int] + 1)
                        set udg_int2 = (udg_int2 + 1)
                    else
                    endif
                endif
                set bj_forLoopAIndex = bj_forLoopAIndex + 1
            endloop
        endif
        set udg_damageSave_cast[udg_int2] = YDLocal1Get(string, "castName")
        set udg_damageSave_icon[udg_int2] = YDLocal1Get(string, "castIcon")
        set udg_damageSave_value[udg_int2] = (udg_damageSave_value[udg_int2] + udg_real)
        if ((udg_flagShow[udg_int] == true)) then
            if ((udg_flagCrit == true)) then
                set udg_str = YDWEOperatorString3(getItemColor(udg_itemType), I2S(R2I(udg_real)), "!|r")
            else
                set udg_str = YDWEOperatorString3(getItemColor(udg_itemType), I2S(R2I(udg_real)), "|r")
            endif
            call CreateTextTagUnitBJ(udg_str, GetTriggerUnit(), 0, 1.00, 100, 100, 100, 0)
            call SetTextTagPermanent(bj_lastCreatedTextTag, false)
            call SetTextTagFadepoint(bj_lastCreatedTextTag, 1.50)
            call SetTextTagLifespan(bj_lastCreatedTextTag, 3.00)
            call SetTextTagVelocity(bj_lastCreatedTextTag, GetRandomReal(-0.03, 0.03), GetRandomReal(-0.05, 0.05))
            call SetTextTagVisibility(bj_lastCreatedTextTag, false)
            call ShowTextTagForceBJ(true, bj_lastCreatedTextTag, udg_pgroupHeros[udg_int])
            set ydl_timer = CreateTimer()
            call YDLocalSet(ydl_timer, texttag, "float", bj_lastCreatedTextTag)
            call YDLocalSet(ydl_timer, real, "c", 0.00)
            call YDLocalSet(ydl_timer, string, "s", udg_str)
            call TimerStart(ydl_timer, 0.02, true, function Trig_saveData_dmgFunc002Func022Func009T)
        else
        endif
    else
        if ((IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) == true) and (GetEventDamage() >= 1.00)) then
            set udg_int = GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))
            set udg_Heros_bedmgCount[udg_int] = (udg_Heros_bedmgCount[udg_int] + GetEventDamage())
            if ((udg_flagShow[udg_int] == true)) then
                set udg_str = YDWEOperatorString3("|cffeebb00*", I2S(R2I(GetEventDamage())), "*|r")
                call CreateTextTagUnitBJ(udg_str, GetTriggerUnit(), 0, 12.00, 100, 100, 100, 0)
                call SetTextTagPermanent(bj_lastCreatedTextTag, false)
                call SetTextTagFadepoint(bj_lastCreatedTextTag, 2.00)
                call SetTextTagLifespan(bj_lastCreatedTextTag, 4.00)
                call SetTextTagVelocity(bj_lastCreatedTextTag, GetRandomReal(-0.01, 0.01), 0.00)
                call SetTextTagVisibility(bj_lastCreatedTextTag, false)
                call ShowTextTagForceBJ(true, bj_lastCreatedTextTag, udg_pgroupHeros[udg_int])
            else
            endif
        else
        endif
    endif
    call YDLocal1Release()
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_saveData_dmg takes nothing returns nothing
    set gg_trg_saveData_dmg = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_saveData_dmg, "saveData-dmg")
#endif
    call YDWESyStemAnyUnitDamagedRegistTrigger(gg_trg_saveData_dmg)
    call TriggerAddCondition(gg_trg_saveData_dmg, Condition(function Trig_saveData_dmgConditions))
    call TriggerAddAction(gg_trg_saveData_dmg, function Trig_saveData_dmgActions)
endfunction

//===========================================================================
// Trigger: score
//===========================================================================
function Trig_scoreActions takes nothing returns nothing
    set udg_str = ""
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = udg_maxPlayer
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        set udg_int3 = bj_forLoopAIndex
        set udg_player = ConvertedPlayer(bj_forLoopAIndex)
        set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, 0, 3)
        set udg_str = I2S(udg_Heros_killCount[udg_int3])
        call boardSetValue(udg_player, udg_gameBoardCeil, udg_str)
        set bj_forLoopBIndex = 1
        set bj_forLoopBIndexEnd = udg_damageSave_N[udg_int3]
        loop
            exitwhen bj_forLoopBIndex > bj_forLoopBIndexEnd
            set udg_int = YDWEOperatorInt3(udg_int3, *, 100, +, bj_forLoopBIndex)
            set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, (bj_forLoopBIndex + 1), 0)
            set udg_str = udg_damageSave_icon[udg_int]
            call boardSetIcon(udg_player, udg_gameBoardCeil, udg_str)
            set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, (bj_forLoopBIndex + 1), 1)
            set udg_str = udg_damageSave_cast[udg_int]
            call boardSetValue(udg_player, udg_gameBoardCeil, udg_str)
            set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, (bj_forLoopBIndex + 1), 3)
            if ((udg_gameBoradDmgValue[udg_int] < R2I(udg_damageSave_value[udg_int]))) then
                set udg_int2 = (R2I(udg_damageSave_value[udg_int]) - udg_gameBoradDmgValue[udg_int])
                if ((udg_int2 > 100)) then
                    set udg_gameBoradDmgValue[udg_int] = (udg_gameBoradDmgValue[udg_int] + GetRandomInt((udg_int2 / 20), (udg_int2 / 5)))
                else
                    set udg_gameBoradDmgValue[udg_int] = (udg_gameBoradDmgValue[udg_int] + 1)
                endif
            else
            endif
            set udg_str = I2S(udg_gameBoradDmgValue[udg_int])
            call boardSetValue(udg_player, udg_gameBoardCeil, udg_str)
            set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, (bj_forLoopBIndex + 1), 5)
            set udg_str = I2S(udg_gameBoradDPSValue[udg_int])
            call boardSetValue(udg_player, udg_gameBoardCeil, udg_str)
            set bj_forLoopBIndex = bj_forLoopBIndex + 1
        endloop
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
endfunction

//===========================================================================
function InitTrig_score takes nothing returns nothing
    set gg_trg_score = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_score, "score")
#endif
    call TriggerAddAction(gg_trg_score, function Trig_scoreActions)
endfunction

//===========================================================================
// Trigger: dps
//===========================================================================
function Trig_dpsActions takes nothing returns nothing
    set bj_forLoopAIndex = 1
    set bj_forLoopAIndexEnd = udg_maxPlayer
    loop
        exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
        set bj_forLoopBIndex = 1
        set bj_forLoopBIndexEnd = udg_damageSave_N[bj_forLoopAIndex]
        loop
            exitwhen bj_forLoopBIndex > bj_forLoopBIndexEnd
            set udg_int = YDWEOperatorInt3(bj_forLoopAIndex, *, 100, +, bj_forLoopBIndex)
            set udg_gameBoradDPSValue[udg_int] = (udg_gameBoradDmgValue[udg_int] - udg_gameBoradDPSValueLastDmg[udg_int])
            set udg_gameBoradDPSValueLastDmg[udg_int] = udg_gameBoradDmgValue[udg_int]
            set bj_forLoopBIndex = bj_forLoopBIndex + 1
        endloop
        set bj_forLoopAIndex = bj_forLoopAIndex + 1
    endloop
endfunction

//===========================================================================
function InitTrig_dps takes nothing returns nothing
    set gg_trg_dps = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_dps, "dps")
#endif
    call TriggerRegisterTimerEventPeriodic(gg_trg_dps, 10.00)
    call TriggerAddAction(gg_trg_dps, function Trig_dpsActions)
endfunction

//===========================================================================
// Trigger: boardinit
//===========================================================================
function Trig_boardinitActions takes nothing returns nothing
    set udg_gameBorad = CreateMultiboard()
    call MultiboardDisplay(udg_gameBorad, true)
    call MultiboardSetRowCount(udg_gameBorad, (udg_boardLine + 2))
    call MultiboardSetColumnCount(udg_gameBorad, 6)
    call MultiboardSetItemsWidth(udg_gameBorad, 0.03)
    call MultiboardSetItemsStyle(udg_gameBorad, true, false)
    call MultiboardSetTitleText(udg_gameBorad, "吸！血！鬼！")
    set bj_forLoopBIndex = 0
    set bj_forLoopBIndexEnd = (udg_boardLine + 1)
    loop
        exitwhen bj_forLoopBIndex > bj_forLoopBIndexEnd
        call MultiboardReleaseItem(udg_gameBoardCeil)
        set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, bj_forLoopBIndex, 0)
        call MultiboardSetItemStyle(udg_gameBoardCeil, false, true)
        call MultiboardSetItemIcon(udg_gameBoardCeil, "ReplaceableTextures\\CommandButtons\\BTNCancel.blp")
        call MultiboardReleaseItem(udg_gameBoardCeil)
        set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, bj_forLoopBIndex, 1)
        call MultiboardSetItemValueColor(udg_gameBoardCeil, 75, 255, 75, 255)
        call MultiboardReleaseItem(udg_gameBoardCeil)
        set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, bj_forLoopBIndex, 3)
        call MultiboardSetItemValueColor(udg_gameBoardCeil, 255, 255, 0, 255)
        set bj_forLoopBIndex = bj_forLoopBIndex + 1
    endloop
    call MultiboardReleaseItem(udg_gameBoardCeil)
    set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, 0, 0)
    call MultiboardSetItemIcon(udg_gameBoardCeil, "ReplaceableTextures\\CommandButtons\\BTNLament.blp")
    call MultiboardReleaseItem(udg_gameBoardCeil)
    set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, 0, 1)
    call MultiboardSetItemValue(udg_gameBoardCeil, "击杀数")
    call MultiboardReleaseItem(udg_gameBoardCeil)
    set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, 0, 3)
    call MultiboardSetItemValue(udg_gameBoardCeil, "0")
    call MultiboardReleaseItem(udg_gameBoardCeil)
    set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, 1, 0)
    call MultiboardSetItemStyle(udg_gameBoardCeil, true, false)
    call MultiboardSetItemValue(udg_gameBoardCeil, "--------")
    call MultiboardReleaseItem(udg_gameBoardCeil)
    set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, 1, 1)
    call MultiboardSetItemValue(udg_gameBoardCeil, "列表")
    call MultiboardReleaseItem(udg_gameBoardCeil)
    set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, 1, 2)
    call MultiboardSetItemValue(udg_gameBoardCeil, "--------")
    call MultiboardReleaseItem(udg_gameBoardCeil)
    set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, 1, 3)
    call MultiboardSetItemValue(udg_gameBoardCeil, "伤害统计")
    call MultiboardReleaseItem(udg_gameBoardCeil)
    set udg_gameBoardCeil = MultiboardGetItem(udg_gameBorad, 1, 5)
    call MultiboardSetItemValue(udg_gameBoardCeil, "DPS/10秒")
endfunction

//===========================================================================
function InitTrig_boardinit takes nothing returns nothing
    set gg_trg_boardinit = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_boardinit, "boardinit")
#endif
    call TriggerRegisterTimerEventSingle(gg_trg_boardinit, 0.00)
    call TriggerAddAction(gg_trg_boardinit, function Trig_boardinitActions)
endfunction

//===========================================================================
// Trigger: YDWEINIT
//===========================================================================
function Trig_YDWEINITConditions takes nothing returns boolean
    return ((UnitHasItemOfTypeBJ(GetTriggerUnit(), 'texp') == true) and (YDWEGetUnitWoodCost('hfoo') == 0))
endfunction

function Trig_YDWEINITActions takes nothing returns nothing
    call YDUserDataSet(unit, null, "123", integer, 0)
    call KillUnit(YDUserDataGet(unit, null, "123", unit))
endfunction

//===========================================================================
function InitTrig_YDWEINIT takes nothing returns nothing
    set gg_trg_YDWEINIT = CreateTrigger()
    call DisableTrigger(gg_trg_YDWEINIT)
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_YDWEINIT, "YDWEINIT")
#endif
    call TriggerAddCondition(gg_trg_YDWEINIT, Condition(function Trig_YDWEINITConditions))
    call TriggerAddAction(gg_trg_YDWEINIT, function Trig_YDWEINITActions)
endfunction

//===========================================================================
// Trigger: gm
//===========================================================================
function Trig_gmFunc008Func011Func008Func001A takes nothing returns nothing
    call RemoveUnit(GetEnumUnit())
endfunction

function Trig_gmFunc009Func008T takes nothing returns nothing
    call SetUnitLifePercentBJ(udg_hero, 100)
endfunction

function Trig_gmFunc012Func003T takes nothing returns nothing
    if ((GetHeroLevel(YDLocalGet(GetExpiredTimer(), unit, "h")) == YDLocalGet(GetExpiredTimer(), integer, "max"))) then
        call YDLocal3Release()
        call DestroyTimer(GetExpiredTimer())
    else
        if ((GetHeroSkillPoints(YDLocalGet(GetExpiredTimer(), unit, "h")) < 20)) then
            call SetHeroLevel(YDLocalGet(GetExpiredTimer(), unit, "h"), (GetHeroLevel(YDLocalGet(GetExpiredTimer(), unit, "h")) + 1), true)
        else
        endif
    endif
endfunction

function Trig_gmFunc020Func002Func001A takes nothing returns nothing
    call RemoveUnit(GetEnumUnit())
endfunction

function Trig_gmActions takes nothing returns nothing
    local group ydl_group
    local unit ydl_unit
    local timer ydl_timer
    YDLocalInitialize()
    if ((GetEventPlayerChatString() == "-showoff")) then
        set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
        set udg_flagShow[udg_int] = false
        call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 30, "|cffffcc00[系统提示]|r：已关闭部分漂浮文字与特效表现！")
    else
    endif
    if ((SubString(GetEventPlayerChatString(), 0, 5) == "-item")) then
        set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
        set udg_hero = udg_Heros[udg_int]
        set udg_int2 = S2I(SubString(GetEventPlayerChatString(), 5, StringLength(GetEventPlayerChatString())))
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = udg_int2
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            call GetItemName(UnitItemInSlot(udg_Heros[udg_int], 0))
            call UnitAddItemByIdSwapped(GetItemTypeId(UnitItemInSlot(udg_hero, 0)), udg_hero)
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
    else
    endif
    if ((SubString(GetEventPlayerChatString(), 0, 6) == "-itemx")) then
        set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
        set udg_hero = udg_Heros[udg_int]
        set udg_int2 = S2I(SubString(GetEventPlayerChatString(), 6, StringLength(GetEventPlayerChatString())))
        call Debug("itemXX=" + I2S(udg_int2))
        call UnitAddItemByIdSwapped(baseItemList[udg_int2], udg_hero)
    else
    endif
    if ((SubString(GetEventPlayerChatString(), 0, 5) == "-abix")) then
        set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
        set udg_hero = udg_Heros[udg_int]
        set udg_int2 = S2I(SubString(GetEventPlayerChatString(), 5, StringLength(GetEventPlayerChatString())))
        call Debug("abiXX=" + I2S(udg_int2))
        call addBaseAbi(udg_hero, ABI_FRISTID + udg_int2 - 1)
        call SetUnitAbilityLevel(udg_hero, ABI_FRISTID + udg_int2 - 1, 10)
    else
    endif
    if ((GetEventPlayerChatString() == "-debug")) then
        set debugMode = not debugMode
    else
    endif
    if ((GetEventPlayerChatString() == "-bancd")) then
        call DisableTrigger(gg_trg_ItemCD)
    else
    endif
    if ((GetEventPlayerChatString() == "-dmg")) then
        set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = udg_damageSave_N[udg_int]
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            set udg_int2 = YDWEOperatorInt3(udg_int, *, 100, +, bj_forLoopAIndex)
            call DisplayTextToPlayer(GetTriggerPlayer(), 0, 0, YDWEOperatorString3(udg_damageSave_cast[udg_int2], "造成的伤害：", I2S(R2I(udg_damageSave_value[udg_int2]))))
            call DisplayTextToPlayer(GetTriggerPlayer(), 0, 0, udg_damageSave_icon[udg_int2])
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
    else
    endif
    if ((GetEventPlayerChatString() == "-restart")) then
        call DisplayTextToPlayer(GetTriggerPlayer(), 0, 0, "重置游戏状态！！")
        set udg_player = GetTriggerPlayer()
        set udg_int = GetConvertedPlayerId(udg_player)
        call GroupRemoveUnit(udg_groupHero, udg_Heros[udg_int])
        call RemoveUnit(udg_Heros[udg_int])
        set udg_Heros[udg_int] = CreateUnit(udg_player, 'U000', 0, 0, 0)
        call UnitAddItemByIdSwapped(udg_itemList[(GetRandomInt(1, udg_itemListNum) * 100)], udg_Heros[bj_forLoopAIndex])
        call SetCameraTargetControllerNoZForPlayer(udg_player, udg_Heros[udg_int], 0, 0, false)
        call GroupAddUnit(udg_groupHero, udg_Heros[udg_int])
        call oneAbilitySelect(udg_Heros[udg_int], true)
        if ((udg_maxPlayer == 1)) then
            set udg_armyMax = 7
            set udg_gameTime = 0
            set udg_gameTime_min = 0
            set udg_gameTime_sec = 0
            set udg_armyLevel = 1
            set udg_bossLevel = 0
            set bj_forLoopAIndex = 1
            set bj_forLoopAIndexEnd = 6
            loop
                exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
                call ForGroupBJ(udg_groupArmy[bj_forLoopAIndex], function Trig_gmFunc008Func011Func008Func001A)
                set bj_forLoopAIndex = bj_forLoopAIndex + 1
            endloop
        else
        endif
    else
    endif
    if ((GetEventPlayerChatString() == "-test")) then
        set debugMode = true
        set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
        set udg_hero = udg_Heros[udg_int]
        call SetUnitMoveSpeed(udg_hero, 522.00)
        call UnitAddAbility(udg_hero, 'ANbl')
        call CreateFogModifierRectBJ(true, GetTriggerPlayer(), FOG_OF_WAR_VISIBLE, GetPlayableMapRect())
        set ydl_timer = CreateTimer()
        call TimerStart(ydl_timer, 0.10, true, function Trig_gmFunc009Func008T)
    else
    endif
    if ((GetEventPlayerChatString() == "-box")) then
        set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
        set udg_hero = udg_Heros[udg_int]
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = 10
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            call CreateItem('Is00', (400.00 * CosBJ(YDWER2Deg((I2R(bj_forLoopAIndex) * 36.00)))), (400.00 * SinBJ(YDWER2Deg((I2R(bj_forLoopAIndex) * 36.00)))))
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
    else
    endif
    if ((GetEventPlayerChatString() == "-lv")) then
        set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
        set udg_unit = udg_Heros[udg_int]
        call SetHeroLevel(udg_unit, (GetHeroLevel(udg_unit) + 1), true)
    else
    endif
    if ((GetEventPlayerChatString() == "-lvm")) then
        set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
        set udg_hero = udg_Heros[udg_int]
        set ydl_timer = CreateTimer()
        call YDLocalSet(ydl_timer, integer, "max", (GetHeroLevel(udg_hero) + 25))
        call YDLocalSet(ydl_timer, unit, "h", udg_hero)
        call TimerStart(ydl_timer, 0.10, true, function Trig_gmFunc012Func003T)
    else
    endif
    if ((GetEventPlayerChatString() == "-army")) then
        call TriggerExecute(gg_trg_refresh)
    else
    endif
    if ((GetEventPlayerChatString() == "-pass")) then
        call StartTimerBJ(udg_systemTimer, true, 0.10)
    else
    endif
    if ((GetEventPlayerChatString() == "-passoff")) then
        call StartTimerBJ(udg_systemTimer, true, 1.00)
    else
    endif
    if ((GetEventPlayerChatString() == "-tti")) then
        set udg_int = 1
        loop
            exitwhen udg_int > 10
            call itemTrgSpell('I10A'+udg_int)
            call itemTrgSpell('I20A'+udg_int)
            call itemTrgSpell('I30A'+udg_int)
            set udg_int = udg_int + 1
        endloop
    else
    endif
    if ((GetEventPlayerChatString() == "-gold")) then
        call AdjustPlayerStateBJ(1000, GetTriggerPlayer(), PLAYER_STATE_RESOURCE_GOLD)
    else
    endif
    if ((GetEventPlayerChatString() == "-blood")) then
        set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
        set udg_hero = udg_Heros[udg_int]
        call addBloodNumber(udg_hero, 500)
    else
    endif
    if ((GetEventPlayerChatString() == "-lucky")) then
        set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
        set udg_hero = udg_Heros[udg_int]
        call SetHeroInt(udg_hero, 5000, true)
    else
    endif
    if ((GetEventPlayerChatString() == "-reoff")) then
        call DisableTrigger(gg_trg_refresh)
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = 8
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            call ForGroupBJ(udg_groupArmy[bj_forLoopAIndex], function Trig_gmFunc020Func002Func001A)
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
    else
    endif
    if ((GetEventPlayerChatString() == "-reon")) then
        call EnableTrigger(gg_trg_refresh)
    else
    endif
    if ((GetEventPlayerChatString() == "-cs")) then
        call clearSave(GetTriggerPlayer())
    else
    endif
    if ((GetEventPlayerChatString() == "-ss")) then
        call showSave(GetTriggerPlayer())
    else
    endif
    if ((GetEventPlayerChatString() == "-tid")) then
        set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
        set udg_hero = udg_Heros[udg_int]
        set udg_itemType = GetItemTypeId(UnitItemInSlotBJ(udg_hero, 1))
        call Debug(getItemClass(udg_itemType))
        call Debug(getItemDamageType(udg_itemType))
    else
    endif
    if ((GetEventPlayerChatString() == "-kb")) then
        set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
        set udg_hero = udg_Heros[udg_int]
        set udg_int2 = GetRandomInt(1, 6)
        set udg_unit = CreateUnitAtLoc(Player(4), 'hfoo', PolarProjectionBJ(GetUnitLoc(udg_hero), 750.00, GetRandomDirectionDeg()), 0)
        call TriggerRegisterUnitEvent(gg_trg_reward_bossRect, udg_unit, EVENT_UNIT_DEATH)
        call YDUserDataSet(unit, udg_unit, "id", integer, udg_int2)
        set udg_rectBoss[YDUserDataGet(unit, udg_unit, "id", integer)] = gg_rct_BarMap_2
        call UnitApplyTimedLife(udg_unit, 'BHwe', 0.10)
    else
    endif
    if ((GetEventPlayerChatString() == "-shock")) then
        set udg_int = GetConvertedPlayerId(GetTriggerPlayer())
        set udg_hero = udg_Heros[udg_int]
        set bj_forLoopAIndex = 1
        set bj_forLoopAIndexEnd = 8
        loop
            exitwhen bj_forLoopAIndex > bj_forLoopAIndexEnd
            set udg_dummy = CreateUnitAtLoc(GetTriggerPlayer(), 'uloc', PolarProjectionBJ(GetUnitLoc(udg_hero), 256, YDWER2Deg((I2R(bj_forLoopAIndex) * (360.00 / 8.00)))), 0)
            call UnitApplyTimedLife(udg_dummy, 'BHwe', 60.00)
            call ShockUwithU(udg_dummy,udg_hero,900,3,60,60)
            set bj_forLoopAIndex = bj_forLoopAIndex + 1
        endloop
    else
    endif
    call YDLocal1Release()
    set ydl_group = null
    set ydl_unit = null
    set ydl_timer = null
endfunction

//===========================================================================
function InitTrig_gm takes nothing returns nothing
    set gg_trg_gm = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_gm, "gm")
#endif
    call TriggerRegisterPlayerChatEvent(gg_trg_gm, Player(0), "", false)
    call TriggerRegisterPlayerChatEvent(gg_trg_gm, Player(1), "", false)
    call TriggerRegisterPlayerChatEvent(gg_trg_gm, Player(2), "", false)
    call TriggerRegisterPlayerChatEvent(gg_trg_gm, Player(3), "", false)
    call TriggerRegisterPlayerChatEvent(gg_trg_gm, Player(4), "", false)
    call TriggerAddAction(gg_trg_gm, function Trig_gmActions)
endfunction

//===========================================================================
// Trigger: test
//===========================================================================
function Trig_testFunc002Conditions takes nothing returns nothing
    call Debug(GetUnitName(GetTriggerUnit())+"施法")
    call Debug(GetAbilityName(GetSpellAbilityId())+"施法")
endfunction

function Trig_testActions takes nothing returns nothing
    local trigger ydl_trigger
    set ydl_trigger = CreateTrigger()
    call TriggerRegisterAnyUnitEventBJ(ydl_trigger, EVENT_PLAYER_UNIT_SPELL_EFFECT)
    call TriggerAddCondition(ydl_trigger, Condition(function Trig_testFunc002Conditions))
    set ydl_trigger = null
endfunction

//===========================================================================
function InitTrig_test takes nothing returns nothing
    set gg_trg_test = CreateTrigger()
#ifdef DEBUG
    call YDWESaveTriggerName(gg_trg_test, "test")
#endif
    call TriggerAddAction(gg_trg_test, function Trig_testActions)
endfunction

//===========================================================================
function InitCustomTriggers takes nothing returns nothing
    call InitTrig_overShow(  )
    call InitTrig_treeShow(  )
    call InitTrig_setting(  )
    call InitTrig_mode(  )
    call InitTrig_init(  )
    call InitTrig_Time(  )
    call InitTrig_camera(  )
    call InitTrig_gameOver(  )
    call InitTrig_dropItem(  )
    call InitTrig_getItem(  )
    call InitTrig_smart_Jass(  )
    call InitTrig_bossRect(  )
    call InitTrig_bossIns(  )
    call InitTrig_moveFix_1(  )
    call InitTrig_moveFix_2(  )
    call InitTrig_recall(  )
    call InitTrig_ItemSpell_1(  )
    call InitTrig_ItemSpell_2(  )
    call InitTrig_ItemSpell_3(  )
    call InitTrig_ItemSpell_4(  )
    call InitTrig_ItemSpell_5(  )
    call InitTrig_ItemSpell_6(  )
    call InitTrig_ItemSpell_7(  )
    call InitTrig_ItemSpell_8(  )
    call InitTrig_ItemSpell_9(  )
    call InitTrig_ItemSpell_10(  )
    call InitTrig_ItemSpell_11(  )
    call InitTrig_ItemSpell_12(  )
    call InitTrig_ItemSpell_13(  )
    call InitTrig_ItemSpell_14(  )
    call InitTrig_ItemSpell_15(  )
    call InitTrig_ItemSpell_16(  )
    call InitTrig_ItemSpell_17(  )
    call InitTrig_ItemSpell_18(  )
    call InitTrig_ItemSpell_19(  )
    call InitTrig_ItemSpell_20(  )
    call InitTrig_ItemSpell_21(  )
    call InitTrig_ItemSpell_22(  )
    call InitTrig_ItemSpell_23(  )
    call InitTrig_ItemSpell_24(  )
    call InitTrig_ItemSpell_25(  )
    call InitTrig_ItemCD(  )
    call InitTrig_armyinit_Jass(  )
    call InitTrig_refresh(  )
    call InitTrig_refresh_order(  )
    call InitTrig_refresh_finalBossDeath(  )
    call InitTrig_reward_bossRect(  )
    call InitTrig_reward_army(  )
    call InitTrig_reward_boss(  )
    call InitTrig_reward_getSelect(  )
    call InitTrig_reward_useSelect(  )
    call InitTrig_reward_refresh(  )
    call InitTrig_reward_absoTime(  )
    call InitTrig_reward_box(  )
    call InitTrig_blood_dmg(  )
    call InitTrig_blood_bedmg(  )
    call InitTrig_blood_timer(  )
    call InitTrig_blood_kill(  )
    call InitTrig_egginit(  )
    call InitTrig_active(  )
    call InitTrig_sort(  )
    call InitTrig_saveData_kill(  )
    call InitTrig_saveData_dmg(  )
    call InitTrig_score(  )
    call InitTrig_dps(  )
    call InitTrig_boardinit(  )
    call InitTrig_YDWEINIT(  )
    call InitTrig_gm(  )
    call InitTrig_test(  )
endfunction

//***************************************************************************
//*
//*  Players
//*
//***************************************************************************

function InitCustomPlayerSlots takes nothing returns nothing

    // Player 0
    call SetPlayerStartLocation( Player(0), 0 )
    call ForcePlayerStartLocation( Player(0), 0 )
    call SetPlayerColor( Player(0), ConvertPlayerColor(0) )
    call SetPlayerRacePreference( Player(0), RACE_PREF_UNDEAD )
    call SetPlayerRaceSelectable( Player(0), false )
    call SetPlayerController( Player(0), MAP_CONTROL_USER )

    // Player 1
    call SetPlayerStartLocation( Player(1), 1 )
    call ForcePlayerStartLocation( Player(1), 1 )
    call SetPlayerColor( Player(1), ConvertPlayerColor(1) )
    call SetPlayerRacePreference( Player(1), RACE_PREF_UNDEAD )
    call SetPlayerRaceSelectable( Player(1), false )
    call SetPlayerController( Player(1), MAP_CONTROL_USER )

    // Player 2
    call SetPlayerStartLocation( Player(2), 2 )
    call ForcePlayerStartLocation( Player(2), 2 )
    call SetPlayerColor( Player(2), ConvertPlayerColor(2) )
    call SetPlayerRacePreference( Player(2), RACE_PREF_UNDEAD )
    call SetPlayerRaceSelectable( Player(2), false )
    call SetPlayerController( Player(2), MAP_CONTROL_USER )

    // Player 3
    call SetPlayerStartLocation( Player(3), 3 )
    call ForcePlayerStartLocation( Player(3), 3 )
    call SetPlayerColor( Player(3), ConvertPlayerColor(3) )
    call SetPlayerRacePreference( Player(3), RACE_PREF_UNDEAD )
    call SetPlayerRaceSelectable( Player(3), false )
    call SetPlayerController( Player(3), MAP_CONTROL_USER )

    // Player 4
    call SetPlayerStartLocation( Player(4), 4 )
    call ForcePlayerStartLocation( Player(4), 4 )
    call SetPlayerColor( Player(4), ConvertPlayerColor(4) )
    call SetPlayerRacePreference( Player(4), RACE_PREF_ORC )
    call SetPlayerRaceSelectable( Player(4), false )
    call SetPlayerController( Player(4), MAP_CONTROL_COMPUTER )

    // Player 5
    call SetPlayerStartLocation( Player(5), 5 )
    call ForcePlayerStartLocation( Player(5), 5 )
    call SetPlayerColor( Player(5), ConvertPlayerColor(5) )
    call SetPlayerRacePreference( Player(5), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(5), false )
    call SetPlayerController( Player(5), MAP_CONTROL_COMPUTER )

    // Player 6
    call SetPlayerStartLocation( Player(6), 6 )
    call ForcePlayerStartLocation( Player(6), 6 )
    call SetPlayerColor( Player(6), ConvertPlayerColor(6) )
    call SetPlayerRacePreference( Player(6), RACE_PREF_NIGHTELF )
    call SetPlayerRaceSelectable( Player(6), false )
    call SetPlayerController( Player(6), MAP_CONTROL_COMPUTER )

    // Player 7
    call SetPlayerStartLocation( Player(7), 7 )
    call ForcePlayerStartLocation( Player(7), 7 )
    call SetPlayerColor( Player(7), ConvertPlayerColor(7) )
    call SetPlayerRacePreference( Player(7), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(7), false )
    call SetPlayerController( Player(7), MAP_CONTROL_COMPUTER )

    // Player 8
    call SetPlayerStartLocation( Player(8), 8 )
    call ForcePlayerStartLocation( Player(8), 8 )
    call SetPlayerColor( Player(8), ConvertPlayerColor(8) )
    call SetPlayerRacePreference( Player(8), RACE_PREF_ORC )
    call SetPlayerRaceSelectable( Player(8), false )
    call SetPlayerController( Player(8), MAP_CONTROL_COMPUTER )

    // Player 9
    call SetPlayerStartLocation( Player(9), 9 )
    call ForcePlayerStartLocation( Player(9), 9 )
    call SetPlayerColor( Player(9), ConvertPlayerColor(9) )
    call SetPlayerRacePreference( Player(9), RACE_PREF_NIGHTELF )
    call SetPlayerRaceSelectable( Player(9), false )
    call SetPlayerController( Player(9), MAP_CONTROL_COMPUTER )

    // Player 10
    call SetPlayerStartLocation( Player(10), 10 )
    call ForcePlayerStartLocation( Player(10), 10 )
    call SetPlayerColor( Player(10), ConvertPlayerColor(10) )
    call SetPlayerRacePreference( Player(10), RACE_PREF_ORC )
    call SetPlayerRaceSelectable( Player(10), false )
    call SetPlayerController( Player(10), MAP_CONTROL_COMPUTER )

    // Player 11
    call SetPlayerStartLocation( Player(11), 11 )
    call ForcePlayerStartLocation( Player(11), 11 )
    call SetPlayerColor( Player(11), ConvertPlayerColor(11) )
    call SetPlayerRacePreference( Player(11), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(11), false )
    call SetPlayerController( Player(11), MAP_CONTROL_COMPUTER )

endfunction

function InitCustomTeams takes nothing returns nothing
    // Force: TRIGSTR_050
    call SetPlayerTeam( Player(0), 0 )
    call SetPlayerState( Player(0), PLAYER_STATE_ALLIED_VICTORY, 1 )
    call SetPlayerTeam( Player(1), 0 )
    call SetPlayerState( Player(1), PLAYER_STATE_ALLIED_VICTORY, 1 )
    call SetPlayerTeam( Player(2), 0 )
    call SetPlayerState( Player(2), PLAYER_STATE_ALLIED_VICTORY, 1 )
    call SetPlayerTeam( Player(3), 0 )
    call SetPlayerState( Player(3), PLAYER_STATE_ALLIED_VICTORY, 1 )

    //   Allied
    call SetPlayerAllianceStateAllyBJ( Player(0), Player(1), true )
    call SetPlayerAllianceStateAllyBJ( Player(0), Player(2), true )
    call SetPlayerAllianceStateAllyBJ( Player(0), Player(3), true )
    call SetPlayerAllianceStateAllyBJ( Player(1), Player(0), true )
    call SetPlayerAllianceStateAllyBJ( Player(1), Player(2), true )
    call SetPlayerAllianceStateAllyBJ( Player(1), Player(3), true )
    call SetPlayerAllianceStateAllyBJ( Player(2), Player(0), true )
    call SetPlayerAllianceStateAllyBJ( Player(2), Player(1), true )
    call SetPlayerAllianceStateAllyBJ( Player(2), Player(3), true )
    call SetPlayerAllianceStateAllyBJ( Player(3), Player(0), true )
    call SetPlayerAllianceStateAllyBJ( Player(3), Player(1), true )
    call SetPlayerAllianceStateAllyBJ( Player(3), Player(2), true )

    //   Shared Vision
    call SetPlayerAllianceStateVisionBJ( Player(0), Player(1), true )
    call SetPlayerAllianceStateVisionBJ( Player(0), Player(2), true )
    call SetPlayerAllianceStateVisionBJ( Player(0), Player(3), true )
    call SetPlayerAllianceStateVisionBJ( Player(1), Player(0), true )
    call SetPlayerAllianceStateVisionBJ( Player(1), Player(2), true )
    call SetPlayerAllianceStateVisionBJ( Player(1), Player(3), true )
    call SetPlayerAllianceStateVisionBJ( Player(2), Player(0), true )
    call SetPlayerAllianceStateVisionBJ( Player(2), Player(1), true )
    call SetPlayerAllianceStateVisionBJ( Player(2), Player(3), true )
    call SetPlayerAllianceStateVisionBJ( Player(3), Player(0), true )
    call SetPlayerAllianceStateVisionBJ( Player(3), Player(1), true )
    call SetPlayerAllianceStateVisionBJ( Player(3), Player(2), true )

    // Force: TRIGSTR_051
    call SetPlayerTeam( Player(4), 1 )
    call SetPlayerState( Player(4), PLAYER_STATE_ALLIED_VICTORY, 1 )
    call SetPlayerTeam( Player(5), 1 )
    call SetPlayerState( Player(5), PLAYER_STATE_ALLIED_VICTORY, 1 )
    call SetPlayerTeam( Player(6), 1 )
    call SetPlayerState( Player(6), PLAYER_STATE_ALLIED_VICTORY, 1 )
    call SetPlayerTeam( Player(7), 1 )
    call SetPlayerState( Player(7), PLAYER_STATE_ALLIED_VICTORY, 1 )
    call SetPlayerTeam( Player(8), 1 )
    call SetPlayerState( Player(8), PLAYER_STATE_ALLIED_VICTORY, 1 )
    call SetPlayerTeam( Player(9), 1 )
    call SetPlayerState( Player(9), PLAYER_STATE_ALLIED_VICTORY, 1 )
    call SetPlayerTeam( Player(10), 1 )
    call SetPlayerState( Player(10), PLAYER_STATE_ALLIED_VICTORY, 1 )
    call SetPlayerTeam( Player(11), 1 )
    call SetPlayerState( Player(11), PLAYER_STATE_ALLIED_VICTORY, 1 )

    //   Allied
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(10), true )
    call SetPlayerAllianceStateAllyBJ( Player(4), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(10), true )
    call SetPlayerAllianceStateAllyBJ( Player(5), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(10), true )
    call SetPlayerAllianceStateAllyBJ( Player(6), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(10), true )
    call SetPlayerAllianceStateAllyBJ( Player(7), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(10), true )
    call SetPlayerAllianceStateAllyBJ( Player(8), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(10), true )
    call SetPlayerAllianceStateAllyBJ( Player(9), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(10), Player(11), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(4), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(5), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(6), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(7), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(8), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(9), true )
    call SetPlayerAllianceStateAllyBJ( Player(11), Player(10), true )

    //   Shared Vision
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(10), true )
    call SetPlayerAllianceStateVisionBJ( Player(4), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(10), true )
    call SetPlayerAllianceStateVisionBJ( Player(5), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(10), true )
    call SetPlayerAllianceStateVisionBJ( Player(6), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(10), true )
    call SetPlayerAllianceStateVisionBJ( Player(7), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(10), true )
    call SetPlayerAllianceStateVisionBJ( Player(8), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(10), true )
    call SetPlayerAllianceStateVisionBJ( Player(9), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(10), Player(11), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(4), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(5), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(6), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(7), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(8), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(9), true )
    call SetPlayerAllianceStateVisionBJ( Player(11), Player(10), true )

endfunction

function InitAllyPriorities takes nothing returns nothing

    call SetStartLocPrioCount( 0, 3 )
    call SetStartLocPrio( 0, 0, 1, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 0, 1, 2, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 0, 2, 3, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 1, 3 )
    call SetStartLocPrio( 1, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 1, 1, 2, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 1, 2, 3, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 2, 3 )
    call SetStartLocPrio( 2, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 2, 1, 1, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 2, 2, 3, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 3, 3 )
    call SetStartLocPrio( 3, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 3, 1, 1, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 3, 2, 2, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 4, 2 )
    call SetStartLocPrio( 4, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 4, 1, 1, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 5, 1 )
    call SetStartLocPrio( 5, 0, 1, MAP_LOC_PRIO_HIGH )
endfunction

//***************************************************************************
//*
//*  Main Initialization
//*
//***************************************************************************

//===========================================================================
function main takes nothing returns nothing
    call SetCameraBounds( -15872.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), -15872.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM), 16128.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), 15360.0 - GetCameraMargin(CAMERA_MARGIN_TOP), -15872.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), 15360.0 - GetCameraMargin(CAMERA_MARGIN_TOP), 16128.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), -15872.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM) )
    call SetDayNightModels( "Environment\\DNC\\DNCLordaeron\\DNCLordaeronTerrain\\DNCLordaeronTerrain.mdl", "Environment\\DNC\\DNCLordaeron\\DNCLordaeronUnit\\DNCLordaeronUnit.mdl" )
    call NewSoundEnvironment( "Default" )
    call SetAmbientDaySound( "LordaeronWinterDay" )
    call SetAmbientNightSound( "LordaeronWinterNight" )
    call SetMapMusic( "Music", true, 0 )
    call InitSounds(  )
    call CreateRegions(  )
    call CreateCameras(  )
    call CreateAllDestructables(  )
    call CreateAllUnits(  )
    call InitBlizzard(  )
    call InitGlobals(  )
    call InitCustomTriggers(  )

endfunction

//***************************************************************************
//*
//*  Map Configuration
//*
//***************************************************************************

function config takes nothing returns nothing
    call SetMapName( "白昼行将" )
    call SetMapDescription( "成为吸血鬼并存活30分钟" )
    call SetPlayers( 12 )
    call SetTeams( 12 )
    call SetGamePlacement( MAP_PLACEMENT_TEAMS_TOGETHER )

    call DefineStartLocation( 0, 14848.0, -15104.0 )
    call DefineStartLocation( 1, 14848.0, -15104.0 )
    call DefineStartLocation( 2, 14848.0, -15104.0 )
    call DefineStartLocation( 3, 14848.0, -15104.0 )
    call DefineStartLocation( 4, -1280.0, -1216.0 )
    call DefineStartLocation( 5, -1280.0, -1216.0 )
    call DefineStartLocation( 6, -1280.0, -1216.0 )
    call DefineStartLocation( 7, -1280.0, -1216.0 )
    call DefineStartLocation( 8, -1280.0, -1216.0 )
    call DefineStartLocation( 9, -1280.0, -1216.0 )
    call DefineStartLocation( 10, -1280.0, -1216.0 )
    call DefineStartLocation( 11, -1280.0, -1216.0 )

    // Player setup
    call InitCustomPlayerSlots(  )
    call InitCustomTeams(  )
    call InitAllyPriorities(  )
endfunction

